import{j as e,b as ne,l as ue,d as re,h as ie,z as Ne,c as Ue,U as Y,r as j,X as Se,I as Z,ba as K,B as ae,R as we,E as We}from"./index-C1gMn5ii.js";import{g as q,a as xe}from"./scheduling-DY2-X2EQ.js";import{F as He,b as he,c as ge,D as Ce}from"./tags-ZzOxgyKI.js";import{f as fe,g as me,s as Re,a as Ee}from"./format-D0LVvBLC.js";import{C as Pe}from"./refresh-cw-DDUBZyT7.js";import{C as ze}from"./clock-BjB_ZzJS.js";import{E as Q,A as w}from"./types-46npvi_j.js";import{S as Te}from"./save-CeTMy5MW.js";import{M as Ie,a as Me,b as Oe,c as $e}from"./ModalFooter-DJmmqsnS.js";import{L as Fe,a as le}from"./ListGroupItem-BL5W9WHY.js";import{F as ee,L as se}from"./Label-BH3wlHv1.js";import{u as Le}from"./useGetPagedPersons-S0K21pdF.js";import{u as Ge}from"./useGetPagedTeams-bAEUgkqE.js";import{S as _e}from"./Search-D6GIVcns.js";import{P as qe}from"./Pagination-rz0MuaLb.js";import{T as be,g as ye,b as De}from"./TagSelector-DVPGv5ZX.js";import{u as Ye,a as Qe}from"./useGetCompanyNonWorkingDays-GhmrXhUI.js";import{T as Ve}from"./triangle-alert-CnDDJYhA.js";import"./arrow-left-3ZzqzNJk.js";import"./trending-up-c6ZAXtKe.js";import"./folder-a19_k6G8.js";import"./chevron-left-C9XemoUd.js";import"./chevron-up-DyikgMeW.js";import"./search-DFKbLC0f.js";import"./circle-plus-CTQlMt4p.js";import"./ellipsis-vertical-CicxRvoT.js";import"./eye-off-DkNDQzpg.js";import"./eye-Cm30IgyB.js";import"./file-pen-D2PA5C6G.js";import"./folder-up-D0ZjuNFC.js";import"./log-in-n4HEdwCP.js";import"./mouse-pointer-click-Cxon5ywl.js";import"./play-DkvO_sKY.js";import"./plus-B820_MbC.js";import"./share-2-JZjrtDK2.js";import"./trash-2-B5ooiJdI.js";import"./user-plus-CfdGkzj6.js";import"./InputGroupText-BSChjxRD.js";import"./ButtonGroup-DcT2oFi_.js";import"./CardBody-UDT5kdgh.js";import"./v4-C6aID195.js";const Ke=({viewType:s,onViewTypeChange:c,onNavigate:t,onGoToWeek:d,navOptions:l})=>e.jsx("div",{style:{marginBottom:"24px",padding:"20px",background:"#f8fafc",borderRadius:"8px",border:"1px solid #e2e8f0"},children:e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",flexWrap:"wrap",gap:"16px"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"16px"},children:[e.jsxs("div",{style:{display:"flex",background:"white",borderRadius:"6px",border:"1px solid #d1d5db",overflow:"hidden"},children:[e.jsx("button",{onClick:()=>c("projects"),style:{padding:"8px 16px",border:"none",background:s==="projects"?"#4F46E5":"white",color:s==="projects"?"white":"#374151",cursor:"pointer",fontSize:"14px",fontWeight:"500",borderRight:"1px solid #d1d5db"},children:"Projects"}),e.jsx("button",{onClick:()=>c("resources"),style:{padding:"8px 16px",border:"none",background:s==="resources"?"#4F46E5":"white",color:s==="resources"?"white":"#374151",cursor:"pointer",fontSize:"14px",fontWeight:"500"},children:"Resources"})]}),e.jsx("h1",{style:{margin:0,color:"#1e293b",fontSize:"24px",fontWeight:"600"},children:s==="projects"?"Projects":"Resources"})]}),e.jsxs("div",{style:{display:"flex",gap:"12px",alignItems:"center",flexWrap:"wrap"},children:[e.jsx("button",{onClick:()=>t("today"),style:{padding:"8px 12px",border:"1px solid #d1d5db",borderRadius:"4px",background:"white",cursor:"pointer",fontSize:"14px"},children:"Today"}),l.map(r=>e.jsx("button",{onClick:()=>d(r.globalWeek),style:{padding:"8px 12px",border:"1px solid #d1d5db",borderRadius:"4px",background:"white",cursor:"pointer",fontSize:"14px"},children:r.label},r.globalWeek)),e.jsx("button",{onClick:()=>t("prev"),style:{padding:"8px 12px",border:"1px solid #d1d5db",borderRadius:"4px",background:"white",cursor:"pointer",fontSize:"14px"},children:"<"}),e.jsx("button",{onClick:()=>t("next"),style:{padding:"8px 12px",border:"1px solid #d1d5db",borderRadius:"4px",background:"white",cursor:"pointer",fontSize:"14px"},children:">"})]})]})}),Xe=(s,c)=>{const t=ne(),d=s?new URLSearchParams(Object.fromEntries(Object.entries(s).filter(([,i])=>i!=null))).toString():"",l=`${re}/api/projects/dashboard-data${d?`?${d}`:""}`;return ue({queryKey:["projects-dashboard-data",s],queryFn:async()=>{const i=await t(l);return ie(i)},...c})},Je=()=>{const s=ne(),c=Ne();return Ue({mutationFn:async t=>{const d=await s(`${re}/api/dashboard/allocations/bulk-update`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});return ie(d)},onSuccess:()=>{c.invalidateQueries({queryKey:["projects-dashboard-data"]}),c.invalidateQueries({queryKey:["resources-dashboard-data"]})}})},je=({timelineData:s,title:c,onToggleFilter:t,isFilterVisible:d,hasActiveFilters:l})=>e.jsxs("div",{style:{position:"sticky",top:0,background:"white",zIndex:10,borderBottom:"2px solid #e2e8f0",marginBottom:"8px"},children:[s.yearGroups.length>0&&e.jsxs("div",{style:{display:"flex",borderBottom:"1px solid #e5e7eb"},children:[e.jsx("div",{style:{width:"300px",padding:"4px 16px",fontWeight:"500",color:"#6b7280",fontSize:"11px",borderRight:"1px solid #e5e7eb"},children:"Year"}),e.jsx("div",{style:{flex:1,display:"flex"},children:s.yearGroups.map((r,i)=>e.jsx("div",{style:{width:`${r.span/s.columns.length*100}%`,textAlign:"center",padding:"4px",fontSize:"11px",fontWeight:"500",color:"#6b7280",borderRight:"1px solid #eee"},children:r.label},`${r.label}-year-${i}`))})]}),s.quarterGroups.length>0&&e.jsxs("div",{style:{display:"flex",borderBottom:"1px solid #e5e7eb"},children:[e.jsx("div",{style:{width:"300px",padding:"4px 16px",fontWeight:"500",color:"#6b7280",fontSize:"11px",borderRight:"1px solid #e5e7eb"},children:"Quarter"}),e.jsx("div",{style:{flex:1,display:"flex"},children:s.quarterGroups.map((r,i)=>e.jsx("div",{style:{width:`${r.span/s.columns.length*100}%`,textAlign:"center",padding:"4px",fontSize:"11px",fontWeight:"500",color:"#6b7280",borderRight:"1px solid #eee"},children:r.label},`${r.label}-quarter-${i}`))})]}),s.monthGroups.length>0&&e.jsxs("div",{style:{display:"flex",borderBottom:"1px solid #e5e7eb"},children:[e.jsx("div",{style:{width:"300px",padding:"4px 16px",fontWeight:"500",color:"#6b7280",fontSize:"11px",borderRight:"1px solid #e5e7eb"},children:"Month"}),e.jsx("div",{style:{flex:1,display:"flex"},children:s.monthGroups.map((r,i)=>e.jsx("div",{style:{width:`${r.span/s.columns.length*100}%`,textAlign:"center",padding:"4px",fontSize:"11px",fontWeight:"500",color:"#6b7280",borderRight:"1px solid #eee"},children:r.label},`${r.label}-month-${i}`))})]}),e.jsxs("div",{style:{display:"flex",minHeight:"40px"},children:[e.jsxs("div",{style:{width:"300px",padding:"8px 16px",fontWeight:"600",color:"#374151",borderRight:"1px solid #e5e7eb",display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsx("span",{children:c}),t&&e.jsxs("button",{onClick:t,style:{background:"none",border:"none",cursor:"pointer",padding:"4px",borderRadius:"4px",display:"flex",alignItems:"center",color:l?"#3b82f6":"#6b7280",backgroundColor:d?"#f3f4f6":"transparent"},title:d?"Hide filters":"Show filters",children:[e.jsx(He,{size:16}),l&&e.jsx("div",{style:{width:"6px",height:"6px",borderRadius:"50%",backgroundColor:"#3b82f6",position:"absolute",marginLeft:"10px",marginTop:"-8px"}})]})]}),e.jsx("div",{style:{flex:1,display:"flex",background:"#f9fafb"},children:s.columns.map((r,i)=>{const x=new Date,u=q(x),f=r.globalWeekNumber===u.globalWeekNumber;let g=50;if(f){const U=u.mondayOfWeek,E=Math.floor((x.getTime()-U.getTime())/(1e3*60*60*24));g=10+Math.max(0,Math.min(6,E))/6*80}return e.jsxs("div",{style:{flex:1,borderRight:"1px solid #e5e7eb",padding:"8px 4px",fontSize:"12px",color:"#6b7280",textAlign:"center",minWidth:"50px",position:"relative"},children:[e.jsx("div",{children:r.label}),e.jsx("div",{style:{fontSize:"10px",opacity:.7},children:fe(r.startDate,"MMM d")}),f&&e.jsx("div",{style:{position:"absolute",bottom:"-12px",left:`${g}%`,transform:"translateX(-50%)",zIndex:1e3,pointerEvents:"none"},title:`Today: ${x.toLocaleDateString()}`,children:e.jsx("div",{style:{width:0,height:0,borderLeft:"8px solid transparent",borderRight:"8px solid transparent",borderTop:"12px solid #dc2626",filter:"drop-shadow(0 2px 4px rgba(220, 38, 38, 0.3))"}})})]},`${r.label}-${i}-col`)})})]})]}),L={EMPTY:"#f8fafc",GREEN:"rgba(34, 197, 94, 0.7)",AMBER:"rgba(245, 158, 11, 0.7)",RED:"rgba(239, 68, 68, 0.7)"},te={BAU_OVERALLOCATION:1,NON_BAU_HIGH:.5,NON_BAU_MEDIUM:.25};function de(s,c){return c==="BAU"?s>te.BAU_OVERALLOCATION?{color:L.RED,priority:3}:{color:L.GREEN,priority:1}:s>te.NON_BAU_HIGH?{color:L.RED,priority:3}:s>te.NON_BAU_MEDIUM?{color:L.AMBER,priority:2}:{color:L.GREEN,priority:1}}const ve=(s,c)=>{const t=s>0,d=c>0;if(!t&&!d)return L.EMPTY;const l=[];t&&l.push(de(s,"BAU")),d&&l.push(de(c,"NON_BAU"));const r=Math.max(...l.map(x=>x.priority)),i=l.find(x=>x.priority===r);return(i==null?void 0:i.color)??L.GREEN},Ze=s=>{switch(s){case"red":return L.RED;case"amber":return L.AMBER;case"green":return L.GREEN;default:return L.GREEN}},Ae=({allocation:s,resourceName:c,projectType:t,totalWeeklyHours:d,totalWeeklyPercentage:l,availableHours:r,baseHours:i,teamAllocations:x})=>{const u=new Date(s.weekBeginningOn).toLocaleDateString("en-US",{month:"short",day:"numeric"}),f=new Date(s.weekEndOn).toLocaleDateString("en-US",{month:"short",day:"numeric"});return e.jsxs("div",{style:{background:"rgba(0, 0, 0, 0.9)",color:"white",padding:"16px",borderRadius:"8px",fontSize:"13px",lineHeight:"1.5",minWidth:"320px",maxWidth:"400px",boxShadow:"0 4px 12px rgba(0, 0, 0, 0.3)",zIndex:1e3,position:"absolute",pointerEvents:"none"},children:[e.jsx("div",{style:{fontWeight:"600",marginBottom:"8px",color:"#60a5fa"},children:c}),e.jsxs("div",{style:{marginBottom:"6px"},children:[e.jsx("strong",{children:"Project:"})," ",t]}),e.jsxs("div",{style:{marginBottom:"6px",display:"flex",alignItems:"center",gap:"4px"},children:[e.jsx(Pe,{size:12}),e.jsxs("span",{children:["Week ",s.globalWeekNumber," (",u," - ",f,")"]})]}),e.jsxs("div",{style:{marginBottom:"6px",display:"flex",alignItems:"center",gap:"4px"},children:[e.jsx(ze,{size:12}),e.jsxs("span",{children:["This project: ",(s.hoursBAU+s.hoursNonBAU).toFixed(1),"h"]}),s.hoursBAU>0&&s.hoursNonBAU>0&&e.jsxs("span",{style:{fontSize:"11px",color:"#94a3b8"},children:["(",s.hoursBAU,"h BAU + ",s.hoursNonBAU,"h NonBAU)"]})]}),s.phaseName&&e.jsxs("div",{style:{marginBottom:"6px",padding:"6px 8px",background:s.phaseColor||"rgba(255, 255, 255, 0.1)",borderRadius:"4px",fontSize:"11px",fontWeight:"500",color:"white"},children:["Phase: ",s.phaseName]}),s.description&&e.jsxs("div",{style:{marginBottom:"6px",padding:"8px",background:"rgba(255, 255, 255, 0.1)",borderRadius:"4px",fontSize:"12px",fontStyle:"italic"},children:[e.jsx("strong",{children:"Task:"})," ",s.description]}),x&&x.length>0&&e.jsxs("div",{style:{marginTop:"8px",paddingTop:"8px",borderTop:"1px solid rgba(255, 255, 255, 0.2)",fontSize:"11px"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"4px",marginBottom:"4px",fontWeight:"600"},children:[e.jsx(Y,{size:12}),e.jsx("span",{children:"Team Allocations:"})]}),x.map(g=>e.jsxs("div",{style:{marginLeft:"16px",marginBottom:"2px"},children:[g.teamName,": ",(g.hoursBAU+g.hoursNonBAU).toFixed(1),"h",g.hoursBAU>0&&g.hoursNonBAU>0&&e.jsxs("span",{style:{fontSize:"10px",color:"#94a3b8"},children:[" ","(",g.hoursBAU,"h BAU + ",g.hoursNonBAU,"h NonBAU)"]})]},g.teamId))]}),d&&l||r||i?e.jsxs("div",{style:{marginTop:"8px",paddingTop:"8px",borderTop:"1px solid rgba(255, 255, 255, 0.2)",fontSize:"11px"},children:[d&&l&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:["Total week allocation: ",d.toFixed(1),"h"]}),e.jsxs("div",{children:["Capacity utilization: ",Math.round(l*100),"%"]})]}),r!==void 0&&e.jsxs("div",{children:["Available hours this week: ",r.toFixed(1),"h"]}),i!==void 0&&r!==void 0&&i!==r&&e.jsxs("div",{style:{fontSize:"10px",color:"#94a3b8"},children:["(Base: ",i.toFixed(1),"h, reduced by holidays/leave)"]})]}):null]})},X=()=>{const[s,c]=j.useState({isVisible:!1,x:0,y:0,content:null}),t=j.useRef(void 0),d=j.useCallback((x,u)=>{t.current&&window.clearTimeout(t.current),c({isVisible:!0,x:x.clientX,y:x.clientY-10,content:u})},[]),l=j.useCallback(()=>{t.current=window.setTimeout(()=>{c(x=>({...x,isVisible:!1}))},100)},[]),r=j.useCallback(x=>{s.isVisible&&c(u=>({...u,x:x.clientX,y:x.clientY-10}))},[s.isVisible]);return j.useEffect(()=>()=>{t.current&&window.clearTimeout(t.current)},[]),{tooltipProps:{onMouseEnter:d,onMouseLeave:l,onMouseMove:r},TooltipPortal:()=>!s.isVisible||!s.content?null:e.jsx("div",{style:{position:"fixed",left:s.x+10,top:s.y,zIndex:1e4,pointerEvents:"none"},children:s.content})}},es=({allocation:s,resource:c,project:t,globalWeekNumber:d,canEdit:l,onAllocationChange:r,getBarStyles:i,calculateTotalWeeklyAllocation:x})=>{const[u,f]=j.useState(!1),[g,U]=j.useState(!1),[E,S]=j.useState({hoursBAU:(s==null?void 0:s.hoursBAU)??0,hoursNonBAU:(s==null?void 0:s.hoursNonBAU)??0}),W=j.useRef(null),{tooltipProps:A,TooltipPortal:I}=X();j.useEffect(()=>{S({hoursBAU:(s==null?void 0:s.hoursBAU)??0,hoursNonBAU:(s==null?void 0:s.hoursNonBAU)??0})},[s]),j.useEffect(()=>{const C=$=>{W.current&&!W.current.contains($.target)&&H()};return u&&document.addEventListener("mousedown",C),()=>{document.removeEventListener("mousedown",C)}},[u]);const z=()=>{const C=s?s.id:null,$=t.engagementContext===Q.BAU?{...E,hoursNonBAU:0}:E;r(C,t.id,c.id,d,$,(s==null?void 0:s.assignmentType)||c.assignmentType),f(!1)},H=()=>{S({hoursBAU:(s==null?void 0:s.hoursBAU)??0,hoursNonBAU:(s==null?void 0:s.hoursNonBAU)??0}),f(!1)},h=x(c.id,d),B=h.availableHours??40,b=ve(h.totalHoursBAU/B,h.totalHoursNonBAU/B),N=((s==null?void 0:s.hoursBAU)??0)+((s==null?void 0:s.hoursNonBAU)??0),m=s&&N>0,P=i(d,1),M=j.useMemo(()=>s&&e.jsx(Ae,{allocation:s,resourceName:c.name,projectType:t.name,totalWeeklyHours:h.totalHours,totalWeeklyPercentage:h.totalHours/B}),[s,c.name,t.name,h]),T=h.totalHoursBAU>B;return P?u?(()=>{const C=t.engagementContext===Q.BAU;return e.jsx("div",{style:{...P,background:"transparent"},children:e.jsxs("div",{ref:W,style:{position:"absolute",zIndex:20,background:"white",border:"1px solid #d1d5db",borderRadius:"8px",boxShadow:"0 4px 12px rgba(0,0,0,0.15)",padding:"12px",width:"200px",transform:"translateY(-100%)",marginTop:"-8px"},children:[e.jsx("div",{style:{fontWeight:600,fontSize:"13px",marginBottom:"8px"},children:s?"Edit Allocation":"Add Allocation"}),!C&&e.jsxs("div",{style:{marginBottom:"8px"},children:[e.jsx("label",{style:{display:"block",fontSize:"11px",color:"#4b5563",marginBottom:"4px"},children:"Non-BAU Hours"}),e.jsx("input",{type:"number",step:"1",min:"0",value:E.hoursNonBAU,onChange:$=>S(_=>({..._,hoursNonBAU:parseFloat($.target.value)||0})),style:{width:"100%",padding:"6px",borderRadius:"4px",border:"1px solid #d1d5db"}})]}),e.jsxs("div",{style:{marginBottom:C?"0px":"8px"},children:[e.jsx("label",{style:{display:"block",fontSize:"11px",color:"#4b5563",marginBottom:"4px"},children:"BAU Hours"}),e.jsx("input",{type:"number",step:"1",min:"0",value:E.hoursBAU,onChange:$=>S(_=>({..._,hoursBAU:parseFloat($.target.value)||0})),style:{width:"100%",padding:"6px",borderRadius:"4px",border:"1px solid #d1d5db"}})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:"8px",marginTop:"12px"},children:[e.jsx("button",{onClick:H,style:{padding:"4px 8px",border:"1px solid #d1d5db",borderRadius:"4px",background:"white",cursor:"pointer"},children:e.jsx(Se,{size:14})}),e.jsx("button",{onClick:z,style:{padding:"4px 8px",border:"none",borderRadius:"4px",background:"#4F46E5",color:"white",cursor:"pointer"},children:e.jsx(Te,{size:14})})]})]})})})():e.jsxs(e.Fragment,{children:[e.jsx(I,{}),e.jsxs("div",{style:{...P,background:m?b:"transparent",border:T?`1px solid ${Ze("red")}`:m?"none":"1px dashed #e5e7eb",cursor:l?"pointer":"default",display:"flex",alignItems:"center",justifyContent:"center",color:"white",fontWeight:500,fontSize:"11px"},onClick:()=>l&&f(!0),onMouseEnter:C=>{U(!0),m&&!u&&A.onMouseEnter(C,M)},onMouseMove:C=>{m&&!u&&A.onMouseMove(C)},onMouseLeave:()=>{U(!1),m&&!u&&A.onMouseLeave&&A.onMouseLeave()},children:[m?`${N.toFixed(1)}h`:"",l&&e.jsx(he,{size:12,style:{marginLeft:4,opacity:g?1:0,transition:"opacity 0.2s"}})]})]}):null},ss=({project:s,globalWeekNumber:c,canEdit:t,onResourceAndAllocationSelect:d,getBarStyles:l})=>{var p,y,R;const[r,i]=j.useState(!1),[x,u]=j.useState(w.Person),[f,g]=j.useState(null),[U,E]=j.useState({hoursBAU:0,hoursNonBAU:0}),[S,W]=j.useState(!1),{TooltipPortal:A}=X(),[I,z]=j.useState(1),[H,h]=j.useState(10),[B,b]=j.useState(null),{data:N,isLoading:m}=Le(I,H,B,null,{enabled:r&&x===w.Person}),{data:P,isLoading:M}=Ge(I,H,B,{enabled:r&&x===w.Team}),T=()=>{t&&i(!0)},G=(n,k,v)=>{g({id:n,assignmentType:k,name:v})},F=()=>{if(!f)return;const n=s.engagementContext===Q.BAU?{...U,hoursNonBAU:0}:U;d(f.id,f.assignmentType,f.name,s.id,c,n),C()},C=()=>{i(!1),g(null),E({hoursBAU:0,hoursNonBAU:0}),u(w.Person),z(1),b(null)},$=n=>{b(n||null),z(1)},_=n=>{u(n),z(1),b(null),g(null)},D=l(c,1);if(!D)return null;const J=x===w.Person?m:M,a=x===w.Person?N:P,o=s.engagementContext===Q.BAU;return e.jsxs(e.Fragment,{children:[e.jsx(A,{}),e.jsx("div",{style:{...D,background:"transparent",border:"1px dashed #e5e7eb",cursor:t?"pointer":"default",display:"flex",alignItems:"center",justifyContent:"center",color:"#9ca3af",fontWeight:400,fontSize:"11px"},onClick:T,onMouseEnter:()=>W(!0),onMouseLeave:()=>W(!1),children:t&&e.jsx(he,{size:12,style:{opacity:S?.6:.3,transition:"opacity 0.2s"}})}),e.jsxs(Ie,{isOpen:r,toggle:C,size:"lg",children:[e.jsx(Me,{toggle:C,children:"Add Resource & Allocation"}),e.jsxs(Oe,{children:[e.jsxs(ee,{className:"mb-3",children:[e.jsx(se,{for:"assignmentType",children:"Assignment Type"}),e.jsxs(Z,{type:"select",id:"assignmentType",value:x,onChange:n=>_(Number(n.target.value)),children:[e.jsx("option",{value:w.Person,children:"Person"}),e.jsx("option",{value:w.Team,children:"Team"})]})]}),e.jsx("div",{className:"mb-3",children:e.jsx(_e,{searchText:B,onSearch:$})}),e.jsx("div",{className:"mb-3",children:J?e.jsx("div",{className:"text-center p-3",children:"Loading..."}):(p=a==null?void 0:a.items)!=null&&p.length?e.jsx(Fe,{children:x===w.Person?(y=N==null?void 0:N.items)==null?void 0:y.map(n=>e.jsxs(le,{action:!0,active:(f==null?void 0:f.id)===n.id,onClick:()=>G(n.id,w.Person,`${n.firstName} ${n.lastName}`),className:"d-flex align-items-center cursor-pointer",children:[e.jsx(K,{size:16,className:"me-2"}),e.jsxs("div",{children:[e.jsx("div",{children:`${n.firstName} ${n.lastName}`}),e.jsx("small",{className:"text-muted",children:n.email})]})]},n.id)):(R=P==null?void 0:P.items)==null?void 0:R.map(n=>e.jsxs(le,{action:!0,active:(f==null?void 0:f.id)===n.id,onClick:()=>G(n.id,w.Team,n.name),className:"d-flex align-items-center cursor-pointer",children:[e.jsx(Y,{size:16,className:"me-2"}),e.jsxs("div",{children:[e.jsx("div",{children:n.name}),e.jsxs("small",{className:"text-muted",children:[n.memberCount," member",n.memberCount!==1?"s":""]})]})]},n.id))}):e.jsxs("div",{className:"text-center p-3",children:["No ",x===w.Person?"people":"teams"," found"]})}),a&&e.jsx(qe,{pagedResult:a,onPageSelected:z,perPage:H,onPerPageSelected:h}),f&&e.jsxs("div",{className:"mt-4 pt-3 border-top",children:[e.jsxs("h6",{children:["Allocation for ",f.name]}),!o&&e.jsxs(ee,{className:"mb-3",children:[e.jsx(se,{children:"Non-BAU Hours"}),e.jsx(Z,{type:"number",step:"1",min:"0",value:U.hoursNonBAU,onChange:n=>E(k=>({...k,hoursNonBAU:parseFloat(n.target.value)||0}))})]}),e.jsxs(ee,{children:[e.jsx(se,{children:"BAU Hours"}),e.jsx(Z,{type:"number",step:"1",min:"0",value:U.hoursBAU,onChange:n=>E(k=>({...k,hoursBAU:parseFloat(n.target.value)||0}))})]})]})]}),e.jsxs($e,{children:[e.jsx(ae,{color:"secondary",onClick:C,children:"Cancel"}),e.jsx(ae,{color:"primary",onClick:F,disabled:!f,children:"Add Resource & Allocation"})]})]})]})},ts=({engagementContext:s,size:c="md"})=>{const t=s===Q.BAU,l={display:"inline-flex",alignItems:"center",fontWeight:"600",textTransform:"uppercase",letterSpacing:"0.5px",...{sm:{fontSize:"10px",padding:"2px 6px",borderRadius:"3px"},md:{fontSize:"11px",padding:"3px 8px",borderRadius:"4px"}}[c]},r={...l,backgroundColor:"#dbeafe",color:"#1e40af",border:"1px solid #93c5fd"},i={...l,backgroundColor:"#fef3c7",color:"#d97706",border:"1px solid #fbbf24"};return e.jsx("span",{style:t?r:i,title:t?"Business-as-usual: Routine work aligned with core responsibilities":"Non-BAU: Work outside normal role, typically related to change or strategic initiatives",children:t?"BAU":"Non-BAU"})};function pe(s,c,t){var E;const d=t.find(S=>S.id===s&&S.type===w.Person);if(!d)return{directHoursBAU:0,directHoursNonBAU:0,teamHoursBAU:0,teamHoursNonBAU:0,totalHoursBAU:0,totalHoursNonBAU:0,teamAllocations:[]};const l=d.allocations.find(S=>S.globalWeekNumber===c),r=(l==null?void 0:l.totalHoursBAU)||0,i=(l==null?void 0:l.totalHoursNonBAU)||0,x=[];let u=0,f=0;(E=d.teams)==null||E.forEach(S=>{const W=t.find(A=>A.id===S.id&&A.type===w.Team);if(W){const A=W.allocations.find(I=>I.globalWeekNumber===c);if(A){const I=A.totalHoursBAU||0,z=A.totalHoursNonBAU||0;u+=I,f+=z,x.push({teamId:S.id,teamName:S.name,hoursBAU:I,hoursNonBAU:z})}}});const g=r+u,U=i+f;return{directHoursBAU:r,directHoursNonBAU:i,teamHoursBAU:u,teamHoursNonBAU:f,totalHoursBAU:g,totalHoursNonBAU:U,availableHours:l==null?void 0:l.availableHours,baseHours:l==null?void 0:l.baseHours,teamAllocations:x}}function os(s,c,t){let d=0,l=0,r=0,i=0,x,u;const f=[];let g=[];t.forEach(S=>{const W=S.resources.find(A=>A.id===s&&A.assignmentType===w.Person);W&&W.teams&&(g=W.teams)}),t.forEach(S=>{const W=S.resources.find(A=>A.id===s&&A.assignmentType===w.Person);W&&W.allocations.forEach(A=>{A.globalWeekNumber===c&&(d+=A.hoursBAU,l+=A.hoursNonBAU,x===void 0&&A.availableHours!==void 0&&(x=A.availableHours),u===void 0&&A.baseHours!==void 0&&(u=A.baseHours))}),g.forEach(A=>{const I=S.resources.find(z=>z.id===A.id&&z.assignmentType===w.Team);I&&I.allocations.forEach(z=>{if(z.globalWeekNumber===c){let H=f.find(h=>h.teamId===A.id);H||(H={teamId:A.id,teamName:A.name,hoursBAU:0,hoursNonBAU:0},f.push(H)),H.hoursBAU+=z.hoursBAU,H.hoursNonBAU+=z.hoursNonBAU,r+=z.hoursBAU,i+=z.hoursNonBAU}})})});const U=d+r,E=l+i;return{directHoursBAU:d,directHoursNonBAU:l,teamHoursBAU:r,teamHoursNonBAU:i,totalHoursBAU:U,totalHoursNonBAU:E,availableHours:x,baseHours:u,teamAllocations:f}}function ns(s,c,t,d){const{baseWorkingHours:l,companyNonWorkingDays:r,personalLeave:i}=d,x=(l==null?void 0:l.baseHoursPerWeek)??40,u=rs();let f=0;return c===w.Person&&(f=is()),Math.max(0,x-u-f)}function rs(s,c,t){return 0}function is(s,c,t,d){return 0}function ce(s,c,t,d,l){const r=d.find(i=>i.globalWeekNumber===t&&i.availableHours!==void 0);return(r==null?void 0:r.availableHours)!==void 0?r.availableHours:ns(s,c,t,l)}const as=({timelineData:s,requestParams:c})=>{const{data:t,isLoading:d,error:l,refetch:r}=Xe(c),{mutate:i,isPending:x}=Je(),{data:u}=Ye(),{data:f=[]}=Qe(),[g,U]=j.useState(new Set),[E,S]=j.useState(null),[W,A]=j.useState([]),[I,z]=j.useState(!1),[H,h]=j.useState({}),{TooltipPortal:B}=X(),b=j.useMemo(()=>({baseWorkingHours:u||null,companyNonWorkingDays:f,personalLeave:[]}),[u,f]),N=j.useMemo(()=>{const a=new Map;return t==null||t.projects.forEach(o=>{var p;return(p=o.project.tags)==null?void 0:p.forEach(y=>y.id&&a.set(y.id,y))}),Array.from(a.values()).sort((o,p)=>o.name.localeCompare(p.name))},[t==null?void 0:t.projects]),m=j.useMemo(()=>t!=null&&t.projects?Object.keys(H).length===0?t.projects:JSON.parse(JSON.stringify(t.projects)).map(o=>{const p=new Set(o.resources.map(n=>n.id)),y=new Set(Object.values(H).filter(n=>n.isNew&&n.projectId===o.project.id&&!p.has(n.resourceId)).map(n=>n.resourceId)),R=Array.from(y).map(n=>{const k=Object.values(H).find(v=>v.isNew&&v.projectId===o.project.id&&v.resourceId===n);return{id:n,name:(k==null?void 0:k.resourceName)||`Resource ${n}`,assignmentType:(k==null?void 0:k.assignmentType)||w.Person,allocations:[]}});return{...o,resources:[...o.resources.map(n=>({...n,allocations:[...n.allocations.map(k=>{const v=H[k.id];return v?{...k,hoursBAU:v.hoursBAU,hoursNonBAU:v.hoursNonBAU}:k}),...Object.entries(H).filter(([k,v])=>v.isNew&&v.projectId===o.project.id&&v.resourceId===n.id).map(([k,v])=>({id:k,globalWeekNumber:v.globalWeekNumber,weekBeginningOn:"",weekEndOn:"",hoursBAU:v.hoursBAU,hoursNonBAU:v.hoursNonBAU,...(()=>{const O=ce(n.id,n.assignmentType,v.globalWeekNumber,n.allocations,b);return{percentageOfWorkWeekBAU:v.hoursBAU/O,percentageOfWorkWeekNonBAU:v.hoursNonBAU/O}})(),description:"",phaseName:void 0,phaseColor:void 0}))]})),...R.map(n=>({...n,allocations:Object.entries(H).filter(([k,v])=>v.isNew&&v.projectId===o.project.id&&v.resourceId===n.id).map(([k,v])=>({id:k,globalWeekNumber:v.globalWeekNumber,weekBeginningOn:"",weekEndOn:"",hoursBAU:v.hoursBAU,hoursNonBAU:v.hoursNonBAU,...(()=>{const O=ce(n.id,n.assignmentType,v.globalWeekNumber,[],b);return{percentageOfWorkWeekBAU:v.hoursBAU/O,percentageOfWorkWeekNonBAU:v.hoursNonBAU/O}})(),description:"",phaseName:void 0,phaseColor:void 0}))}))]}}):[],[t,H]),P=j.useMemo(()=>{if(W.length===0)return m;const a=new Set(W.map(o=>o.id).filter(Boolean));return m.filter(o=>{var p;return(p=o.project.tags)==null?void 0:p.some(y=>y.id&&a.has(y.id))})},[m,W]),M=j.useCallback((a,o)=>{let p=!1;if(m.forEach(y=>{const R=y.resources.find(n=>n.id===a);R&&R.assignmentType===w.Person&&(p=!0)}),p){const y=os(a,o,m);return{totalHours:y.totalHoursBAU+y.totalHoursNonBAU,totalHoursBAU:y.totalHoursBAU,totalHoursNonBAU:y.totalHoursNonBAU,availableHours:y.availableHours}}else{let y=0,R=0,n;return m.forEach(k=>{const v=k.resources.find(O=>O.id===a);if(v){const O=v.allocations.find(V=>V.globalWeekNumber===o);O&&(y+=O.hoursBAU,R+=O.hoursNonBAU,O.availableHours!==void 0&&(n=O.availableHours))}}),{totalHours:y+R,totalHoursBAU:y,totalHoursNonBAU:R,availableHours:n}}},[m]),T=(a,o,p,y,R,n)=>{if(a)h(k=>({...k,[a]:{...R,projectId:o,resourceId:p,globalWeekNumber:y,assignmentType:n,isNew:!1}}));else{const k=`new-${o}-${p}-${y}`;h(v=>({...v,[k]:{...R,projectId:o,resourceId:p,globalWeekNumber:y,assignmentType:n,isNew:!0}}))}},G=()=>{S(null);const a=Object.entries(H).map(([o,p])=>p.isNew?{id:null,projectId:p.projectId,resourceId:p.resourceId,globalWeekNumber:p.globalWeekNumber,hoursBAU:p.hoursBAU,hoursNonBAU:p.hoursNonBAU,assignmentType:p.assignmentType}:{id:o,projectId:p.projectId,resourceId:p.resourceId,globalWeekNumber:p.globalWeekNumber,hoursBAU:p.hoursBAU,hoursNonBAU:p.hoursNonBAU,assignmentType:p.assignmentType});console.log("Saving changes:",a),i({allocations:a},{onSuccess:()=>{h({}),S(null),r()},onError:o=>{S(o),console.error("Failed to save changes",o)}})},F=()=>{h({})},C=(a,o,p,y,R,n)=>{console.log("Adding resource and allocation to project:",{projectId:y,resourceId:a,assignmentType:o,resourceName:p,globalWeekNumber:R,hours:n});const k=`new-${y}-${a}-${R}`;h(v=>({...v,[k]:{...n,projectId:y,resourceId:a,globalWeekNumber:R,isNew:!0,resourceName:p,assignmentType:o}}))},$=j.useCallback((a,o)=>{const p=s.startGlobalWeek,y=s.columns.length,R=a+o-1,n=p+y-1;if(R<p||a>n)return null;const k=a-p,v=1/y*100;return{position:"absolute",left:`${k/y*100}%`,width:`${v}%`,height:"24px"}},[s]);we.useEffect(()=>{t!=null&&t.projects&&t.projects.length>0&&U(new Set(t.projects.map(a=>a.project.id)))},[t==null?void 0:t.projects]);const _=a=>{const o=new Set(g);o.has(a)?o.delete(a):o.add(a),U(o)},D=j.useCallback((a,o,p,y)=>{const R=a+o-1,n=p+y-1;if(R<p||a>n)return null;const k=Math.max(a,p),v=Math.min(R,n),O=k-p,V=v-k+1;if(V<=0)return null;const Be=O/y*100,ke=V/y*100;return{position:"absolute",left:`${Be}%`,width:`${ke}%`,height:"24px",borderRadius:"4px",display:"flex",alignItems:"center",justifyContent:"center",color:"white",fontSize:"11px",fontWeight:"500",boxShadow:"0 1px 3px rgba(0,0,0,0.1)",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",padding:"0 4px"}},[]),J=Object.keys(H).length>0;return e.jsxs("div",{children:[E?e.jsx("div",{style:{position:"sticky",top:0,zIndex:12,padding:"8px 16px"},children:e.jsx(We,{error:E,title:"Failed to save changes",onDismiss:()=>S(null)})}):null,J&&e.jsxs("div",{style:{position:"sticky",top:0,zIndex:11,background:"rgba(255, 251, 235, 0.98)",padding:"6px 16px",borderBottom:"1px solid #fcd34d",display:"flex",alignItems:"center",justifyContent:"space-between",backdropFilter:"blur(4px)"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"6px",color:"#b45309",fontWeight:500,fontSize:"13px"},children:[e.jsx(Ve,{size:14}),"You have ",Object.keys(H).length," unsaved changes."]}),e.jsxs("div",{style:{display:"flex",gap:"8px"},children:[e.jsx("button",{onClick:F,style:{padding:"4px 12px",border:"1px solid #d1d5db",borderRadius:"4px",background:"white",cursor:"pointer",fontWeight:500,fontSize:"12px"},children:"Discard"}),e.jsx("button",{onClick:G,style:{padding:"4px 12px",border:"none",borderRadius:"4px",background:"#16a34a",color:"white",cursor:"pointer",fontWeight:500,fontSize:"12px"},children:x?"Saving...":"Save Changes"})]})]}),e.jsx(je,{timelineData:s,title:"Projects",onToggleFilter:()=>z(!I),isFilterVisible:I,hasActiveFilters:W.length>0}),e.jsx(B,{}),N.length>0&&I&&e.jsxs("div",{style:{display:"flex",background:"white",borderBottom:"1px solid #f1f5f9",minHeight:"50px"},children:[e.jsxs("div",{style:{width:"300px",padding:"12px 16px",borderRight:"1px solid #e5e7eb",display:"flex",alignItems:"center",gap:"8px"},children:[e.jsx(ge,{size:16,className:"text-muted"}),e.jsx("span",{style:{fontSize:"13px",color:"#6b7280"},children:"Filter by tags:"})]}),e.jsxs("div",{style:{flex:1,padding:"8px 16px",display:"flex",alignItems:"center",gap:"12px"},children:[e.jsx("div",{style:{flex:1,maxWidth:"400px"},children:e.jsx(be,{selectedTags:W,onChange:A,placeholder:"Select tags to filter projects..."})}),W.length>0&&e.jsxs("span",{style:{fontSize:"12px",color:"#6b7280",whiteSpace:"nowrap"},children:["Showing ",P.length," of"," ",m.length," projects"]})]})]}),e.jsx("div",{style:{background:"white"},children:d?e.jsx("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",height:"200px",fontSize:"16px",color:"#6b7280"},children:"Loading projects..."}):l?e.jsxs("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",height:"200px",fontSize:"16px",color:"#dc2626"},children:["Error loading projects: ",l.message]}):P.length===0?e.jsx("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",height:"200px",fontSize:"16px",color:"#6b7280"},children:W.length>0?"No projects match the selected tags":"No projects found"}):P.map(a=>e.jsxs("div",{style:{borderBottom:"1px solid #f1f5f9"},children:[e.jsxs("div",{style:{display:"flex",minHeight:"80px",cursor:"pointer",background:g.has(a.project.id)?"#f8fafc":"white"},onClick:()=>_(a.project.id),children:[e.jsxs("div",{style:{width:"300px",padding:"16px",borderRight:"1px solid #e5e7eb",display:"flex",alignItems:"center",gap:"12px"},children:[e.jsx("span",{style:{fontSize:"18px",color:g.has(a.project.id)?"#374151":"#9ca3af"},children:g.has(a.project.id)?"▼":"▶"}),e.jsxs("div",{children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px",marginBottom:"4px"},children:[e.jsx("div",{style:{fontWeight:"600",color:"#1f2937",fontSize:"14px"},children:a.project.name}),e.jsx(ts,{engagementContext:a.project.engagementContext,size:"sm"})]}),e.jsx("div",{style:{fontSize:"12px",color:"#6b7280",lineHeight:"1.4"},children:a.project.description})]})]}),e.jsxs("div",{style:{flex:1,position:"relative",padding:"16px 0"},children:[e.jsxs("div",{style:{position:"relative",height:"36px",margin:"8px 16px"},children:[(()=>{const o=D(a.project.startGlobalWeekNumber,a.project.durationInWeeks,s.startGlobalWeek,s.columns.length);return o?e.jsx("div",{title:`Project extent: ${a.project.durationInWeeks} weeks`,style:{...o,background:"rgb(79, 70, 229)",zIndex:1}}):null})(),a.project.phases.map(o=>{const p=D(o.startGlobalWeekNumber,o.durationInWeeks,s.startGlobalWeek,s.columns.length);return p?e.jsx("div",{title:`${o.name} (${o.durationInWeeks} weeks)`,style:{...p,background:o.color,zIndex:2},children:o.name},o.id):null})]}),e.jsxs("div",{style:{display:"flex",gap:"8px",margin:"12px 16px 8px 16px",flexWrap:"wrap",alignItems:"center"},children:[a.project.tags&&a.project.tags.length>0&&e.jsxs(e.Fragment,{children:[a.project.tags.map(o=>e.jsx(Ce,{tag:o,size:"sm"},o.id||o.name)),e.jsx("div",{style:{width:"1px",height:"16px",background:"#e5e7eb",margin:"0 4px"}})]}),a.resources.slice(0,4).map(o=>e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"4px",fontSize:"11px",color:"#6b7280"},children:[o.assignmentType===w.Person?e.jsx(K,{size:12}):e.jsx(Y,{size:12}),o.name,o.assignmentType===w.Person&&o.teams&&o.teams.length>0&&e.jsxs("span",{style:{fontSize:"10px",color:"#9ca3af",background:"#f1f5f9",padding:"1px 4px",borderRadius:"2px",marginLeft:"2px"},title:`Member of: ${o.teams.map(p=>p.name).join(", ")}`,children:[o.teams.length,"T"]})]},`${o.id}-summary`)),a.resources.length>4&&e.jsxs("span",{style:{fontSize:"11px",color:"#9ca3af"},children:["+",a.resources.length-4," ","more"]})]})]})]}),g.has(a.project.id)&&e.jsx("div",{style:{background:"#fefefe",borderTop:"1px solid #f1f5f9"},children:e.jsxs("div",{style:{borderTop:"1px solid #f1f5f9"},children:[e.jsxs("div",{style:{display:"flex"},children:[e.jsx("div",{style:{width:"300px",padding:"16px 16px 8px 16px",borderRight:"1px solid #e5e7eb",fontSize:"13px",color:"#6b7280",fontWeight:"500"},children:"Resource Allocation"}),e.jsx("div",{style:{flex:1}})]}),a.resources.map(o=>e.jsxs("div",{style:{display:"flex",minHeight:"40px",borderTop:"1px solid #f9fafb"},children:[e.jsxs("div",{style:{width:"300px",padding:"8px 16px",borderRight:"1px solid #e5e7eb",fontSize:"12px",color:"#475569",display:"flex",alignItems:"center",gap:"8px"},children:[o.assignmentType===w.Person?e.jsx(K,{size:14}):e.jsx(Y,{size:14}),o.name,o.assignmentType===w.Person&&o.teams&&o.teams.length>0&&e.jsx("span",{style:{fontSize:"10px",color:"#6b7280",background:"#f1f5f9",padding:"2px 4px",borderRadius:"3px",marginLeft:"4px"},title:`Member of: ${o.teams.map(p=>p.name).join(", ")}`,children:o.teams.length===1?"1 team":`${o.teams.length} teams`})]}),e.jsx("div",{style:{flex:1,position:"relative",padding:"2px 0"},children:e.jsx("div",{style:{position:"relative",height:"24px",margin:"0"},children:s.columns.map(p=>{const y=o.allocations.find(n=>n.globalWeekNumber===p.globalWeekNumber),R=a.project.canEdit||a.project.canEditResources;return e.jsx(es,{allocation:y||null,resource:o,project:a.project,globalWeekNumber:p.globalWeekNumber,canEdit:R,onAllocationChange:T,getBarStyles:(n,k)=>$(n,k),calculateTotalWeeklyAllocation:M},`${o.id}-${p.globalWeekNumber}`)})})})]},o.id)),(a.project.canEdit||a.project.canEditResources)&&e.jsxs("div",{style:{display:"flex",minHeight:"40px",borderTop:"1px solid #f9fafb"},children:[e.jsx("div",{style:{width:"300px",padding:"8px 16px",borderRight:"1px solid #e5e7eb",fontSize:"12px",color:"#6b7280",display:"flex",alignItems:"center",gap:"8px"},children:e.jsx("span",{style:{fontStyle:"italic"},children:"Add Resource"})}),e.jsx("div",{style:{flex:1,position:"relative",padding:"2px 0"},children:e.jsx("div",{style:{position:"relative",height:"24px",margin:"0"},children:s.columns.map(o=>e.jsx(ss,{project:a.project,globalWeekNumber:o.globalWeekNumber,canEdit:!0,onResourceAndAllocationSelect:C,getBarStyles:(p,y)=>$(p,y)},`add-resource-${a.project.id}-${o.globalWeekNumber}`))})})]})]})})]},a.project.id))})]})},ls=(s,c)=>{const t=ne(),d=s?new URLSearchParams(Object.fromEntries(Object.entries(s).filter(([,i])=>i!=null))).toString():"",l=`${re}/api/resources/dashboard-data${d?`?${d}`:""}`;return ue({queryKey:["resources-dashboard-data",s],queryFn:async()=>{const i=await t(l);return ie(i)},...c})},ds=({timelineData:s,requestParams:c})=>{const{data:t,isLoading:d,error:l}=ls(c),r=(t==null?void 0:t.resources)||[],[i,x]=j.useState(new Set),[u,f]=j.useState([]),[g,U]=j.useState(!1),{tooltipProps:E,TooltipPortal:S}=X(),W=j.useMemo(()=>{const h=new Map;return r.forEach(B=>{B.projectDetails.forEach(b=>{var N;(N=b.project.tags)==null||N.forEach(m=>{m.id&&h.set(m.id,m)})})}),Array.from(h.values()).sort((B,b)=>B.name.localeCompare(b.name))},[r]),A=j.useMemo(()=>{if(u.length===0)return r;const h=new Set(u.map(B=>B.id).filter(Boolean));return r.filter(B=>B.projectDetails.some(b=>{var N;return(N=b.project.tags)==null?void 0:N.some(m=>m.id&&h.has(m.id))}))},[r,u]),I=j.useCallback((h,B,b,N)=>{const m=h+B-1,P=b+N-1;if(m<b||h>P)return null;const M=Math.max(h,b),T=Math.min(m,P),G=M-b,F=T-M+1;if(F<=0)return null;const C=G/N*100,$=F/N*100;return{position:"absolute",left:`${C}%`,width:`${$}%`,height:"24px",borderRadius:"4px",display:"flex",alignItems:"center",justifyContent:"center",color:"white",fontSize:"11px",fontWeight:"500",boxShadow:"0 1px 3px rgba(0,0,0,0.1)",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",padding:"0 4px"}},[]),z=h=>{x(B=>{const b=new Set(B);return b.has(h)?b.delete(h):b.add(h),b})},H=(h,B)=>h.allocations.find(b=>b.globalWeekNumber===B);return e.jsxs("div",{children:[e.jsx(je,{timelineData:s,title:"Resources",onToggleFilter:()=>U(!g),isFilterVisible:g,hasActiveFilters:u.length>0}),e.jsx(S,{}),W.length>0&&g&&e.jsxs("div",{style:{display:"flex",background:"white",borderBottom:"1px solid #f1f5f9",minHeight:"50px"},children:[e.jsxs("div",{style:{width:"300px",padding:"12px 16px",borderRight:"1px solid #e5e7eb",display:"flex",alignItems:"center",gap:"8px"},children:[e.jsx(ge,{size:16,className:"text-muted"}),e.jsx("span",{style:{fontSize:"13px",color:"#6b7280"},children:"Filter by tags:"})]}),e.jsxs("div",{style:{flex:1,padding:"8px 16px",display:"flex",alignItems:"center",gap:"12px"},children:[e.jsx("div",{style:{flex:1,maxWidth:"400px"},children:e.jsx(be,{selectedTags:u,onChange:f,placeholder:"Select tags to filter resources..."})}),u.length>0&&e.jsxs("span",{style:{fontSize:"12px",color:"#6b7280",whiteSpace:"nowrap"},children:["Showing ",A.length," of"," ",r.length," resources"]})]})]}),e.jsxs("div",{style:{background:"white"},children:[d&&e.jsx("div",{children:"Loading resources..."}),l&&e.jsxs("div",{children:["Error: ",l.message]}),!d&&!l&&A.length===0&&e.jsx("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",height:"200px",fontSize:"16px",color:"#6b7280"},children:u.length>0?"No resources match the selected tags":"No resources found"}),!d&&!l&&A.map(h=>e.jsxs("div",{style:{borderBottom:"1px solid #f1f5f9"},children:[e.jsxs("div",{style:{display:"flex",minHeight:"50px",cursor:"pointer"},onClick:()=>z(h.id),children:[e.jsxs("div",{style:{width:"300px",padding:"8px 16px",borderRight:"1px solid #e5e7eb",display:"flex",alignItems:"center",gap:"8px",background:i.has(h.id)?"#f8fafc":"white"},children:[e.jsx("span",{style:{color:"#64748b"},children:h.type===w.Person?e.jsx(K,{size:16}):e.jsx(Y,{size:16})}),e.jsx("span",{style:{fontWeight:500,color:"#1e293b"},children:h.name}),h.type===w.Person&&h.teams&&h.teams.length>0&&e.jsx("span",{style:{fontSize:"11px",color:"#6b7280",background:"#f1f5f9",padding:"2px 6px",borderRadius:"4px",marginLeft:"8px"},title:`Member of: ${h.teams.map(B=>B.name).join(", ")}`,children:h.teams.length===1?"1 team":`${h.teams.length} teams`}),e.jsx("span",{style:{marginLeft:"auto",fontSize:"18px",color:"#9ca3af"},children:i.has(h.id)?"▼":"▶"})]}),e.jsx("div",{style:{flex:1,display:"flex",background:"#fdfdfd",position:"relative"},children:s.columns.map((B,b)=>{const N=H(h,B.globalWeekNumber);let m=0,P=0,M=0,T=null;if(h.type===w.Person){T=pe(h.id,B.globalWeekNumber,r),m=T.totalHoursBAU+T.totalHoursNonBAU;const C=T.availableHours??40;P=T.totalHoursBAU/C,M=T.totalHoursNonBAU/C}else m=N?N.totalHoursBAU+N.totalHoursNonBAU:0,P=(N==null?void 0:N.allocationPercentageBAU)??0,M=(N==null?void 0:N.allocationPercentageNonBAU)??0;const G=ve(P,M);let F=`Week ${B.weekOfYear} (${B.year}): `;if(h.type===w.Person&&T){const C=Math.round((P+M)*100);F+=`${C}% (${m.toFixed(1)} hrs total)`,T.teamHoursBAU+T.teamHoursNonBAU>0&&(F+=` - Direct: ${(T.directHoursBAU+T.directHoursNonBAU).toFixed(1)}h, Team: ${(T.teamHoursBAU+T.teamHoursNonBAU).toFixed(1)}h`)}else F+=m>0?`${Math.round((P+M)*100)}% (${m.toFixed(1)} hrs)`:"No allocation";return e.jsx("div",{title:F,style:{flex:1,borderRight:"1px solid #f1f5f9",background:G,minWidth:"50px",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"11px",fontWeight:"500",color:m>0?"white":"#9ca3af"},children:m>0?`${m.toFixed(0)}h`:""},b)})})]}),i.has(h.id)&&e.jsx("div",{style:{background:"#fefefe",borderTop:"1px solid #f1f5f9"},children:h.projectDetails.length===0?e.jsxs("div",{style:{display:"flex",padding:"16px",color:"#6b7280",fontSize:"12px"},children:[e.jsx("div",{style:{width:"300px",borderRight:"1px solid #e5e7eb"}}),e.jsx("div",{style:{flex:1,paddingLeft:"16px"},children:"No project allocations in this time range."})]}):h.projectDetails.map(B=>e.jsx("div",{style:{borderBottom:"1px solid #f9fafb"},children:e.jsxs("div",{style:{display:"flex",minHeight:"40px"},children:[e.jsx("div",{style:{width:"300px",padding:"12px 16px",borderRight:"1px solid #e5e7eb",fontSize:"13px",color:"#6b7280",fontWeight:"500",display:"flex",alignItems:"center"},children:B.project.name}),e.jsx("div",{style:{flex:1,position:"relative",display:"flex",alignItems:"center",padding:"8px 0"},children:e.jsx("div",{style:{position:"relative",height:"24px",width:"100%",margin:"0"},children:B.allocations.map(b=>{const N=I(b.globalWeekNumber,1,s.startGlobalWeek,s.columns.length);if(!N)return null;const m=h.type===w.Person?pe(h.id,b.globalWeekNumber,r):null;return e.jsx("div",{style:{...N,background:b.phaseColor||B.color,cursor:"pointer"},...E,onMouseEnter:P=>{const M=e.jsx(Ae,{allocation:{id:b.id,globalWeekNumber:b.globalWeekNumber,weekBeginningOn:b.weekBeginningOn,weekEndOn:b.weekEndOn,hoursBAU:b.hoursBAU,hoursNonBAU:b.hoursNonBAU,percentageBAU:0,percentageNonBAU:0,description:b.description,phaseName:b.phaseName,phaseColor:b.phaseColor},resourceName:h.name,projectType:B.project.name,teamAllocations:m==null?void 0:m.teamAllocations,totalWeeklyHours:m?m.totalHoursBAU+m.totalHoursNonBAU:void 0,totalWeeklyPercentage:m?(m.totalHoursBAU+m.totalHoursNonBAU)/(m.availableHours??40):void 0});E.onMouseEnter(P,M)},children:`${(b.hoursBAU+b.hoursNonBAU).toFixed(1)}h`},b.id)})})})]})},B.project.id))})]},h.id))]})]})},oe=12,ps=s=>{const c=xe(s),t=Re(c),d=l=>{const r=Ee(t,l),i=me(r),x=ye(r);return{label:`Q${i} ${x}`,globalWeek:q(r).globalWeekNumber}};return[d(0),d(1),d(2),d(4)]},cs=(s,c)=>{const t=[];for(let i=0;i<c;i++){const x=s+i,u=q(xe(x));t.push({globalWeekNumber:u.globalWeekNumber,startDate:u.mondayOfWeek,endDate:De(u.mondayOfWeek,6),label:`W${u.weekOfYear}`,month:fe(u.mondayOfWeek,"MMM"),quarter:`Q${me(u.mondayOfWeek)}`,year:ye(u.mondayOfWeek).toString(),weekOfYear:u.weekOfYear})}const d=t.reduce((i,x,u)=>{const f=`${x.month} ${x.year}`;let g=i.find(U=>U.label===f);return g||(g={label:f,startIndex:u,span:0},i.push(g)),g.span++,i},[]),l=t.reduce((i,x,u)=>{const f=`${x.quarter} ${x.year}`;let g=i.find(U=>U.label===f);return g||(g={label:f,startIndex:u,span:0},i.push(g)),g.span++,i},[]),r=t.reduce((i,x,u)=>{const f=x.year;let g=i.find(U=>U.label===f);return g||(g={label:f,startIndex:u,span:0},i.push(g)),g.span++,i},[]);return{columns:t,monthGroups:d,quarterGroups:l,yearGroups:r,startGlobalWeek:s,endGlobalWeek:s+c-1}},us=()=>{const[s,c]=j.useState("projects"),[t,d]=j.useState(()=>q(new Date).globalWeekNumber-4),l=j.useMemo(()=>cs(t,oe),[t]),r=j.useMemo(()=>{const U=q(new Date).globalWeekNumber;return ps(U)},[]),u={viewType:s,onViewTypeChange:c,onNavigate:U=>{if(U==="today"){d(q(new Date).globalWeekNumber-4);return}const E=U==="prev"?-1:1,S=Math.max(1,Math.floor(oe/2));d(W=>W+E*S)},onGoToWeek:U=>{d(U)},navOptions:r},f={timelineData:l},g={startGlobalWeekNumber:t,numberOfWeeks:oe};return e.jsxs("div",{className:"dashboard-container",style:{fontFamily:"system-ui, -apple-system, sans-serif",padding:"20px"},children:[e.jsx(Ke,{...u}),s==="projects"?e.jsx(as,{timelineData:l,requestParams:g}):e.jsx(ds,{...f,requestParams:g})]})},et=()=>e.jsx(us,{});export{et as default};
//# sourceMappingURL=DashboardPage-C5IGrrtT.js.map
