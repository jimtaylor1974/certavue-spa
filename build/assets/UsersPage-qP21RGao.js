import{b as k,c as L,d as E,h as F,r as a,j as e,I as u,bK as K,E as v,B as y,b7 as R,l as G,u as J}from"./index-kwN8UPoG.js";import{R as Y,C as A}from"./Col-3tbZRZzl.js";import{T as H}from"./Table-DqmGEuFS.js";import{S as Q}from"./Spinner-Dh-gWPre.js";import{g as V,P as X}from"./Pagination-62Q_1YwI.js";import{S as _}from"./Search-BgZkiD_X.js";import{M as I,a as M,b as T,c as O}from"./ModalFooter-BGjWCMUk.js";import{F as d,L as m}from"./Label-DetdrR8a.js";import{F as Z}from"./FormText-Cbl6G9WZ.js";import{C as ee}from"./CheckboxList-BTq97xcj.js";import{u as se}from"./useUserRegistrationBuiltIn-Dzv5Qmh8.js";import{L as te}from"./types-46npvi_j.js";import{U as ae}from"./user-plus-DuuDWjAf.js";import{M as re}from"./mouse-pointer-click-XjeC9koc.js";import"./ButtonGroup-BPzFq4yX.js";import"./CardBody-DxL1EV3t.js";import"./search-Mcy6RLxT.js";import"./chevron-left-DjnC65PD.js";import"./InputGroupText-BRavtHVL.js";const ne=s=>{const l=k();return L({mutationFn:async r=>{const n=await l(`${E}/api/auth/send-email-confirmation-email`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)});return F(n)},...s})},ie=s=>{const l=k();return L({mutationFn:async r=>{const n=await l(`${E}/api/sys/update-user`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)});return F(n)},...s})},le=({user:s})=>{const{mutate:l,isPending:r,error:n}=ne({onSuccess:()=>{R.success("Email was sent")}});return e.jsxs("div",{children:[e.jsx(v,{error:n,title:"Error sending email confirmation email",onDismiss:()=>{}}),e.jsx(y,{onClick:()=>l({userId:s.id}),disabled:r,children:"Resend confirmation email"})]})},oe=({user:s,setUser:l,onUserWasUpdated:r})=>{const[n,j]=a.useState(s.roles),[c,p]=a.useState(!1),[h,x]=a.useState(s.firstName),[g,f]=a.useState(s.lastName),[S,N]=a.useState(s.email),[C,b]=a.useState(""),[i,P]=a.useState(null),[t,U]=a.useState(null),[z,D]=a.useState(!1),{mutate:W,isPending:B,error:q}=ie({onSuccess:()=>{D(!0),R.success("User was updated")}}),w=()=>{l(null),z&&r()},$=()=>{W({userId:s.id,emailConfirmed:i!==null?i:null,userRoleNames:c?n:null,firstName:h!==s.firstName?h:null,lastName:g!==s.lastName?g:null,email:S!==s.email?S:null,password:C||null,isActive:t!==null?t:null})};return e.jsxs(I,{isOpen:!0,toggle:w,size:"lg",children:[e.jsx(M,{toggle:w,children:s.email}),e.jsxs(T,{children:[e.jsxs(d,{children:[e.jsx(m,{for:"firstName",children:"First Name"}),e.jsx(u,{id:"firstName",type:"text",value:h,onChange:o=>x(o.target.value)})]}),e.jsxs(d,{children:[e.jsx(m,{for:"lastName",children:"Last Name"}),e.jsx(u,{id:"lastName",type:"text",value:g,onChange:o=>f(o.target.value)})]}),e.jsxs(d,{children:[e.jsx(m,{for:"email",children:"Email"}),e.jsx(u,{id:"email",type:"email",value:S,onChange:o=>N(o.target.value),readOnly:s.emailConfirmed,disabled:s.emailConfirmed}),s.emailConfirmed&&e.jsx("small",{className:"text-muted",children:"Email is confirmed"})]}),e.jsxs(d,{children:[e.jsx(m,{for:"password",children:"Password"}),e.jsx(u,{id:"password",type:"password",value:C,onChange:o=>b(o.target.value)}),e.jsx(Z,{className:"text-muted small",children:"Leave blank to keep current password"})]}),e.jsx(d,{check:!0,className:"mb-3",children:e.jsxs(m,{check:!0,children:[e.jsx(u,{type:"checkbox",checked:t!==null?t:s.isActive,onChange:o=>U(o.target.checked)})," ","Active"]})}),!s.emailConfirmed&&e.jsxs(e.Fragment,{children:[e.jsx(d,{check:!0,children:e.jsxs(m,{check:!0,children:[e.jsx(u,{type:"checkbox",checked:i!==null?i:s.emailConfirmed,onChange:o=>P(o.target.checked)})," ","Confirm email"]})}),e.jsx(le,{user:s})]}),e.jsxs(d,{children:[e.jsx(m,{children:"Roles"}),e.jsx(ee,{options:K.BaseRoles,label:o=>o,selectedItems:n,setSelectedItems:o=>{j(o),p(!0)}})]}),e.jsx(v,{error:q})]}),e.jsxs(O,{children:[e.jsx(y,{color:"secondary",onClick:w,children:"Close"})," ",e.jsx(y,{color:"primary",onClick:$,disabled:B,children:"Update"})]})]})},ce=({onClose:s,onUserWasCreated:l})=>{const[r,n]=a.useState(""),[j,c]=a.useState(""),[p,h]=a.useState(""),[x,g]=a.useState(""),f=Intl.DateTimeFormat().resolvedOptions().timeZone,{mutate:S,isPending:N,error:C}=se({onSuccess:()=>{R.success("User was created successfully"),l(),s()}}),b=()=>{S({firstName:r,lastName:j,email:p,password:x,timeZone:f,redir:null})};return e.jsxs(I,{isOpen:!0,toggle:s,size:"lg",children:[e.jsx(M,{toggle:s,children:"Create New User"}),e.jsxs(T,{children:[e.jsxs(d,{children:[e.jsx(m,{for:"firstName",children:"First Name"}),e.jsx(u,{id:"firstName",type:"text",value:r,onChange:i=>n(i.target.value)})]}),e.jsxs(d,{children:[e.jsx(m,{for:"lastName",children:"Last Name"}),e.jsx(u,{id:"lastName",type:"text",value:j,onChange:i=>c(i.target.value)})]}),e.jsxs(d,{children:[e.jsx(m,{for:"email",children:"Email"}),e.jsx(u,{id:"email",type:"email",value:p,onChange:i=>h(i.target.value)})]}),e.jsxs(d,{children:[e.jsx(m,{for:"password",children:"Password"}),e.jsx(u,{id:"password",type:"password",value:x,onChange:i=>g(i.target.value)})]}),e.jsx(d,{children:e.jsx(Z,{className:"text-muted small",children:"Note: Roles will be assigned after user creation"})}),e.jsx(v,{error:C})]}),e.jsxs(O,{children:[e.jsx(y,{color:"secondary",onClick:s,children:"Cancel"})," ",e.jsx(y,{color:"primary",onClick:b,disabled:N,children:"Create"})]})]})},de=(s,l,r,n,j)=>{const c=new URLSearchParams;c.append("page",String(s)),c.append("perPage",String(l)),r&&c.append("search",r),n&&c.append("status",n);const p=`${E}/api/sys/paged-users?${c.toString()}`,h=["users",{page:s,perPage:l,search:r,status:n}],x=k();return G({queryKey:h,queryFn:async()=>{const f=await x(p);return F(f)},...j})},me=s=>s.charAt(0).toUpperCase()+s.slice(1),he=s=>(s.match(/[A-Z]{2,}(?=[A-Z][a-z]+[0-9]*|\b)|[A-Z]?[a-z]+[0-9]*|[A-Z]|[0-9]+/g)||[]).map(l=>l.toLowerCase()).join("-");function ue(s){return me(he(s).replace(/-/g," "))}const Le=()=>{const s=J(),[l,r]=a.useState(1),[n,j]=a.useState(V()),[c,p]=a.useState(""),[h,x]=a.useState(null),[g,f]=a.useState(!1),S=t=>{r(1),j(t)},{data:N,error:C,isLoading:b,refetch:i}=de(l,n,c,status==null?void 0:status.toString(),{enabled:s.isAuthenticated}),P=t=>{x(t)};return b?e.jsx(Q,{}):C?e.jsx(v,{error:C,title:"Unable to fetch users",onDismiss:()=>i()}):e.jsxs(e.Fragment,{children:[e.jsxs(Y,{className:"mb-4 align-items-center",children:[e.jsx(A,{children:e.jsx("h1",{className:"mb-0",children:"Users"})}),e.jsx(A,{xs:"auto",children:e.jsxs(y,{color:"primary",onClick:()=>f(!0),children:[e.jsx(ae,{size:18,className:"me-1"}),"Create User"]})})]}),h&&e.jsx(oe,{user:h,setUser:x,onUserWasUpdated:()=>i()}),g&&e.jsx(ce,{onClose:()=>f(!1),onUserWasCreated:()=>i()}),N&&e.jsxs(e.Fragment,{children:[e.jsx(_,{searchText:c,onSearch:p}),e.jsxs(H,{responsive:!0,children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Name"}),e.jsx("th",{children:"Email"}),e.jsx("th",{children:"Email confirmed"}),e.jsx("th",{children:"Registered"}),e.jsx("th",{children:"Roles"}),e.jsx("th",{children:"Login Providers"}),e.jsx("th",{children:"Customer Info"}),e.jsx("th",{})]})}),e.jsx("tbody",{children:N.items.map(t=>e.jsxs("tr",{className:t.isActive?"":"table-secondary",children:[e.jsxs("td",{children:[t.firstName," ",t.lastName]}),e.jsx("td",{children:t.email}),e.jsx("td",{children:t.emailConfirmed?"YES":"NO"}),e.jsx("td",{children:t.registered?"YES":"NO"}),e.jsx("td",{children:t.roles.join(", ")}),e.jsx("td",{children:t.loginProviders.map(U=>ue(te[U])).join(", ")}),e.jsx("td",{children:t.customers.map(U=>U.name).join(", ")}),e.jsx("td",{children:e.jsx("div",{className:"d-flex justify-content-end",children:e.jsx(y,{outline:!0,className:"float-end",onClick:()=>P(t),children:e.jsx(re,{})})})})]},t.id))})]}),e.jsx(X,{pagedResult:N,onPageSelected:r,perPage:n,onPerPageSelected:S})]})]})};export{Le as default};
//# sourceMappingURL=UsersPage-qP21RGao.js.map
