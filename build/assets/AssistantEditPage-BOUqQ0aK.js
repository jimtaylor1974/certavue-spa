import{b as j,l as U,d as b,h as g,c as D,v as Q,k as W,r as k,j as s,H as S,E as q,B as p,G as X,I as y,i as Y,b7 as Z}from"./index-CdmDVAN5.js";import{u as ss,C as m,D as f}from"./DisplayFormError-DxYWaAjt.js";import{u as es}from"./useConfirm-3yXjQxe5.js";import{C as ts}from"./CheckboxList-BePRNGY0.js";import{F as u,L as x}from"./Label-BdPbHP8R.js";import{T as as}from"./trash-2-CwEfktI3.js";import{P as ns}from"./play-D8SdK8nU.js";import"./ModalFooter-5JQ4cXZE.js";const is=(i,e)=>{const a=j();return U({queryKey:["assistants",i],queryFn:async()=>{const N=await a(`${b}/api/assistants/${i}`);return g(N)},...e})},rs=()=>{const i=j();return D({mutationFn:async e=>{const a=await i(`${b}/api/assistants`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});return g(a)}})},os=()=>{const i=j();return D({mutationFn:async e=>{const a=await i(`${b}/api/assistants/${e.id}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(e.update)});return g(a)}})},cs=()=>{const i=j();return D({mutationFn:async e=>{const a=await i(`${b}/api/assistants/${e}`,{method:"DELETE"});return g(a)}})},ls=i=>{const e=j();return U({queryKey:["assistants","available-tools"],queryFn:async()=>{const a=await e(`${b}/api/assistants/available-tools`);return g(a)},...i})},js=()=>{const{id:i}=Q(),e=i==="_",a=W(),{confirm:N,confirmModal:K}=es(),[L,z]=k.useState(!1),{control:l,handleSubmit:M,reset:E,watch:A,formState:{errors:r,isSubmitting:V}}=ss({defaultValues:{key:"",name:"",description:"",userInfo:"",instructions:"",toolNames:[]}}),$=A("key"),T=A("name");k.useEffect(()=>{z(!!$.trim()&&!!T.trim())},[$,T]);const{data:t,isLoading:G,error:v,refetch:B}=is(i||"",{enabled:!e}),{data:I,isLoading:O,error:R}=ls();k.useEffect(()=>{t&&E({key:t.key||"",name:t.name||"",description:t.description||"",userInfo:t.userInfo||"",instructions:t.instructions||"",toolNames:t.tools||[]})},[t,E]);const F=rs(),w=os(),C=cs(),h=V||F.isPending||w.isPending||C.isPending,P=v||F.error||w.error||C.error||R,c=h,J=()=>{t&&N("Are you sure you want to permanently delete this assistant? This action cannot be undone.",()=>{C.mutate(t.id,{onSuccess:()=>{a("/sysadmin/ai/assistants")}})})},_=async n=>{e?F.mutate(n,{onSuccess:o=>{const d=o==null?void 0:o.id;a(d?`/sysadmin/ai/assistants/${d}`:"/sysadmin/ai/assistants")}}):t&&w.mutate({id:t.id,update:n},{onSuccess:()=>{Z.success("Assistant updated successfully"),B()}})};return!e&&G?s.jsx("div",{className:"d-flex justify-content-center my-5",children:s.jsx(S,{color:"primary"})}):!e&&v?s.jsx(q,{error:v,className:"mt-3"}):!e&&!t?s.jsxs("div",{className:"alert alert-warning",children:["Assistant not found."," ",s.jsx(p,{color:"link",onClick:()=>a("/sysadmin/ai/assistants"),children:"Return to assistants"})]}):s.jsxs("div",{className:"container-fluid p-4",children:[s.jsx("div",{className:"d-flex justify-content-between align-items-center mb-4",children:s.jsxs("h2",{children:[e?"Create":"Edit"," AI Assistant"]})}),s.jsxs(X,{onSubmit:M(_),children:[s.jsxs(u,{children:[s.jsx(x,{for:"key",children:"Key"}),s.jsx(m,{name:"key",control:l,rules:{required:"Key is required",maxLength:{value:100,message:"Key cannot exceed 100 characters"},pattern:{value:/^[a-z0-9-_]+$/,message:"Key can only contain lowercase letters, numbers, hyphens, and underscores"}},render:({field:n})=>s.jsx(y,{...n,id:"key",type:"text",maxLength:100,invalid:!!r.key,disabled:c})}),s.jsx(f,{error:r.key,fieldDisplayName:"Key"}),s.jsx("small",{className:"form-text text-muted",children:"Unique identifier used by the application to retrieve this assistant"})]}),s.jsxs(u,{children:[s.jsx(x,{for:"name",children:"Name"}),s.jsx(m,{name:"name",control:l,rules:{required:"Name is required",maxLength:{value:200,message:"Name cannot exceed 200 characters"}},render:({field:n})=>s.jsx(y,{...n,id:"name",type:"text",maxLength:200,invalid:!!r.name,disabled:c})}),s.jsx(f,{error:r.name,fieldDisplayName:"Name"})]}),s.jsxs(u,{children:[s.jsx(x,{for:"description",children:"Description"}),s.jsx(m,{name:"description",control:l,rules:{maxLength:{value:500,message:"Description cannot exceed 500 characters"}},render:({field:n})=>s.jsx(y,{...n,id:"description",type:"textarea",maxLength:500,invalid:!!r.description,disabled:c,rows:3})}),s.jsx(f,{error:r.description,fieldDisplayName:"Description"})]}),s.jsxs(u,{children:[s.jsx(x,{for:"userInfo",children:"User Info"}),s.jsx(m,{name:"userInfo",control:l,rules:{maxLength:{value:1e3,message:"User Info cannot exceed 1000 characters"}},render:({field:n})=>s.jsx(y,{...n,id:"userInfo",type:"textarea",maxLength:1e3,invalid:!!r.userInfo,disabled:c,rows:3})}),s.jsx(f,{error:r.userInfo,fieldDisplayName:"User Info"}),s.jsx("small",{className:"form-text text-muted",children:"Information shown to users about what this assistant can do"})]}),s.jsxs(u,{children:[s.jsx(x,{for:"instructions",children:"Instructions (System Prompt)"}),s.jsx(m,{name:"instructions",control:l,render:({field:n})=>s.jsx(y,{...n,id:"instructions",type:"textarea",invalid:!!r.instructions,disabled:c,rows:8})}),s.jsx(f,{error:r.instructions,fieldDisplayName:"Instructions"}),s.jsx("small",{className:"form-text text-muted",children:"System prompt that defines the assistant's behavior and capabilities"})]}),s.jsxs(u,{children:[s.jsx(x,{children:"Available Tools"}),O&&s.jsx(S,{size:"sm"}),I&&s.jsx(m,{name:"toolNames",control:l,render:({field:n})=>s.jsx(ts,{options:I.map(o=>o.name),label:o=>{const d=I.find(H=>H.name===o);return d?`${d.name} - ${d.description}`:o},selectedItems:n.value,setSelectedItems:n.onChange})})]}),s.jsxs("div",{className:"d-flex justify-content-between align-items-center mt-4",children:[s.jsx("div",{children:!e&&t&&s.jsxs(p,{color:"danger",disabled:h,onClick:J,children:[s.jsx(as,{size:16,className:"me-1"}),"Delete"]})}),s.jsxs("div",{children:[!e&&t&&s.jsxs(p,{color:"success",className:"me-2",onClick:()=>a(`/sysadmin/ai/assistants/${t.key}/test`),disabled:h,children:[s.jsx(ns,{size:16,className:"me-1"}),"Test"]}),s.jsx(p,{color:"secondary",className:"me-2",onClick:()=>a("/sysadmin/ai/assistants"),disabled:h,children:"Cancel"}),s.jsx(p,{color:"primary",type:"submit",disabled:c||e&&!L,className:Y({"opacity-50":c||e&&!L}),children:h?s.jsxs(s.Fragment,{children:[s.jsx(S,{size:"sm",className:"me-1"}),e?"Creating...":"Updating..."]}):e?"Create":"Update"})]})]}),P&&s.jsx(q,{error:P,className:"mt-3"})]}),K]})};export{js as default};
//# sourceMappingURL=AssistantEditPage-BOUqQ0aK.js.map
