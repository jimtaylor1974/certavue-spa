import{b as f,c as b,d as C,h as W,z as se,r as q,R as re,j as e,e as F,E as ne,B as l,G as z,I as x,A as T,S as ae,b7 as d}from"./index-C1gMn5ii.js";import{u as L,C as g,D}from"./DisplayFormError-BC2wRnzm.js";import{R as $,C as N}from"./Col-CyLh7hzm.js";import{C as R,a as A}from"./CardBody-UDT5kdgh.js";import{C as U}from"./CardHeader-DZ8fDGUu.js";import{M as oe,a as te,b as ie,c as de}from"./ModalFooter-DJmmqsnS.js";import{T as ce}from"./Table-DD7ogEWG.js";import{F as j,L as y}from"./Label-BH3wlHv1.js";import{S as le}from"./Spinner-CxTc82sK.js";import{u as me,a as ue}from"./useGetCompanyNonWorkingDays-GhmrXhUI.js";import{C as he}from"./clock-BjB_ZzJS.js";import{R as pe,C as xe}from"./refresh-cw-DDUBZyT7.js";import{S as O}from"./save-CeTMy5MW.js";import{P as ge}from"./plus-B820_MbC.js";import{T as je}from"./trash-2-B5ooiJdI.js";const ye=a=>{const t=f();return b({mutationFn:async o=>{const n=await t(`${C}/api/working-hours/base`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(o)});return W(n)},...a})},ke=a=>{const t=f();return b({mutationFn:async o=>{const n=await t(`${C}/api/working-hours/company-non-working-days`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(o)});return W(n)},...a})},De=a=>{const t=f();return b({mutationFn:async({id:o,command:n})=>{const c=await t(`${C}/api/working-hours/company-non-working-days/${o}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)});return W(c)},...a})},Ne=a=>{const t=f();return b({mutationFn:async o=>{const n=await t(`${C}/api/working-hours/company-non-working-days/${o}`,{method:"DELETE"});return W(n)},...a})},Te=()=>{var M,B;const a=se(),[t,o]=q.useState(!1),[n,c]=q.useState(null),{data:m,isLoading:Q,error:G,refetch:J}=me(),{data:S=[],isLoading:K,error:I,refetch:V}=ue(),u=ye({onSuccess:s=>{a.setQueryData(["baseWorkingHours"],s),d.success("Base working hours updated successfully")},onError:s=>{d.error(`Failed to update base working hours: ${s.message}`)}}),h=ke({onSuccess:()=>{a.invalidateQueries({queryKey:["companyNonWorkingDays"]}),o(!1),c(null),i.reset(),d.success("Company non-working day created successfully")},onError:s=>{d.error(`Failed to create company non-working day: ${s.message}`)}}),p=De({onSuccess:()=>{a.invalidateQueries({queryKey:["companyNonWorkingDays"]}),o(!1),c(null),i.reset(),d.success("Company non-working day updated successfully")},onError:s=>{d.error(`Failed to update company non-working day: ${s.message}`)}}),H=Ne({onSuccess:()=>{a.invalidateQueries({queryKey:["companyNonWorkingDays"]}),d.success("Company non-working day deleted successfully")},onError:s=>{d.error(`Failed to delete company non-working day: ${s.message}`)}}),k=L({defaultValues:{baseHoursPerWeek:(m==null?void 0:m.baseHoursPerWeek)??40}}),i=L({defaultValues:{name:"",startDate:"",endDate:"",description:""}});re.useEffect(()=>{m&&k.reset({baseHoursPerWeek:m.baseHoursPerWeek})},[m,k]);const X=s=>{const r={baseHoursPerWeek:s.baseHoursPerWeek};u.mutate(r)},Y=s=>{if(n){const r={name:s.name,startDate:s.startDate,endDate:s.endDate,description:s.description||void 0};p.mutate({id:n.id,command:r})}else{const r={name:s.name,startDate:s.startDate,endDate:s.endDate,description:s.description||void 0};h.mutate(r)}},Z=s=>{confirm("Are you sure you want to delete this non-working day?")&&H.mutate(s)},P=s=>{s?(c(s),i.reset({name:s.name,startDate:s.startDate.split("T")[0],endDate:s.endDate.split("T")[0],description:s.description||""})):(c(null),i.reset({name:"",startDate:"",endDate:"",description:""})),o(!0)},w=()=>{o(!1),c(null)},_=()=>{J(),V()},v=Q||K,E=G||I;return v?e.jsx(F,{className:"mt-4",children:e.jsx("div",{className:"d-flex justify-content-center",children:e.jsx(le,{})})}):E?e.jsx(F,{className:"mt-4",children:e.jsx(ne,{error:E})}):e.jsxs(F,{className:"mt-4",children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-4",children:[e.jsxs("h2",{className:"mb-0",children:[e.jsx(he,{className:"me-2",size:24}),"Working Hours Management"]}),e.jsxs(l,{color:"secondary",onClick:_,disabled:v,children:[e.jsx(pe,{size:16,className:"me-1"}),"Refresh"]})]}),e.jsxs($,{children:[e.jsx(N,{md:6,children:e.jsxs(R,{className:"mb-4",children:[e.jsx(U,{children:e.jsx("h5",{className:"mb-0",children:"Base Working Hours"})}),e.jsx(A,{children:e.jsxs(z,{onSubmit:k.handleSubmit(X),children:[e.jsxs(j,{children:[e.jsx(y,{for:"baseHoursPerWeek",children:"Base Hours Per Week"}),e.jsx(g,{name:"baseHoursPerWeek",control:k.control,rules:{required:"Base hours per week is required",min:{value:1,message:"Must be at least 1 hour"},max:{value:168,message:"Cannot exceed 168 hours per week"}},render:({field:s,fieldState:r})=>e.jsxs(e.Fragment,{children:[e.jsx(x,{...s,id:"baseHoursPerWeek",type:"number",step:"0.5",min:"1",max:"168",invalid:!!r.error,onChange:ee=>s.onChange(parseFloat(ee.target.value)||0)}),e.jsx(D,{error:r.error})]})})]}),u.error&&e.jsx(T,{color:"danger",className:"mb-3",children:u.error.message}),e.jsx(l,{type:"submit",color:"primary",disabled:u.isPending,children:u.isPending?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"spinner-border spinner-border-sm me-1",role:"status",children:e.jsx("span",{className:"visually-hidden",children:"Loading..."})}),"Saving..."]}):e.jsxs(e.Fragment,{children:[e.jsx(O,{size:16,className:"me-1"}),"Save Base Hours"]})})]})})]})}),e.jsx(N,{md:6,children:e.jsxs(R,{children:[e.jsxs(U,{className:"d-flex justify-content-between align-items-center",children:[e.jsx("h5",{className:"mb-0",children:"Company Non-Working Days"}),e.jsxs(l,{color:"primary",size:"sm",onClick:()=>P(),children:[e.jsx(ge,{size:16,className:"me-1"}),"Add Non-Working Day"]})]}),e.jsx(A,{children:S.length===0?e.jsx("p",{className:"text-muted mb-0",children:"No company non-working days configured."}):e.jsxs(ce,{responsive:!0,size:"sm",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Name"}),e.jsx("th",{children:"Start Date"}),e.jsx("th",{children:"End Date"}),e.jsx("th",{children:"Actions"})]})}),e.jsx("tbody",{children:S.map(s=>e.jsxs("tr",{children:[e.jsx("td",{children:s.name}),e.jsx("td",{children:new Date(s.startDate).toLocaleDateString()}),e.jsx("td",{children:new Date(s.endDate).toLocaleDateString()}),e.jsxs("td",{children:[e.jsx(l,{color:"link",size:"sm",className:"p-0 me-2",onClick:()=>P(s),children:e.jsx(ae,{size:14})}),e.jsx(l,{color:"link",size:"sm",className:"p-0 text-danger",onClick:()=>Z(s.id),disabled:H.isPending,children:e.jsx(je,{size:14})})]})]},s.id))})]})})]})})]}),e.jsx(oe,{isOpen:t,toggle:w,children:e.jsxs(z,{onSubmit:i.handleSubmit(Y),children:[e.jsxs(te,{toggle:w,children:[e.jsx(xe,{className:"me-2",size:20}),n?"Edit":"Add"," Non-Working Day"]}),e.jsxs(ie,{children:[e.jsxs(j,{children:[e.jsx(y,{for:"name",children:"Name *"}),e.jsx(g,{name:"name",control:i.control,rules:{required:"Name is required"},render:({field:s,fieldState:r})=>e.jsxs(e.Fragment,{children:[e.jsx(x,{...s,id:"name",type:"text",placeholder:"e.g., Christmas Day, Company Shutdown",invalid:!!r.error}),e.jsx(D,{error:r.error})]})})]}),e.jsxs($,{children:[e.jsx(N,{md:6,children:e.jsxs(j,{children:[e.jsx(y,{for:"startDate",children:"Start Date *"}),e.jsx(g,{name:"startDate",control:i.control,rules:{required:"Start date is required"},render:({field:s,fieldState:r})=>e.jsxs(e.Fragment,{children:[e.jsx(x,{...s,id:"startDate",type:"date",invalid:!!r.error}),e.jsx(D,{error:r.error})]})})]})}),e.jsx(N,{md:6,children:e.jsxs(j,{children:[e.jsx(y,{for:"endDate",children:"End Date *"}),e.jsx(g,{name:"endDate",control:i.control,rules:{required:"End date is required"},render:({field:s,fieldState:r})=>e.jsxs(e.Fragment,{children:[e.jsx(x,{...s,id:"endDate",type:"date",invalid:!!r.error}),e.jsx(D,{error:r.error})]})})]})})]}),e.jsxs(j,{children:[e.jsx(y,{for:"description",children:"Description"}),e.jsx(g,{name:"description",control:i.control,render:({field:s})=>e.jsx(x,{...s,id:"description",type:"textarea",rows:3,placeholder:"Optional description..."})})]}),(h.error||p.error)&&e.jsx(T,{color:"danger",children:((M=h.error)==null?void 0:M.message)||((B=p.error)==null?void 0:B.message)})]}),e.jsxs(de,{children:[e.jsx(l,{color:"secondary",onClick:w,children:"Cancel"}),e.jsx(l,{type:"submit",color:"primary",disabled:h.isPending||p.isPending,children:h.isPending||p.isPending?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"spinner-border spinner-border-sm me-1",role:"status",children:e.jsx("span",{className:"visually-hidden",children:"Loading..."})}),n?"Updating...":"Creating..."]}):e.jsxs(e.Fragment,{children:[e.jsx(O,{size:16,className:"me-1"}),n?"Update":"Create"]})})]})]})})]})};export{Te as default};
//# sourceMappingURL=WorkingHoursManagementPage-Cmi0cR-r.js.map
