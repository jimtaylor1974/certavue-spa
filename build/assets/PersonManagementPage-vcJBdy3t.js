import{b as T,c as k,d as F,h as w,l as ke,u as ze,r as c,j as e,E as Ae,e as qe,I as g,B as o,S as de,G as pe,A as fe,b6 as M,b7 as d}from"./index-C1gMn5ii.js";import{u as ge,C as j,D as O}from"./DisplayFormError-BC2wRnzm.js";import{R as B,C as N}from"./Col-CyLh7hzm.js";import{M as C,a as E,b as L,c as ee}from"./ModalFooter-DJmmqsnS.js";import{T as me}from"./Table-DD7ogEWG.js";import{F as p,L as f}from"./Label-BH3wlHv1.js";import{T as Ze}from"./TimeZoneSelect-DZQr35x2.js";import{c as ye}from"./customerRoleOptions-BPtwxekR.js";import{g as Re,P as Ie}from"./Pagination-rz0MuaLb.js";import{u as $e}from"./useGetPagedPersons-S0K21pdF.js";import{S as Ue}from"./Spinner-CxTc82sK.js";import{S as Je}from"./search-DFKbLC0f.js";import{R as Ge,C as Ke}from"./refresh-cw-DDUBZyT7.js";import{U as ue}from"./user-plus-CfdGkzj6.js";import{T as he}from"./trash-2-B5ooiJdI.js";import"./createClass-D7IQRDUE.js";import"./floating-ui.dom-B64eMHnB.js";import"./FormText-Du_FOJen.js";import"./types-46npvi_j.js";import"./ButtonGroup-DcT2oFi_.js";import"./CardBody-UDT5kdgh.js";import"./chevron-left-C9XemoUd.js";const Be=t=>{const l=T();return k({mutationFn:async i=>{const a=await l(`${F}/api/persons`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(i)});return w(a)},...t})},Ve=t=>{const l=T();return k({mutationFn:async i=>{const a=await l(`${F}/api/persons/${i.id}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(i)});return w(a)},...t})},He=t=>{const l=T();return k({mutationFn:async i=>{const a=await l(`${F}/api/persons/${i}`,{method:"DELETE"});return w(a)},...t})},Qe=(t,l)=>{const i=T();return ke({queryKey:["personalLeave",t],queryFn:async()=>{const b=await i(`${F}/api/working-hours/personal-leave/${t}`);return w(b)},enabled:!!t,...l})},We=t=>{const l=T();return k({mutationFn:async i=>{const a=await l(`${F}/api/working-hours/personal-leave`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(i)});return w(a)},...t})},_e=t=>{const l=T();return k({mutationFn:async({id:i,command:a})=>{const m=await l(`${F}/api/working-hours/personal-leave/${i}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)});return w(m)},...t})},Xe=t=>{const l=T();return k({mutationFn:async i=>{const a=await l(`${F}/api/working-hours/personal-leave/${i}`,{method:"DELETE"});return w(a)},...t})},xe=({leave:t,onSubmit:l,onCancel:i,isSubmitting:a,submitError:m,title:b})=>{const{control:D,handleSubmit:u,formState:{errors:x}}=ge({mode:"onChange",defaultValues:{startDate:t!=null&&t.startDate?t.startDate.split("T")[0]:"",endDate:t!=null&&t.endDate?t.endDate.split("T")[0]:"",description:(t==null?void 0:t.description)||""}}),h=r=>{l(r)};return e.jsxs(pe,{onSubmit:u(h),children:[e.jsx("h5",{className:"mb-3",children:b}),e.jsxs(B,{children:[e.jsx(N,{md:6,children:e.jsxs(p,{children:[e.jsx(f,{for:"startDate",children:"Start Date *"}),e.jsx(j,{name:"startDate",control:D,rules:{required:"Start date is required"},render:({field:r})=>e.jsx(g,{...r,type:"date",id:"startDate",invalid:!!x.startDate})}),e.jsx(O,{error:x.startDate,fieldDisplayName:"Start Date"})]})}),e.jsx(N,{md:6,children:e.jsxs(p,{children:[e.jsx(f,{for:"endDate",children:"End Date *"}),e.jsx(j,{name:"endDate",control:D,rules:{required:"End date is required"},render:({field:r})=>e.jsx(g,{...r,type:"date",id:"endDate",invalid:!!x.endDate})}),e.jsx(O,{error:x.endDate,fieldDisplayName:"End Date"})]})})]}),e.jsxs(p,{children:[e.jsx(f,{for:"description",children:"Description"}),e.jsx(j,{name:"description",control:D,render:({field:r})=>e.jsx(g,{...r,type:"textarea",id:"description",placeholder:"Enter description (optional)",rows:3})})]}),m&&e.jsx(fe,{color:"danger",className:"mt-3",children:m}),e.jsxs("div",{className:"d-flex justify-content-end mt-4",children:[e.jsx(o,{color:"secondary",outline:!0,onClick:i,className:"me-2",disabled:a,children:"Cancel"}),e.jsx(o,{color:"primary",type:"submit",disabled:a,children:a?"Saving...":"Save"})]})]})},je=({person:t,onSubmit:l,onCancel:i,isSubmitting:a,submitError:m,title:b,timeZone:D})=>{const{control:u,handleSubmit:x,formState:{errors:h},setValue:r,watch:z}=ge({mode:"onChange",defaultValues:{firstName:(t==null?void 0:t.firstName)||"",lastName:(t==null?void 0:t.lastName)||"",email:(t==null?void 0:t.email)||"",jobTitle:(t==null?void 0:t.jobTitle)||"",phoneNumber:(t==null?void 0:t.phoneNumber)||"",timeZone:(t==null?void 0:t.timeZone)||D||Intl.DateTimeFormat().resolvedOptions().timeZone,roles:(t==null?void 0:t.roles)||[]}}),A=z("roles")||[],S=n=>{const y=[...A],P=y.includes(n)?y.filter(I=>I!==n):[...y,n];r("roles",P)},V=n=>{l(n)};return e.jsxs(pe,{onSubmit:x(V),children:[e.jsx("h5",{className:"mb-3",children:b}),e.jsxs(B,{children:[e.jsx(N,{md:6,children:e.jsxs(p,{children:[e.jsx(f,{for:"firstName",children:"First Name *"}),e.jsx(j,{name:"firstName",control:u,rules:{required:"First name is required"},render:({field:n})=>e.jsx(g,{...n,type:"text",id:"firstName",placeholder:"Enter first name",invalid:!!h.firstName})}),e.jsx(O,{error:h.firstName,fieldDisplayName:"First Name"})]})}),e.jsx(N,{md:6,children:e.jsxs(p,{children:[e.jsx(f,{for:"lastName",children:"Last Name *"}),e.jsx(j,{name:"lastName",control:u,rules:{required:"Last name is required"},render:({field:n})=>e.jsx(g,{...n,type:"text",id:"lastName",placeholder:"Enter last name",invalid:!!h.lastName})}),e.jsx(O,{error:h.lastName,fieldDisplayName:"Last Name"})]})})]}),e.jsxs(p,{children:[e.jsx(f,{for:"email",children:"Email *"}),e.jsx(j,{name:"email",control:u,rules:{required:"Email is required",pattern:{value:/^[A-Z0-9._%+-]+@[A-Z0-9.-]+\.[A-Z]{2,}$/i,message:"Invalid email address"}},render:({field:n})=>e.jsx(g,{...n,type:"email",id:"email",placeholder:"Enter email address",invalid:!!h.email})}),e.jsx(O,{error:h.email,fieldDisplayName:"Email"})]}),e.jsxs(B,{children:[e.jsx(N,{md:6,children:e.jsxs(p,{children:[e.jsx(f,{for:"jobTitle",children:"Job Title"}),e.jsx(j,{name:"jobTitle",control:u,render:({field:n})=>e.jsx(g,{...n,type:"text",id:"jobTitle",placeholder:"Enter job title"})})]})}),e.jsx(N,{md:6,children:e.jsxs(p,{children:[e.jsx(f,{for:"phoneNumber",children:"Phone Number"}),e.jsx(j,{name:"phoneNumber",control:u,render:({field:n})=>e.jsx(g,{...n,type:"tel",id:"phoneNumber",placeholder:"Enter phone number"})})]})})]}),e.jsx(j,{name:"timeZone",control:u,rules:{required:"Time zone is required"},render:({field:n,fieldState:y})=>e.jsxs(e.Fragment,{children:[e.jsx(Ze,{value:n.value,onChange:n.onChange,className:"mb-3",label:"Timezone"}),y.error&&e.jsx(O,{error:y.error,fieldDisplayName:"Time Zone"})]})}),e.jsxs(p,{children:[e.jsx(f,{children:"Roles"}),e.jsx("div",{className:"d-flex flex-wrap gap-2",children:ye.map(n=>e.jsx(o,{type:"button",color:A.includes(n.value)?"primary":"secondary",outline:!A.includes(n.value),size:"sm",className:"mb-2",onClick:()=>S(n.value),children:n.label.split(" (")[0]},n.value))})]}),m&&e.jsx(fe,{color:"danger",className:"mt-3",children:m}),e.jsxs("div",{className:"d-flex justify-content-end mt-4",children:[e.jsx(o,{color:"secondary",outline:!0,onClick:i,className:"me-2",disabled:a,children:"Cancel"}),e.jsx(o,{color:"primary",type:"submit",disabled:a,children:a?"Saving...":"Save"})]})]})},bs=()=>{const t=Intl.DateTimeFormat().resolvedOptions().timeZone,{isAuthenticated:l}=ze(),[i,a]=c.useState(1),[m,b]=c.useState(Re()),[D,u]=c.useState(""),[x,h]=c.useState(""),[r,z]=c.useState(null),[A,S]=c.useState(!1),[V,n]=c.useState(!1),[y,P]=c.useState(!1),[I,$]=c.useState(null),[se,U]=c.useState(!1),[Ne,q]=c.useState(!1),[be,Z]=c.useState(!1),[De,R]=c.useState(!1),[v,H]=c.useState(null),[te,J]=c.useState(null),Se=s=>{a(1),b(s)},re=()=>{u(x),a(1)},Pe=s=>{s.key==="Enter"&&re()},{data:G,error:ne,isLoading:ve,refetch:K}=$e(i,m,D,null,{enabled:l}),{data:Q,refetch:W}=Qe((r==null?void 0:r.id)||"",{enabled:!!(r!=null&&r.id)&&se}),ae=Be({onSuccess:()=>{d.success("Person created successfully"),S(!1),K()},onError:s=>{$(M(s)),d.error("Error creating person")}}),ie=Ve({onSuccess:()=>{d.success("Person updated successfully"),n(!1),K()},onError:s=>{$(M(s)),d.error("Error updating person")}}),_=He({onSuccess:()=>{d.success("Person deleted successfully"),P(!1),K()},onError:s=>{d.error(M(s))}}),le=We({onSuccess:()=>{d.success("Personal leave created successfully"),q(!1),W()},onError:s=>{J(M(s)),d.error("Error creating personal leave")}}),oe=_e({onSuccess:()=>{d.success("Personal leave updated successfully"),Z(!1),W()},onError:s=>{J(M(s)),d.error("Error updating personal leave")}}),X=Xe({onSuccess:()=>{d.success("Personal leave deleted successfully"),R(!1),W()},onError:s=>{d.error(M(s))}}),Ce=s=>{$(null),ae.mutate({firstName:s.firstName,lastName:s.lastName,email:s.email,jobTitle:s.jobTitle,phoneNumber:s.phoneNumber,timeZone:s.timeZone,roles:s.roles})},Ee=s=>{$(null),ie.mutate({id:r.id,firstName:s.firstName,lastName:s.lastName,email:s.email,jobTitle:s.jobTitle,phoneNumber:s.phoneNumber,timeZone:s.timeZone,roles:s.roles})},Le=()=>{_.mutate(r.id)},Te=s=>{J(null),le.mutate({personId:r.id,startDate:s.startDate,endDate:s.endDate,description:s.description})},Fe=s=>{J(null),oe.mutate({id:v.id,command:{startDate:s.startDate,endDate:s.endDate,description:s.description}})},we=()=>{X.mutate(v.id)},Me=s=>{z(s),U(!0)};return ve?e.jsx(Ue,{}):ne?e.jsx(Ae,{error:ne,title:"Unable to fetch people",onDismiss:()=>K()}):e.jsxs(qe,{className:"mt-5 mb-5",children:[e.jsxs(B,{className:"mb-3",children:[e.jsxs(N,{md:6,className:"d-flex",children:[e.jsx(g,{type:"text",placeholder:"Search by name or email...",value:x,onChange:s=>h(s.target.value),onKeyPress:Pe}),e.jsx(o,{color:"primary",className:"ms-2",onClick:re,children:e.jsx(Je,{size:18})}),e.jsx(o,{color:"secondary",outline:!0,className:"ms-2",onClick:()=>{h(""),u("")},children:e.jsx(Ge,{size:18})})]}),e.jsx(N,{md:6,className:"d-flex justify-content-end",children:e.jsxs(o,{color:"success",onClick:()=>S(!0),children:[e.jsx(ue,{size:18,className:"me-2"}),"Add Person"]})})]}),G&&e.jsxs(e.Fragment,{children:[e.jsxs(me,{responsive:!0,hover:!0,children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Name"}),e.jsx("th",{children:"Email"}),e.jsx("th",{children:"Job Title"}),e.jsx("th",{children:"Roles"}),e.jsx("th",{children:"Actions"})]})}),e.jsx("tbody",{children:G.items.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:5,className:"text-center py-4",children:"No people found. Add a new person to get started."})}):G.items.map(s=>e.jsxs("tr",{children:[e.jsxs("td",{children:[s.firstName," ",s.lastName]}),e.jsx("td",{children:s.email}),e.jsx("td",{children:s.jobTitle||"-"}),e.jsx("td",{children:s.roles.map(Y=>{var ce;return e.jsx("span",{className:"badge bg-primary me-1",children:((ce=ye.find(Oe=>Oe.value===Y))==null?void 0:ce.label.split(" (")[0])||Y},Y)})}),e.jsxs("td",{children:[e.jsx(o,{color:"primary",outline:!0,size:"sm",className:"me-2",onClick:()=>{z(s),n(!0)},children:e.jsx(de,{size:16})}),e.jsx(o,{color:"info",outline:!0,size:"sm",className:"me-2",onClick:()=>Me(s),title:"Manage Leave",children:e.jsx(Ke,{size:16})}),e.jsx(o,{color:"danger",outline:!0,size:"sm",onClick:()=>{z(s),P(!0)},children:e.jsx(he,{size:16})})]})]},s.id))})]}),e.jsx(Ie,{pagedResult:G,onPageSelected:a,perPage:m,onPerPageSelected:Se})]}),e.jsxs(C,{isOpen:A,toggle:()=>S(!1),size:"lg",children:[e.jsx(E,{toggle:()=>S(!1),children:"Add New Person"}),e.jsx(L,{children:e.jsx(je,{person:null,onSubmit:Ce,onCancel:()=>S(!1),isSubmitting:ae.isPending,submitError:I,title:"Person Information",timeZone:t})})]}),e.jsxs(C,{isOpen:V,toggle:()=>n(!1),size:"lg",children:[e.jsx(E,{toggle:()=>n(!1),children:"Edit Person"}),e.jsx(L,{children:r&&e.jsx(je,{person:r,onSubmit:Ee,onCancel:()=>n(!1),isSubmitting:ie.isPending,submitError:I,title:"Edit Person Information",timeZone:t})})]}),e.jsxs(C,{isOpen:y,toggle:()=>P(!1),children:[e.jsx(E,{toggle:()=>P(!1),children:"Confirm Delete"}),e.jsx(L,{children:r&&e.jsxs("p",{children:["Are you sure you want to delete"," ",e.jsxs("strong",{children:[r.firstName," ",r.lastName]}),"? This action cannot be undone."]})}),e.jsxs(ee,{children:[e.jsx(o,{color:"secondary",onClick:()=>P(!1),children:"Cancel"}),e.jsx(o,{color:"danger",onClick:Le,disabled:_.isPending,children:_.isPending?"Deleting...":"Delete"})]})]}),e.jsxs(C,{isOpen:se,toggle:()=>U(!1),size:"xl",children:[e.jsxs(E,{toggle:()=>U(!1),children:["Manage Leave - ",r==null?void 0:r.firstName," ",r==null?void 0:r.lastName]}),e.jsx(L,{children:r&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-3",children:[e.jsx("h6",{children:"Personal Leave Periods"}),e.jsxs(o,{color:"success",size:"sm",onClick:()=>{H(null),q(!0)},children:[e.jsx(ue,{size:16,className:"me-1"}),"Add Leave Period"]})]}),Q&&Q.length>0?e.jsxs(me,{responsive:!0,hover:!0,size:"sm",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Start Date"}),e.jsx("th",{children:"End Date"}),e.jsx("th",{children:"Description"}),e.jsx("th",{children:"Actions"})]})}),e.jsx("tbody",{children:Q.map(s=>e.jsxs("tr",{children:[e.jsx("td",{children:new Date(s.startDate).toLocaleDateString()}),e.jsx("td",{children:new Date(s.endDate).toLocaleDateString()}),e.jsx("td",{children:s.description||"-"}),e.jsxs("td",{children:[e.jsx(o,{color:"primary",outline:!0,size:"sm",className:"me-2",onClick:()=>{H(s),Z(!0)},children:e.jsx(de,{size:14})}),e.jsx(o,{color:"danger",outline:!0,size:"sm",onClick:()=>{H(s),R(!0)},children:e.jsx(he,{size:14})})]})]},s.id))})]}):e.jsx("div",{className:"text-center py-4 text-muted",children:'No leave periods found. Click "Add Leave Period" to get started.'})]})}),e.jsx(ee,{children:e.jsx(o,{color:"secondary",onClick:()=>U(!1),children:"Close"})})]}),e.jsxs(C,{isOpen:Ne,toggle:()=>q(!1),size:"lg",children:[e.jsx(E,{toggle:()=>q(!1),children:"Add Leave Period"}),e.jsx(L,{children:e.jsx(xe,{leave:null,onSubmit:Te,onCancel:()=>q(!1),isSubmitting:le.isPending,submitError:te,title:"Leave Period Information"})})]}),e.jsxs(C,{isOpen:be,toggle:()=>Z(!1),size:"lg",children:[e.jsx(E,{toggle:()=>Z(!1),children:"Edit Leave Period"}),e.jsx(L,{children:v&&e.jsx(xe,{leave:v,onSubmit:Fe,onCancel:()=>Z(!1),isSubmitting:oe.isPending,submitError:te,title:"Edit Leave Period Information"})})]}),e.jsxs(C,{isOpen:De,toggle:()=>R(!1),children:[e.jsx(E,{toggle:()=>R(!1),children:"Confirm Delete"}),e.jsx(L,{children:v&&e.jsxs("p",{children:["Are you sure you want to delete this leave period from"," ",e.jsx("strong",{children:new Date(v.startDate).toLocaleDateString()})," ","to"," ",e.jsx("strong",{children:new Date(v.endDate).toLocaleDateString()}),"? This action cannot be undone."]})}),e.jsxs(ee,{children:[e.jsx(o,{color:"secondary",onClick:()=>R(!1),children:"Cancel"}),e.jsx(o,{color:"danger",onClick:we,disabled:X.isPending,children:X.isPending?"Deleting...":"Delete"})]})]})]})};export{bs as default};
//# sourceMappingURL=PersonManagementPage-vcJBdy3t.js.map
