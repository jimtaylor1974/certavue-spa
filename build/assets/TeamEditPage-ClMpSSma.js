import{b as C,l as O,d as S,h as I,c as k,v as U,k as B,r as d,j as e,E as N,G as J,I as l,B as v}from"./index-C1gMn5ii.js";import{T as _}from"./Table-DD7ogEWG.js";import{F as h,L as b}from"./Label-BH3wlHv1.js";import{S as z}from"./Spinner-CxTc82sK.js";import{T as K}from"./TimeZoneSelect-DZQr35x2.js";import{u as Q,P as H}from"./PersonSelector-DyF1j3Af.js";import{T as p}from"./types-46npvi_j.js";import"./createClass-D7IQRDUE.js";import"./floating-ui.dom-B64eMHnB.js";import"./FormText-Du_FOJen.js";import"./ModalFooter-DJmmqsnS.js";import"./ListGroupItem-BL5W9WHY.js";import"./useGetPagedPersons-S0K21pdF.js";import"./Pagination-rz0MuaLb.js";import"./ButtonGroup-DcT2oFi_.js";import"./CardBody-UDT5kdgh.js";import"./search-DFKbLC0f.js";import"./chevron-left-C9XemoUd.js";import"./Search-D6GIVcns.js";import"./InputGroupText-BSChjxRD.js";import"./user-plus-CfdGkzj6.js";const V=(o,r)=>{const i=`${S}/api/teams/${o}`,n=["team",o],m=C();return O({queryKey:n,queryFn:async()=>{const u=await m(i);return I(u)},enabled:!!o&&o!=="_",...r})},W=o=>{const r=C();return k({mutationFn:async i=>{const n=await r(`${S}/api/teams`,{method:"POST",body:JSON.stringify(i),headers:{"Content-Type":"application/json"}});return I(n)},...o})},X=o=>{const r=C();return k({mutationFn:async i=>{const n=await r(`${S}/api/teams/${i.id}`,{method:"PUT",body:JSON.stringify(i),headers:{"Content-Type":"application/json"}});return I(n)},...o})},Y={name:"",description:"",timeZone:"",isActive:!0,members:[]},M=[p.Member,p.Leader],ge=()=>{const{id:o}=U(),r=o==="_",i=B(),[n,m]=d.useState(Y),[u,x]=d.useState(null),[f,T]=d.useState([]),[y,A]=d.useState(p.Member),$=Q(),{data:j,isLoading:D,error:P}=V(o||"",{enabled:!r});d.useEffect(()=>{!r&&j&&m({...j,members:j.members??[]})},[r,j]);const E=W({onSuccess:s=>i(`/teams/${s.id}`),onError:x}),F=X({onSuccess:()=>i("/teams"),onError:x}),g=s=>{const{name:t,value:c,type:a,checked:q}=s.target;m(G=>({...G,[t]:a==="checkbox"?q:c}))},w=s=>{m(t=>({...t,timeZone:s}))},Z=s=>{s.preventDefault(),x(null),r?E.mutate(n):F.mutate(n)};d.useEffect(()=>{if(f.length>0){const s=f.filter(t=>!n.members.some(c=>c.personId===t));s.length>0?$.mutate({personIds:s},{onSuccess:t=>{const c=t.map(a=>({personId:a.id,name:`${a.firstName} ${a.lastName}`,type:y}));m(a=>({...a,members:[...a.members,...c]})),T([])},onError:x}):T([])}},[f,y,n.members]);const L=s=>{m(t=>({...t,members:t.members.filter(c=>c.personId!==s)}))},R=(s,t)=>{m(c=>({...c,members:c.members.map(a=>a.personId===s?{...a,type:t}:a)}))};return D?e.jsx(z,{}):P?e.jsx(N,{error:P}):u?e.jsx(N,{error:u}):e.jsxs("div",{children:[e.jsx("h1",{children:r?"Create Team":"Edit Team"}),e.jsxs(J,{onSubmit:Z,children:[e.jsxs(h,{children:[e.jsx(b,{for:"name",children:"Name"}),e.jsx(l,{id:"name",name:"name",value:n.name,onChange:g,required:!0})]}),e.jsxs(h,{children:[e.jsx(b,{for:"description",children:"Description"}),e.jsx(l,{id:"description",name:"description",value:n.description,onChange:g})]}),e.jsx(h,{children:e.jsx(K,{value:n.timeZone||"",onChange:w})}),e.jsx(h,{check:!0,children:e.jsxs(b,{check:!0,children:[e.jsx(l,{type:"checkbox",name:"isActive",checked:n.isActive,onChange:g}),"Active"]})}),e.jsx("hr",{}),e.jsx("h4",{children:"Team Members"}),e.jsxs(_,{children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Name"}),e.jsx("th",{children:"Type"}),e.jsx("th",{})]})}),e.jsx("tbody",{children:(n.members||[]).map(s=>e.jsxs("tr",{children:[e.jsx("td",{children:s.name||s.personId}),e.jsx("td",{children:e.jsx(l,{type:"select",value:s.type,onChange:t=>R(s.personId,Number(t.target.value)),children:M.map(t=>e.jsx("option",{value:t,children:p[t]},t))})}),e.jsx("td",{children:e.jsx(v,{color:"danger",size:"sm",onClick:()=>L(s.personId),children:"Remove"})})]},s.personId))})]}),e.jsxs(h,{children:[e.jsx(b,{children:"Add Member"}),e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsx(H,{selectedPersonIds:n.members.map(s=>s.personId),onPersonSelectionChange:T,label:""}),e.jsx(l,{type:"select",className:"ms-2",value:y,onChange:s=>A(Number(s.target.value)),style:{width:120},children:M.map(s=>e.jsx("option",{value:s,children:p[s]},s))})]})]}),e.jsxs("div",{className:"d-flex justify-content-end gap-2 mt-4",children:[e.jsx(v,{color:"secondary",onClick:()=>i("/teams"),children:"Cancel"}),e.jsx(v,{color:"primary",type:"submit",disabled:E.isPending||F.isPending,children:r?"Create Team":"Save Changes"})]})]})]})};export{ge as default};
//# sourceMappingURL=TeamEditPage-ClMpSSma.js.map
