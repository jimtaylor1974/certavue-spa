import{r as b,R as B,f as R,j as h,B as k,bP as P,bL as Y,g as F,k as D,u as G,E as K}from"./index-CdmDVAN5.js";import{L as I}from"./types-46npvi_j.js";import{u as Q}from"./useSocialAuthLogin-7p1dMu-V.js";function N(a={}){const{nonce:g,onScriptLoadSuccess:c,onScriptLoadError:r}=a,[o,e]=b.useState(!1),n=b.useRef(c);n.current=c;const s=b.useRef(r);return s.current=r,b.useEffect(()=>{const l=document.createElement("script");return l.src="https://accounts.google.com/gsi/client",l.async=!0,l.defer=!0,l.nonce=g,l.onload=()=>{var p;e(!0),(p=n.current)===null||p===void 0||p.call(n)},l.onerror=()=>{var p;e(!1),(p=s.current)===null||p===void 0||p.call(s)},document.body.appendChild(l),()=>{document.body.removeChild(l)}},[g]),o}const M=b.createContext(null);function V({clientId:a,nonce:g,onScriptLoadSuccess:c,onScriptLoadError:r,children:o}){const e=N({nonce:g,onScriptLoadSuccess:c,onScriptLoadError:r}),n=b.useMemo(()=>({clientId:a,scriptLoadedSuccessfully:e}),[a,e]);return B.createElement(M.Provider,{value:n},o)}function z(){const a=b.useContext(M);if(!a)throw new Error("Google OAuth components must be used within GoogleOAuthProvider");return a}function Z({flow:a="implicit",scope:g="",onSuccess:c,onError:r,onNonOAuthError:o,overrideScope:e,state:n,...s}){const{clientId:l,scriptLoadedSuccessfully:p}=z(),f=b.useRef(),A=b.useRef(c);A.current=c;const x=b.useRef(r);x.current=r;const y=b.useRef(o);y.current=o,b.useEffect(()=>{var u,t;if(!p)return;const v=a==="implicit"?"initTokenClient":"initCodeClient",_=(t=(u=window==null?void 0:window.google)===null||u===void 0?void 0:u.accounts)===null||t===void 0?void 0:t.oauth2[v]({client_id:l,scope:e?g:`openid profile email ${g}`,callback:w=>{var m,S;if(w.error)return(m=x.current)===null||m===void 0?void 0:m.call(x,w);(S=A.current)===null||S===void 0||S.call(A,w)},error_callback:w=>{var m;(m=y.current)===null||m===void 0||m.call(y,w)},state:n,...s});f.current=_},[l,p,a,g,n]);const d=b.useCallback(u=>{var t;return(t=f.current)===null||t===void 0?void 0:t.requestAccessToken(u)},[]),i=b.useCallback(()=>{var u;return(u=f.current)===null||u===void 0?void 0:u.requestCode()},[]);return a==="implicit"?d:i}const H=({className:a,btnText:g,onSocialAuthLogin:c,onError:r})=>{const[o,e]=b.useState(!1),n=Q(),s=f=>{const A={provider:I.Google,token:f.access_token};e(!0),n.mutateAsync(A).then(c).catch(r).finally(()=>e(!1))},l=Z({onSuccess:f=>s(f),onError:f=>{console.log("Google login failed"),r(f)}}),p=h.jsx("img",{width:"22px",src:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACYAAAAmCAYAAACoPemuAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAAALXSURBVFhH7ZVfSFNRHMe/u3dryzm32lTMKYY0pBRLRUsySpOeAh8iGj0UZCFFEVHZkyRBfyToxTcfQqiHHuzBerCIEvQh6A+UIWkrM2Q4sc01Hdvudm9n2xEd2ThnovhwP3C4v9/v7uFzz+/8zjQKARsQgT43HKoYL6oYL6oYL6oYL6u6+aWxUYSePUV0woWYewqKFIFozYWuYjf0B5uxqWYv/SU/GYnFPNMIdHVC+vSBVlZGW16JnPabEAsKaYUdbjFpdAT+jmtQ5ry0kh5dVS0sXd00Y4dLLDY7A1+rE8p8gFaSiPZiaEsdUGQZ0e/jkElb42h3lMFMpARTTiLngUts7vp5SB/f04xMTm4esi+1Q7+vgVaShIfeIDTQD9ONzoyk4jCLKb5hBB8eQ/CFnWydAMFqg+VBD8Rt/OeHBebrQp5+BH2lF6ZT3yBYIjCeubBmUnGYdyz6tgpY+JKI5agVusNT0IhiIl/kTn+YRiuz3yGioUxLs/Swiw3aSAv/JBNzPbQ1g8l4GU23F2i0Mi3VWlw8oqdZetb15o9EacAAu5ihiAZAKDiBmByj2RL2rZqUlW/W0DdJLMbUPB3sh99Uk3iOR3Nw0rMTA5NDiXw5vW1ZKet4nY6+SVJsZd8HdrF8J56HinB2rgFu2Yjuz48xNe+hb//FH1TQ906iGTnMZNWWpg5LOpjFDLZGvDKeBvmbTuSzIR/aXndgyL104S4y5pvA5Sc/4fYtzVVTuQhzFnsruW7+meBvnBi4goCUOn3F2QVwbNkOUSNgMuDGV98PaGQDDJ5z0AWrYSSD2NO6mZw59lZyicUZmR3H1eF78Ib9tJKe/HALbh1wYk8JexvjsH8CpcLmQG/zXVTn7aKV/1NiKsT9o/XcUnG4d2w5o14X+lwv4fL/IoMwjXAsAqvBgnKrA432OhwiSyDtzYRVia0lmX3OOqCK8aKK8aKK8aKK8QH8Bf9b+5uOTYk3AAAAAElFTkSuQmCC",alt:""});return h.jsxs(k,{className:a,onClick:()=>l(),disabled:o,children:[p,h.jsx("span",{className:"ms-2",children:g})]})},W=({className:a,btnText:g,onError:c,onSocialAuthLogin:r})=>{const{auth:o}=R();return h.jsx(V,{clientId:o.google.clientId,children:h.jsx(H,{className:a,btnText:g,onSocialAuthLogin:r,onError:c})})};var j={exports:{}},q=j.exports,O;function $(){return O||(O=1,function(a,g){(function(r,o){a.exports=o(P())})(q,function(c){return function(r){var o={};function e(n){if(o[n])return o[n].exports;var s=o[n]={i:n,l:!1,exports:{}};return r[n].call(s.exports,s,s.exports,e),s.l=!0,s.exports}return e.m=r,e.c=o,e.i=function(n){return n},e.d=function(n,s,l){e.o(n,s)||Object.defineProperty(n,s,{configurable:!1,enumerable:!0,get:l})},e.n=function(n){var s=n&&n.__esModule?function(){return n.default}:function(){return n};return e.d(s,"a",s),s},e.o=function(n,s){return Object.prototype.hasOwnProperty.call(n,s)},e.p="",e(e.s=4)}([,function(r,o,e){Object.defineProperty(o,"__esModule",{value:!0});var n=e(2),s=e.n(n),l=function(){var d=typeof Symbol=="function"&&Symbol.for&&Symbol.for("react.element")||60103;return function(u,t,v,_){var w=u&&u.defaultProps,m=arguments.length-3;if(!t&&m!==0&&(t={}),t&&w)for(var S in w)t[S]===void 0&&(t[S]=w[S]);else t||(t=w||{});if(m===1)t.children=_;else if(m>1){for(var C=Array(m),L=0;L<m;L++)C[L]=arguments[L+3];t.children=C}return{$$typeof:d,type:u,key:v===void 0?null:""+v,ref:null,props:t,_owner:null}}}(),p=function(){function d(i,u){for(var t=0;t<u.length;t++){var v=u[t];v.enumerable=v.enumerable||!1,v.configurable=!0,"value"in v&&(v.writable=!0),Object.defineProperty(i,v.key,v)}}return function(i,u,t){return u&&d(i.prototype,u),t&&d(i,t),i}}();function f(d,i){if(!(d instanceof i))throw new TypeError("Cannot call a class as a function")}function A(d,i){if(!d)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return i&&(typeof i=="object"||typeof i=="function")?i:d}function x(d,i){if(typeof i!="function"&&i!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof i);d.prototype=Object.create(i&&i.prototype,{constructor:{value:d,enumerable:!1,writable:!0,configurable:!0}}),i&&(Object.setPrototypeOf?Object.setPrototypeOf(d,i):d.__proto__=i)}var y=function(d){x(i,d);function i(u){f(this,i);var t=A(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,u));if(t.startOAuth=t.startOAuth.bind(t),t.getOAuthUrl=t.getOAuthUrl.bind(t),!t.props.clientId)throw new Error("invalid clientId provided for react-ms-login");if(!t.props.redirectUri)throw new Error("invalid redirectUri provided for react-ms-login");return t.state={clientId:t.props.clientId,redirectUri:t.props.redirectUri,scopes:t.props.scopes||["user.read"],responseType:t.props.responseType||"token"},t.oauthUrl="https://login.microsoftonline.com/common/oauth2/v2.0/authorize",t}return p(i,[{key:"getOAuthUrl",value:function(){var t=encodeURIComponent(this.state.scopes.join(" ")),v=this.oauthUrl+"?client_id="+this.state.clientId+"&response_type="+this.state.responseType+("&redirect_uri="+encodeURIComponent(this.state.redirectUri))+("&scope="+t+"&response_mode=fragment");return v}},{key:"startOAuth",value:function(){var t=function(w,m,S,C){var L=screen.width/2-S/2,T=screen.height/2-C/2;return window.open(w,m,"toolbar=no, location=no, directories=no, status=no, menubar=no, scrollbars=no, resizable=no, copyhistory=no, width="+S+", height="+C+", top="+T+", left="+L)},v=(function(_){this.props.handleLogin(_)}).bind(this);window.authScope={authCompletedCB:v},t(this.getOAuthUrl(),"Microsoft Sign In",600,750)}},{key:"render",value:function(){var t="btn-microsoft-login "+this.props.cssClass,v="Sign in with Microsoft";return this.props.btnContent&&(typeof this.props.btnContent=="function"?v=l(this.props.btnContent,{}):v=this.props.btnContent),l("button",{type:"button",className:t,onClick:this.startOAuth},void 0,v)}}]),i}(s.a.Component);o.default=y},function(r,o){r.exports=c},,function(r,o,e){r.exports=e(1)}])})}(j)),j.exports}var J=$();const X=Y(J);var E={exports:{}},ee=E.exports,U;function te(){return U||(U=1,function(a,g){(function(r,o){a.exports=o()})(ee,function(){return function(c){var r={};function o(e){if(r[e])return r[e].exports;var n=r[e]={i:e,l:!1,exports:{}};return c[e].call(n.exports,n,n.exports,o),n.l=!0,n.exports}return o.m=c,o.c=r,o.i=function(e){return e},o.d=function(e,n,s){o.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:s})},o.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return o.d(n,"a",n),n},o.o=function(e,n){return Object.prototype.hasOwnProperty.call(e,n)},o.p="",o(o.s=3)}([function(c,r){window.ReactLoginMS={authComplete:o};function o(){function e(){return window.location.hash.indexOf("#")===0?n(window.location.hash.substr(1)):{}}function n(l){var p={},f,A,x,y,d,i,u;if(l===null)return p;f=l.split("&");for(var t=0;t<f.length;t++)A=f[t],x=A.indexOf("="),x===-1?(y=A,d=null):(y=A.substr(0,x),d=A.substr(x+1)),i=decodeURIComponent(y),u=decodeURIComponent(d),p[i]=u;return p}var s=e();window.location.hash=s.state||"",window.opener.authScope.authCompletedCB(s),window.close()}},,,function(c,r,o){c.exports=o(0)}])})}(E)),E.exports}te();function ne(...a){return(a.length===1&&Array.isArray(a[0])?a[0]:a).map(c=>c.replace(/(^\/|\/$)/g,"")).filter(c=>c!=="").join("/")}const oe=({className:a,btnText:g})=>{const{auth:c}=R(),r=h.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"21",height:"21",viewBox:"0 0 21 21",children:[h.jsx("title",{children:"MS-SymbolLockup"}),h.jsx("rect",{x:"1",y:"1",width:"9",height:"9",fill:"#f25022"}),h.jsx("rect",{x:"1",y:"11",width:"9",height:"9",fill:"#00a4ef"}),h.jsx("rect",{x:"11",y:"1",width:"9",height:"9",fill:"#7fba00"}),h.jsx("rect",{x:"11",y:"11",width:"9",height:"9",fill:"#ffb900"})]}),o=`${location.protocol}//${location.hostname}${location.port?":"+location.port:""}`;return h.jsx(X,{clientId:c.microsoft.clientId,redirectUri:ne(o,"ms_auth"),scopes:["user.read"],cssClass:`btn btn-outline-primary ${a}`,btnContent:h.jsxs(h.Fragment,{children:[r,h.jsx("span",{className:"ms-2",children:g})]}),options:{prompt:"select_account"}})},ce=({registration:a})=>{const{auth:g}=R(),[c,r]=b.useState(null),{state:o}=F(),e=D(),n=G(),s=f=>{if(f.authError){if(f.authError.error==="invalid_grant"){const{provider:A,token:x,lastName:y,firstName:d,email:i}=f;e("/user-registration-social",{state:{provider:A,token:x,lastName:y,firstName:d,email:i}});return}r(f.authError);return}if(f.authTokens){n.onAuthenticated(f.authTokens);const A=(o==null?void 0:o.redir)||"/";e(A);return}console.error(f),r("Unable to complete login or registration.")},l=f=>{r(f)},p=a?"Continue":"Login";return h.jsxs("div",{children:[g.microsoft.enabled&&h.jsx("div",{children:h.jsx(oe,{className:"btnMicrosoft mb-2",btnText:`${p} with Microsoft`})}),g.google.enabled&&h.jsx("div",{children:h.jsx(W,{className:"btnGoogle mb-2",btnText:`${p} with Google`,onSocialAuthLogin:s,onError:l})}),c?h.jsx(K,{error:c,onDismiss:()=>r(null)}):null]})};export{ce as S};
//# sourceMappingURL=SocialLogins-D2g_VlAO.js.map
