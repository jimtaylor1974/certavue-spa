import{b as R,l as te,d as I,h as ae,c as Q,r as c,R as ne,j as e,B as u,H as re,D as oe,n as ie,o as le,p as G,S as ce,G as de,I as me,x as he,v as ue,k as xe,A as pe,bJ as je}from"./index-C-RVz6Ax.js";import{R as ge,C as B}from"./Col-BQD9N-5w.js";import{C as H,a as U}from"./CardBody-sAodfdc3.js";import{M as q,a as J,b as V,c as K}from"./ModalFooter-BBfo8tpU.js";import{L as fe,a as Ne}from"./ListGroupItem-AFJGDMWK.js";import{F as ye,L as ve}from"./Label-jeggPgyg.js";import{P as Ce,a as F,b as E}from"./PaginationLink-xYSuYNVN.js";import{P as we}from"./plus-BeEwXAPw.js";import{E as Pe}from"./ellipsis-vertical-BcyswUBl.js";import{T as be}from"./trash-2-CKPOwWdS.js";import{C as ke}from"./chevron-left-D-_6Mten.js";import{A as Se}from"./arrow-left-CKa1zYBL.js";const De=(a,r={})=>{const{page:o=1,perPage:i=20,enabled:d=!0}=r,g=R();return te({queryKey:["assistants",a,"threads",{page:o,perPage:i}],queryFn:async()=>{const m=new URLSearchParams({page:o.toString(),perPage:i.toString()}),f=await g(`${I}/api/assistants/${a}/threads?${m}`);return ae(f)},enabled:d&&!!a})},Te=()=>{const a=R();return Q({mutationFn:async r=>{if(!(await a(`${I}/api/threads/${r}`,{method:"DELETE"})).ok)throw new Error("Failed to delete thread")}})},Ae=()=>{const a=R();return Q({mutationFn:async({threadId:r,name:o})=>{if(!(await a(`${I}/api/threads/${r}/name`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:o})})).ok)throw new Error("Failed to set thread name")}})},Le=({assistantKeyOrId:a,selectedThreadId:r,onThreadSelect:o,onNewThread:i,onThreadsRefetch:d,className:g=""})=>{const[m,f]=c.useState(1),[C,N]=c.useState(null),[S,y]=c.useState(!1),[D,v]=c.useState(!1),[l,t]=c.useState(null),[x,w]=c.useState(""),W=20,{data:P,isLoading:z,refetch:b}=De(a,{page:m,perPage:W,enabled:!!a}),T=Te(),A=Ae(),O=(P==null?void 0:P.items)||[],n=P;ne.useEffect(()=>{d&&d(b)},[b,d]);const L=s=>{f(s)},X=s=>{N(C===s?null:s)},Y=s=>{t(s),w(s.name||"New Conversation"),y(!0),N(null)},Z=s=>{t(s),v(!0),N(null)},$=async()=>{if(!(!l||!x.trim()))try{await A.mutateAsync({threadId:l.id,name:x.trim()}),b(),y(!1),t(null),w("")}catch(s){console.error("Failed to rename thread:",s)}},_=async()=>{if(l)try{await T.mutateAsync(l.id),b(),v(!1),t(null),r===l.id&&o("")}catch(s){console.error("Failed to delete thread:",s)}},p=()=>{y(!1),v(!1),t(null),w("")},ee=()=>{if(!n||n.totalPages<=1)return null;const s=[],h=5,M=Math.max(1,m-Math.floor(h/2)),k=Math.min(n.totalPages,M+h-1);s.push(e.jsx(F,{disabled:!n.hasPrevious,children:e.jsx(E,{onClick:()=>n.hasPrevious&&L(m-1),style:{cursor:n.hasPrevious?"pointer":"default"},children:e.jsx(ke,{size:16})})},"prev"));for(let j=M;j<=k;j++)s.push(e.jsx(F,{active:j===m,children:e.jsx(E,{onClick:()=>L(j),style:{cursor:"pointer"},children:j})},j));return s.push(e.jsx(F,{disabled:!n.hasNext,children:e.jsx(E,{onClick:()=>n.hasNext&&L(m+1),style:{cursor:n.hasNext?"pointer":"default"},children:e.jsx(he,{size:16})})},"next")),s},se=s=>{const h=new Date(s),k=(new Date().getTime()-h.getTime())/(1e3*60*60);return k<24?h.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):k<24*7?h.toLocaleDateString([],{weekday:"short"}):h.toLocaleDateString([],{month:"short",day:"numeric"})};return e.jsxs("div",{className:g,children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-3",children:[e.jsx("h5",{className:"mb-0",children:"Conversations"}),e.jsxs(u,{color:"primary",size:"sm",onClick:i,disabled:z,children:[e.jsx(we,{size:16,className:"me-1"}),"New"]})]}),z?e.jsx("div",{className:"d-flex justify-content-center py-4",children:e.jsx(re,{color:"primary"})}):e.jsxs(e.Fragment,{children:[e.jsx(fe,{className:"mb-3",children:O.length===0?e.jsxs("div",{className:"text-center text-muted py-4",children:[e.jsx("p",{children:"No conversations yet"}),e.jsx(u,{color:"outline-primary",onClick:i,children:"Start your first conversation"})]}):O.map(s=>e.jsxs(Ne,{active:r===s.id,className:"d-flex justify-content-between align-items-start p-0",children:[e.jsxs("div",{className:"flex-grow-1 p-3",style:{cursor:"pointer"},onClick:()=>o(s.id),children:[e.jsx("div",{className:"fw-medium",children:s.name||"New Conversation"}),e.jsx("small",{className:"text-muted",children:se(s.lastUpdatedAt)})]}),e.jsx("div",{className:"p-2",children:e.jsxs(oe,{isOpen:C===s.id,toggle:()=>X(s.id),children:[e.jsx(ie,{tag:"button",className:"btn btn-link p-1 border-0 bg-transparent",style:{cursor:"pointer"},onClick:h=>h.stopPropagation(),children:e.jsx(Pe,{size:16,className:"text-muted"})}),e.jsxs(le,{end:!0,children:[e.jsxs(G,{onClick:()=>Y(s),children:[e.jsx(ce,{size:14,className:"me-2"}),"Rename"]}),e.jsxs(G,{onClick:()=>Z(s),className:"text-danger",children:[e.jsx(be,{size:14,className:"me-2"}),"Delete"]})]})]})})]},s.id))}),n&&n.totalPages>1&&e.jsxs("div",{children:[e.jsx(Ce,{size:"sm",className:"justify-content-center mb-0",children:ee()}),e.jsx("div",{className:"text-center mt-2",children:e.jsxs("small",{className:"text-muted",children:["Page ",n.page," of"," ",n.totalPages,"(",n.total," ","total conversations)"]})})]})]}),e.jsxs(q,{isOpen:S,toggle:p,children:[e.jsx(J,{toggle:p,children:"Rename Conversation"}),e.jsx(V,{children:e.jsx(de,{children:e.jsxs(ye,{children:[e.jsx(ve,{for:"threadName",children:"Conversation Name"}),e.jsx(me,{type:"text",id:"threadName",value:x,onChange:s=>w(s.target.value),placeholder:"Enter conversation name",maxLength:200,onKeyPress:s=>{s.key==="Enter"&&(s.preventDefault(),$())}})]})})}),e.jsxs(K,{children:[e.jsx(u,{color:"secondary",onClick:p,children:"Cancel"}),e.jsx(u,{color:"primary",onClick:$,disabled:!x.trim()||A.isPending,children:A.isPending?"Saving...":"Save"})]})]}),e.jsxs(q,{isOpen:D,toggle:p,children:[e.jsx(J,{toggle:p,children:"Delete Conversation"}),e.jsxs(V,{children:[e.jsx("p",{children:"Are you sure you want to delete this conversation?"}),e.jsx("p",{className:"text-muted",children:e.jsx("strong",{children:(l==null?void 0:l.name)||"New Conversation"})}),e.jsx("p",{className:"text-danger small",children:"This action cannot be undone."})]}),e.jsxs(K,{children:[e.jsx(u,{color:"secondary",onClick:p,children:"Cancel"}),e.jsx(u,{color:"danger",onClick:_,disabled:T.isPending,children:T.isPending?"Deleting...":"Delete"})]})]})]})},qe=()=>{const{keyOrId:a}=ue(),r=xe(),[o,i]=c.useState(),[d,g]=c.useState(),[m,f]=c.useState(""),[C,N]=c.useState(""),S=t=>{i(t)},y=()=>{i(void 0)},D=t=>{i(t),d==null||d()},v=(t,x)=>{f(t),N(x)},l=t=>{console.error("Assistant loading error:",t)};return a?e.jsxs("div",{className:"container-fluid p-4 h-100",children:[e.jsx("div",{className:"d-flex justify-content-between align-items-center mb-4",children:e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsx(u,{color:"link",className:"p-0 me-3",onClick:()=>r("/sysadmin/ai/assistants"),children:e.jsx(Se,{size:20})}),e.jsxs("div",{children:[e.jsxs("h2",{className:"mb-0",children:["Test Assistant: ",m||"Loading..."]}),e.jsx("small",{className:"text-muted",children:C})]})]})}),e.jsxs(ge,{className:"h-100",style:{minHeight:"calc(100vh - 200px)"},children:[e.jsx(B,{md:4,lg:3,className:"h-100",children:e.jsx(H,{className:"h-100",children:e.jsx(U,{className:"p-3",children:e.jsx(Le,{assistantKeyOrId:a,selectedThreadId:o,onThreadSelect:S,onNewThread:y,onThreadsRefetch:t=>g(()=>t)})})})}),e.jsx(B,{md:8,lg:9,className:"h-100",children:e.jsx(H,{className:"h-100",children:e.jsx(U,{className:"p-0 h-100",children:e.jsx(je,{assistantKeyOrId:a,selectedThreadId:o,onThreadCreated:D,onAssistantLoaded:v,onAssistantError:l,className:"h-100"})})})})]})]}):e.jsxs(pe,{color:"warning",children:["No assistant key or ID provided."," ",e.jsx(u,{color:"link",onClick:()=>r("/sysadmin/ai/assistants"),children:"Return to assistants"})]})};export{qe as default};
//# sourceMappingURL=AssistantTestPage-DCaL0DSN.js.map
