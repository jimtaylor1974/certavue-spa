import{b as R,z as O,c as A,d as $,h as q,k as ee,r as u,j as e,H as v,A as se,B as r,bu as ne,s as te,S as ae,G as re,I as oe}from"./index-Bl7Wb9NM.js";import{R as k,C as z}from"./Col-sHY0dGyA.js";import{B as ie,a as le}from"./BreadcrumbItem-BBuRkgiO.js";import{B as N}from"./ButtonGroup-NERtQDIT.js";import{M as T,a as U,b as E,c as B}from"./ModalFooter-B8hdW-Bi.js";import{T as ce}from"./Table-krS3qWXI.js";import{F as de,L as he}from"./Label-BIINRblL.js";import{u as ue,f as pe,a as xe,g as je}from"./utility-D44KMpum.js";import{A as me,F as fe}from"./folder-C4c4higD.js";import{E as ge}from"./eye-638J84wA.js";import{T as ye}from"./trash-2-B6cN-Vgi.js";const Ce=l=>{const n=R(),c=O();return A({mutationFn:async t=>{const o=await n(`${$}/api/sys/contents/${t}`,{method:"DELETE"});return q(o)},onSuccess:()=>{c.invalidateQueries({queryKey:["contents"]})},...l})},ve=l=>{const n=R(),c=O();return A({mutationFn:async t=>{const o=await n(`${$}/api/sys/contents/move`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});return q(o)},onSuccess:()=>{c.invalidateQueries({queryKey:["contents"]})},...l})},Ue=()=>{const l=ee(),[n,c]=u.useState(""),[t,o]=u.useState(null),[x,d]=u.useState(!1),[P,j]=u.useState(""),[m,h]=u.useState(!1),{data:f,isLoading:I,isError:L,error:w,refetch:F}=ue(n),g=Ce({onSuccess:()=>{h(!1),o(null),F()}}),y=ve({onSuccess:()=>{d(!1),o(null),j(""),F()}}),M=n?n.split("/"):[],G=[{name:"Root",path:""},...M.map((s,a)=>({name:s,path:M.slice(0,a+1).join("/")}))].filter(s=>s.name),b=s=>{c(s)},Q=()=>{if(!n)return;const s=n.split("/");s.pop(),c(s.join("/"))},H=s=>{l(`/sysadmin/contents/preview/${encodeURIComponent(s.path)}`)},K=s=>{o(s),j(s.path),d(!0)},W=s=>{o(s),h(!0)},J=()=>{if(!t)return;const s={sourcePath:t.path,destinationPath:P};y.mutate(s)},_=()=>{t&&g.mutate(t.path)},V=()=>{l(`/sysadmin/contents/upload?path=${encodeURIComponent(n)}`)},p=s=>!s.includes(".")||s.endsWith("/"),C=[],D=[];f==null||f.forEach(s=>{const a=s.path.startsWith(n)?s.path.substring(n.length>0?n.length+1:0):s.path;if(a.includes("/")){const i=a.split("/")[0];C.find(Z=>Z.name===i)||C.push({path:n?`${n}/${i}`:i,fullPath:s.fullPath.substring(0,s.fullPath.indexOf(a)+i.length),name:i,size:0,contentType:"directory",lastModified:s.lastModified})}else D.push(s)});const X=[...C].sort((s,a)=>s.name.localeCompare(a.name)),Y=[...D].sort((s,a)=>s.name.localeCompare(a.name)),S=[...X,...Y];return I?e.jsx(v,{color:"primary"}):L?e.jsxs(se,{color:"danger",children:["Error loading files:"," ",w instanceof Error?w.message:"Unknown error"]}):e.jsxs(e.Fragment,{children:[e.jsx(k,{className:"mb-3",children:e.jsx(z,{children:e.jsx(ie,{children:G.map((s,a)=>e.jsx(le,{children:e.jsx("a",{href:"#",onClick:i=>{i.preventDefault(),b(s.path)},children:s.name})},a))})})}),e.jsx(k,{className:"mb-3",children:e.jsx(z,{children:e.jsxs(N,{children:[e.jsx(r,{color:"primary",onClick:V,children:"Upload Files"}),n&&e.jsxs(r,{color:"secondary",onClick:Q,children:[e.jsx(me,{size:16,className:"me-1"})," Up"]})]})})}),e.jsxs(ce,{hover:!0,responsive:!0,children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{style:{width:"40%"},children:"Name"}),e.jsx("th",{children:"Type"}),e.jsx("th",{children:"Size"}),e.jsx("th",{children:"Modified"}),e.jsx("th",{children:"Actions"})]})}),e.jsx("tbody",{children:S.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:5,className:"text-center",children:"No files found"})}):S.map(s=>e.jsxs("tr",{children:[e.jsx("td",{children:p(s.path)?e.jsxs("a",{href:"#",onClick:a=>{a.preventDefault(),b(s.path)},children:[e.jsx(fe,{className:"me-2 text-warning",size:18}),s.name]}):e.jsxs(e.Fragment,{children:[e.jsx(ne,{className:"me-2 text-info",size:18}),s.name]})}),e.jsx("td",{children:p(s.path)?"Directory":s.contentType||"Unknown"}),e.jsx("td",{children:p(s.path)?"-":pe(s.size)}),e.jsx("td",{children:xe(new Date(s.lastModified))}),e.jsx("td",{children:e.jsxs(N,{size:"sm",children:[!p(s.path)&&e.jsxs(e.Fragment,{children:[e.jsx(r,{color:"info",onClick:()=>H(s),children:e.jsx(ge,{size:16})}),e.jsx(r,{color:"secondary",tag:"a",href:je(s.path),target:"_blank",children:e.jsx(te,{size:16})})]}),e.jsx(r,{color:"warning",onClick:()=>K(s),children:e.jsx(ae,{size:16})}),e.jsx(r,{color:"danger",onClick:()=>W(s),children:e.jsx(ye,{size:16})})]})})]},s.path))})]}),e.jsxs(T,{isOpen:x,toggle:()=>d(!x),children:[e.jsxs(U,{toggle:()=>d(!x),children:["Rename/Move ",t==null?void 0:t.name]}),e.jsx(E,{children:e.jsx(re,{children:e.jsxs(de,{children:[e.jsx(he,{for:"newPath",children:"New Path"}),e.jsx(oe,{type:"text",id:"newPath",value:P,onChange:s=>j(s.target.value)})]})})}),e.jsxs(B,{children:[e.jsx(r,{color:"secondary",onClick:()=>d(!1),children:"Cancel"}),e.jsx(r,{color:"primary",onClick:J,disabled:y.isPending,children:y.isPending?e.jsx(v,{size:"sm"}):"Save"})]})]}),e.jsxs(T,{isOpen:m,toggle:()=>h(!m),children:[e.jsx(U,{toggle:()=>h(!m),children:"Delete Confirmation"}),e.jsxs(E,{children:["Are you sure you want to delete"," ",e.jsx("strong",{children:t==null?void 0:t.name}),"? This action cannot be undone."]}),e.jsxs(B,{children:[e.jsx(r,{color:"secondary",onClick:()=>h(!1),children:"Cancel"}),e.jsx(r,{color:"danger",onClick:_,disabled:g.isPending,children:g.isPending?e.jsx(v,{size:"sm"}):"Delete"})]})]})]})};export{Ue as default};
//# sourceMappingURL=ContentFileListPage-VEL7siot.js.map
