import{r as s,cr as w,ci as A,b as se,z as _e,c as Te,d as le,h as ce,l as tt,v as nt,k as rt,j as m,E as it,B as ve,G as ot,I as ye,M as at,b7 as j}from"./index-Bl7Wb9NM.js";import{R as st,C as lt}from"./Col-sHY0dGyA.js";import{C as ct,a as ut}from"./CardBody-CJUybPPm.js";import{F as Z,L as X}from"./Label-BIINRblL.js";import{u as dt,C as be,D as we}from"./DisplayFormError-DczIH31s.js";import{a as Le,_ as C}from"./createClass-DqtQTN6Q.js";import{S as Ce}from"./Spinner-B9jIRH-a.js";import{u as ht}from"./useLocalStorage-BzsSH8MJ.js";import{u as ft}from"./useUploadContentFile-DlybbBA6.js";import{v as pt}from"./v4-C6aID195.js";import{A as mt}from"./arrow-left-3DbrsKA6.js";import{S as gt}from"./save-Dwy-qhEz.js";var q,vt=new Uint8Array(16);function yt(){if(!q&&(q=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||typeof msCrypto<"u"&&typeof msCrypto.getRandomValues=="function"&&msCrypto.getRandomValues.bind(msCrypto),!q))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return q(vt)}const bt=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;function wt(r){return typeof r=="string"&&bt.test(r)}var L=[];for(var ee=0;ee<256;++ee)L.push((ee+256).toString(16).substr(1));function Ct(r){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,t=(L[r[i+0]]+L[r[i+1]]+L[r[i+2]]+L[r[i+3]]+"-"+L[r[i+4]]+L[r[i+5]]+"-"+L[r[i+6]]+L[r[i+7]]+"-"+L[r[i+8]]+L[r[i+9]]+"-"+L[r[i+10]]+L[r[i+11]]+L[r[i+12]]+L[r[i+13]]+L[r[i+14]]+L[r[i+15]]).toLowerCase();if(!wt(t))throw TypeError("Stringified UUID is invalid");return t}function Ue(r,i,t){r=r||{};var n=r.random||(r.rng||yt)();return n[6]=n[6]&15|64,n[8]=n[8]&63|128,Ct(n)}function M(r){return s.createElement("i",{className:"rmel-iconfont rmel-icon-"+r.type})}function Et(r){return s.createElement("div",{className:"rc-md-navigation "+(r.visible?"visible":"in-visible")},s.createElement("div",{className:"navigation-nav left"},s.createElement("div",{className:"button-wrap"},r.left)),s.createElement("div",{className:"navigation-nav right"},s.createElement("div",{className:"button-wrap"},r.right)))}function kt(r){return s.createElement("div",{className:"tool-bar",style:r.style},r.children)}var te={exports:{}},Ee;function St(){return Ee||(Ee=1,function(r){var i=Object.prototype.hasOwnProperty,t="~";function n(){}Object.create&&(n.prototype=Object.create(null),new n().__proto__||(t=!1));function e(c,d,u){this.fn=c,this.context=d,this.once=u||!1}function o(c,d,u,h,g){if(typeof u!="function")throw new TypeError("The listener must be a function");var y=new e(u,h||c,g),p=t?t+d:d;return c._events[p]?c._events[p].fn?c._events[p]=[c._events[p],y]:c._events[p].push(y):(c._events[p]=y,c._eventsCount++),c}function a(c,d){--c._eventsCount===0?c._events=new n:delete c._events[d]}function l(){this._events=new n,this._eventsCount=0}l.prototype.eventNames=function(){var d=[],u,h;if(this._eventsCount===0)return d;for(h in u=this._events)i.call(u,h)&&d.push(t?h.slice(1):h);return Object.getOwnPropertySymbols?d.concat(Object.getOwnPropertySymbols(u)):d},l.prototype.listeners=function(d){var u=t?t+d:d,h=this._events[u];if(!h)return[];if(h.fn)return[h.fn];for(var g=0,y=h.length,p=new Array(y);g<y;g++)p[g]=h[g].fn;return p},l.prototype.listenerCount=function(d){var u=t?t+d:d,h=this._events[u];return h?h.fn?1:h.length:0},l.prototype.emit=function(d,u,h,g,y,p){var E=t?t+d:d;if(!this._events[E])return!1;var f=this._events[E],N=arguments.length,T,k;if(f.fn){switch(f.once&&this.removeListener(d,f.fn,void 0,!0),N){case 1:return f.fn.call(f.context),!0;case 2:return f.fn.call(f.context,u),!0;case 3:return f.fn.call(f.context,u,h),!0;case 4:return f.fn.call(f.context,u,h,g),!0;case 5:return f.fn.call(f.context,u,h,g,y),!0;case 6:return f.fn.call(f.context,u,h,g,y,p),!0}for(k=1,T=new Array(N-1);k<N;k++)T[k-1]=arguments[k];f.fn.apply(f.context,T)}else{var H=f.length,K;for(k=0;k<H;k++)switch(f[k].once&&this.removeListener(d,f[k].fn,void 0,!0),N){case 1:f[k].fn.call(f[k].context);break;case 2:f[k].fn.call(f[k].context,u);break;case 3:f[k].fn.call(f[k].context,u,h);break;case 4:f[k].fn.call(f[k].context,u,h,g);break;default:if(!T)for(K=1,T=new Array(N-1);K<N;K++)T[K-1]=arguments[K];f[k].fn.apply(f[k].context,T)}}return!0},l.prototype.on=function(d,u,h){return o(this,d,u,h,!1)},l.prototype.once=function(d,u,h){return o(this,d,u,h,!0)},l.prototype.removeListener=function(d,u,h,g){var y=t?t+d:d;if(!this._events[y])return this;if(!u)return a(this,y),this;var p=this._events[y];if(p.fn)p.fn===u&&(!g||p.once)&&(!h||p.context===h)&&a(this,y);else{for(var E=0,f=[],N=p.length;E<N;E++)(p[E].fn!==u||g&&!p[E].once||h&&p[E].context!==h)&&f.push(p[E]);f.length?this._events[y]=f.length===1?f[0]:f:a(this,y)}return this},l.prototype.removeAllListeners=function(d){var u;return d?(u=t?t+d:d,this._events[u]&&a(this,u)):(this._events=new n,this._eventsCount=0),this},l.prototype.off=l.prototype.removeListener,l.prototype.addListener=l.prototype.on,l.prefixed=t,l.EventEmitter=l,r.exports=l}(te)),te.exports}var xt=St(),Ne=function(r){w(i,r);function i(){for(var t,n=arguments.length,e=new Array(n),o=0;o<n;o++)e[o]=arguments[o];return t=r.call.apply(r,[this].concat(e))||this,t.EVENT_CHANGE="a1",t.EVENT_FULL_SCREEN="a2",t.EVENT_VIEW_CHANGE="a3",t.EVENT_KEY_DOWN="a4",t.EVENT_EDITOR_KEY_DOWN="a5",t.EVENT_FOCUS="a5",t.EVENT_BLUR="a6",t.EVENT_SCROLL="a7",t.EVENT_LANG_CHANGE="b1",t}return i}(xt.EventEmitter),V=new Ne;const Mt={clearTip:"Are you sure you want to clear all contents?",btnHeader:"Header",btnClear:"Clear",btnBold:"Bold",btnItalic:"Italic",btnUnderline:"Underline",btnStrikethrough:"Strikethrough",btnUnordered:"Unordered list",btnOrdered:"Ordered list",btnQuote:"Quote",btnLineBreak:"Line break",btnInlineCode:"Inline code",btnCode:"Code",btnTable:"Table",btnImage:"Image",btnLink:"Link",btnUndo:"Undo",btnRedo:"Redo",btnFullScreen:"Full screen",btnExitFullScreen:"Exit full screen",btnModeEditor:"Only display editor",btnModePreview:"Only display preview",btnModeAll:"Display both editor and preview",selectTabMap:"Actual input when typing a Tab key",tab:"Tab",spaces:"Spaces"},_t={clearTip:"您确定要清空所有内容吗？",btnHeader:"标题",btnClear:"清空",btnBold:"加粗",btnItalic:"斜体",btnUnderline:"下划线",btnStrikethrough:"删除线",btnUnordered:"无序列表",btnOrdered:"有序列表",btnQuote:"引用",btnLineBreak:"换行",btnInlineCode:"行内代码",btnCode:"代码块",btnTable:"表格",btnImage:"图片",btnLink:"链接",btnUndo:"撤销",btnRedo:"重做",btnFullScreen:"全屏",btnExitFullScreen:"退出全屏",btnModeEditor:"仅显示编辑器",btnModePreview:"仅显示预览",btnModeAll:"显示编辑器与预览",selectTabMap:"按下 Tab 键时实际的输入",tab:"制表符",spaces:"空格"};var Tt=function(){function r(){this.langs={enUS:Mt,zhCN:_t},this.current="enUS",this.setUp()}var i=r.prototype;return i.setUp=function(){if(!(typeof window>"u")){var n="enUS";if(navigator.language){var e=navigator.language.split("-");n=e[0],e.length!==1&&(n+=e[e.length-1].toUpperCase())}if(navigator.browserLanguage){var o=navigator.browserLanguage.split("-");n=o[0],o[1]&&(n+=o[1].toUpperCase())}this.current!==n&&this.isAvailable(n)&&(this.current=n,V.emit(V.EVENT_LANG_CHANGE,this,n,this.langs[n]))}},i.isAvailable=function(n){return typeof this.langs[n]<"u"},i.add=function(n,e){this.langs[n]=e},i.setCurrent=function(n){if(!this.isAvailable(n))throw new Error("Language "+n+" is not exists");this.current!==n&&(this.current=n,V.emit(V.EVENT_LANG_CHANGE,this,n,this.langs[n]))},i.get=function(n,e){var o=this.langs[this.current][n]||"";return e&&Object.keys(e).forEach(function(a){o=o.replace(new RegExp("\\{"+a+"\\}","g"),e[a])}),o},i.getCurrent=function(){return this.current},r}(),b=new Tt,x=function(r){w(i,r);function i(){return r.apply(this,arguments)||this}var t=i.prototype;return t.getConfig=function(e,o){return typeof this.props.config[e]<"u"&&this.props.config[e]!==null?this.props.config[e]:o},Le(i,[{key:"editor",get:function(){return this.props.editor}},{key:"editorConfig",get:function(){return this.props.editorConfig}}]),i}(s.Component);x.pluginName="";x.align="left";x.defaultConfig={};var oe=function(r){w(i,r);function i(){return r.apply(this,arguments)||this}var t=i.prototype;return t.render=function(){return s.createElement("span",{className:"rc-md-divider"})},i}(x);oe.pluginName="divider";var Lt={start:0,end:0,text:""};function Ut(r,i){var t=typeof Symbol<"u"&&r[Symbol.iterator]||r["@@iterator"];if(t)return(t=t.call(r)).next.bind(t);if(Array.isArray(r)||(t=Nt(r))||i){t&&(r=t);var n=0;return function(){return n>=r.length?{done:!0}:{done:!1,value:r[n++]}}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Nt(r,i){if(r){if(typeof r=="string")return ke(r,i);var t=Object.prototype.toString.call(r).slice(8,-1);if(t==="Object"&&r.constructor&&(t=r.constructor.name),t==="Map"||t==="Set")return Array.from(r);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return ke(r,i)}}function ke(r,i){(i==null||i>r.length)&&(i=r.length);for(var t=0,n=new Array(i);t<i;t++)n[t]=r[t];return n}function ue(r){return r&&(r instanceof Promise||(typeof r=="object"||typeof r=="function")&&typeof r.then=="function")}function Dt(r,i){for(var t="",n=i;n--;)t+=r;return t}function It(r,i){var t=i.withKey,n=i.keyCode,e=i.key,o=i.aliasCommand,a={ctrlKey:r.ctrlKey,metaKey:r.metaKey,altKey:r.altKey,shiftKey:r.shiftKey,keyCode:r.keyCode,key:r.key};if(o&&(a.ctrlKey=a.ctrlKey||a.metaKey),t&&t.length>0)for(var l=Ut(t),c;!(c=l()).done;){var d=c.value;if(typeof a[d]<"u"&&!a[d])return!1}else if(a.metaKey||a.ctrlKey||a.shiftKey||a.altKey)return!1;return a.key?a.key===e:a.keyCode===n}function ne(r,i){var t=r.split(`
`),n=r.substr(0,i).split(`
`),e=n.length,o=n[n.length-1].length,a=t[n.length-1],l=n.length>1?n[n.length-2]:null,c=t.length>n.length?t[n.length]:null;return{line:e,col:o,beforeText:r.substr(0,i),afterText:r.substr(i),curLine:a,prevLine:l,nextLine:c}}var R={bold:["**","**"],italic:["*","*"],underline:["++","++"],strikethrough:["~~","~~"],quote:[`
> `,`
`],inlinecode:["`","`"],code:["\n```\n","\n```\n"]};for(var z=1;z<=6;z++)R["h"+z]=[`
`+Dt("#",z)+" ",`
`];function Kt(r){for(var i=r.row,t=i===void 0?2:i,n=r.col,e=n===void 0?2:n,o=["|"],a=["|"],l=["|"],c="",d=1;d<=e;d++)o.push(" Head |"),l.push(" --- |"),a.push(" Data |");for(var u=1;u<=t;u++)c+=`
`+a.join("");return o.join("")+`
`+l.join("")+c}function Se(r,i){var t=i;if(t.substr(0,1)!==`
`&&(t=`
`+t),r==="unordered")return t.length>1?t.replace(/\n/g,`
* `).trim():"* ";var n=1;return t.length>1?t.replace(/\n/g,function(){return`
`+n+++". "}).trim():"1. "}function re(r,i){return{text:r,newBlock:i,selection:{start:r.length,end:r.length}}}function ae(r,i,t){if(typeof R[i]<"u")return{text:""+R[i][0]+r+R[i][1],selection:{start:R[i][0].length,end:R[i][0].length+r.length}};switch(i){case"tab":var n=t.tabMapValue===1?"	":" ".repeat(t.tabMapValue),e=n+r.replace(/\n/g,`
`+n),o=r.includes(`
`)?r.match(/\n/g).length:0;return{text:e,selection:{start:t.tabMapValue,end:t.tabMapValue*(o+1)+r.length}};case"unordered":return re(Se("unordered",r),!0);case"order":return re(Se("order",r),!0);case"hr":return re("---",!0);case"table":return{text:Kt(t),newBlock:!0};case"image":return{text:"!["+(r||t.target)+"]("+(t.imageUrl||"")+")",selection:{start:2,end:r.length+2}};case"link":return{text:"["+r+"]("+(t.linkUrl||"")+")",selection:{start:1,end:r.length+1}}}return{text:r,selection:{start:0,end:r.length}}}function De(r,i){var t={};return Object.keys(r).forEach(function(n){if(typeof i[n]>"u"){t[n]=r[n];return}if(typeof i[n]=="object"){Array.isArray(i[n])?t[n]=[].concat(i[n]):t[n]=De(r[n],i[n]);return}t[n]=i[n]}),t}function Ht(r){for(var i=A({},r),t=arguments.length,n=new Array(t>1?t-1:0),e=1;e<t;e++)n[e-1]=arguments[e];return n.forEach(function(o){typeof o=="object"&&(i=De(i,o))}),i}function Ie(r,i){var t=ae("","image",{target:"Uploading_"+Ue(),imageUrl:""}).text,n=new Promise(function(e){var o=!0,a=function(d){o&&console.warn("Deprecated: onImageUpload should return a Promise, callback will be removed in future"),e(ae("","image",{target:r.name,imageUrl:d}).text)},l=i(r,a);ue(l)&&(o=!1,l.then(a))});return{placeholder:t,uploaded:n}}var xe={theme:"default",view:{menu:!0,md:!0,html:!0},canView:{menu:!0,md:!0,html:!0,both:!0,fullScreen:!0,hideMenu:!0},htmlClass:"",markdownClass:"",syncScrollMode:["rightFollowLeft","leftFollowRight"],imageUrl:"",imageAccept:"",linkUrl:"",loggerMaxSize:100,loggerInterval:600,table:{maxRow:4,maxCol:6},allowPasteImage:!0,onImageUpload:void 0,onCustomImageUpload:void 0,shortcuts:!0,onChangeTrigger:"both"},At=function(r){w(i,r);function i(n){var e;return e=r.call(this,n)||this,e.el=s.createRef(),e}var t=i.prototype;return t.getElement=function(){return this.el.current},t.getHeight=function(){return this.el.current?this.el.current.offsetHeight:0},i}(s.Component),Vt=function(r){w(i,r);function i(){return r.apply(this,arguments)||this}var t=i.prototype;return t.getHtml=function(){return typeof this.props.html=="string"?this.props.html:this.el.current?this.el.current.innerHTML:""},t.render=function(){return typeof this.props.html=="string"?s.createElement("div",{ref:this.el,dangerouslySetInnerHTML:{__html:this.props.html},className:this.props.className||"custom-html-style"}):s.createElement("div",{ref:this.el,className:this.props.className||"custom-html-style"},this.props.html)},i}(At);function ie(r,i){var t=typeof Symbol<"u"&&r[Symbol.iterator]||r["@@iterator"];if(t)return(t=t.call(r)).next.bind(t);if(Array.isArray(r)||(t=Ft(r))||i){t&&(r=t);var n=0;return function(){return n>=r.length?{done:!0}:{done:!1,value:r[n++]}}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Ft(r,i){if(r){if(typeof r=="string")return Me(r,i);var t=Object.prototype.toString.call(r).slice(8,-1);if(t==="Object"&&r.constructor&&(t=r.constructor.name),t==="Map"||t==="Set")return Array.from(r);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return Me(r,i)}}function Me(r,i){(i==null||i>r.length)&&(i=r.length);for(var t=0,n=new Array(i);t<i;t++)n[t]=r[t];return n}var S=function(r){w(i,r),i.use=function(e,o){o===void 0&&(o={});for(var a=0;a<i.plugins.length;a++)if(i.plugins[a].comp===e){i.plugins.splice(a,1,{comp:e,config:o});return}i.plugins.push({comp:e,config:o})},i.unuse=function(e){for(var o=0;o<i.plugins.length;o++)if(i.plugins[o].comp===e){i.plugins.splice(o,1);return}},i.unuseAll=function(){i.plugins=[]};function i(n){var e;return e=r.call(this,n)||this,e.nodeMdText=s.createRef(),e.nodeMdPreview=s.createRef(),e.nodeMdPreviewWrapper=s.createRef(),e.hasContentChanged=!0,e.composing=!1,e.pluginApis=new Map,e.scrollScale=1,e.isSyncingScroll=!1,e.shouldSyncScroll="md",e.keyboardListeners=[],e.emitter=new Ne,e.config=Ht(xe,e.props.config,e.props),e.state={text:(e.props.value||e.props.defaultValue||"").replace(/↵/g,`
`),html:"",view:e.config.view||xe.view,fullScreen:!1,plugins:e.getPlugins()},e.config.canView&&!e.config.canView.menu&&(e.state.view.menu=!1),e.nodeMdText=s.createRef(),e.nodeMdPreviewWrapper=s.createRef(),e.handleChange=e.handleChange.bind(C(e)),e.handlePaste=e.handlePaste.bind(C(e)),e.handleDrop=e.handleDrop.bind(C(e)),e.handleToggleMenu=e.handleToggleMenu.bind(C(e)),e.handleKeyDown=e.handleKeyDown.bind(C(e)),e.handleEditorKeyDown=e.handleEditorKeyDown.bind(C(e)),e.handleLocaleUpdate=e.handleLocaleUpdate.bind(C(e)),e.handleFocus=e.handleFocus.bind(C(e)),e.handleBlur=e.handleBlur.bind(C(e)),e.handleInputScroll=e.handleSyncScroll.bind(C(e),"md"),e.handlePreviewScroll=e.handleSyncScroll.bind(C(e),"html"),e}var t=i.prototype;return t.componentDidMount=function(){var e=this.state.text;this.renderHTML(e),V.on(V.EVENT_LANG_CHANGE,this.handleLocaleUpdate),b.setUp()},t.componentWillUnmount=function(){V.off(V.EVENT_LANG_CHANGE,this.handleLocaleUpdate)},t.componentDidUpdate=function(e){if(typeof this.props.value<"u"&&this.props.value!==this.state.text){var o=this.props.value;typeof o!="string"&&(o=String(o).toString()),o=o.replace(/↵/g,`
`),this.state.text!==o&&(this.setState({text:o}),this.renderHTML(o))}e.plugins!==this.props.plugins&&this.setState({plugins:this.getPlugins()})},t.isComposing=function(){return this.composing},t.getPlugins=function(){var e=this,o=[];if(this.props.plugins)for(var a=function(g){if(g===oe.pluginName){o.push({comp:oe,config:{}});return}for(var y=ie(i.plugins),p;!(p=y()).done;){var E=p.value;if(E.comp.pluginName===g){o.push(E);return}}},l=ie(this.props.plugins),c;!(c=l()).done;){var d=c.value;d==="fonts"?(a("font-bold"),a("font-italic"),a("font-underline"),a("font-strikethrough"),a("list-unordered"),a("list-ordered"),a("block-quote"),a("block-wrap"),a("block-code-inline"),a("block-code-block")):a(d)}else o=[].concat(i.plugins);var u={};return o.forEach(function(h){typeof u[h.comp.align]>"u"&&(u[h.comp.align]=[]);var g=h.comp.pluginName==="divider"?Ue():h.comp.pluginName;u[h.comp.align].push(s.createElement(h.comp,{editor:e,editorConfig:e.config,config:A({},h.comp.defaultConfig||{},h.config||{}),key:g}))}),u},t.handleSyncScroll=function(e,o){var a=this;if(e===this.shouldSyncScroll){this.props.onScroll&&this.props.onScroll(o,e),this.emitter.emit(this.emitter.EVENT_SCROLL,o,e);var l=this.config.syncScrollMode,c=l===void 0?[]:l;c.includes(e==="md"?"rightFollowLeft":"leftFollowRight")&&(this.hasContentChanged&&this.nodeMdText.current&&this.nodeMdPreviewWrapper.current&&(this.scrollScale=this.nodeMdText.current.scrollHeight/this.nodeMdPreviewWrapper.current.scrollHeight,this.hasContentChanged=!1),this.isSyncingScroll||(this.isSyncingScroll=!0,requestAnimationFrame(function(){a.nodeMdText.current&&a.nodeMdPreviewWrapper.current&&(e==="md"?a.nodeMdPreviewWrapper.current.scrollTop=a.nodeMdText.current.scrollTop/a.scrollScale:a.nodeMdText.current.scrollTop=a.nodeMdPreviewWrapper.current.scrollTop*a.scrollScale),a.isSyncingScroll=!1})))}},t.renderHTML=function(e){var o=this;if(!this.props.renderHTML)return console.error("renderHTML props is required!"),Promise.resolve();var a=this.props.renderHTML(e);return ue(a)?a.then(function(l){return o.setHtml(l)}):typeof a=="function"?this.setHtml(a()):this.setHtml(a)},t.setHtml=function(e){var o=this;return new Promise(function(a){o.setState({html:e},a)})},t.handleToggleMenu=function(){this.setView({menu:!this.state.view.menu})},t.handleFocus=function(e){var o=this.props.onFocus;o&&o(e),this.emitter.emit(this.emitter.EVENT_FOCUS,e)},t.handleBlur=function(e){var o=this.props.onBlur;o&&o(e),this.emitter.emit(this.emitter.EVENT_BLUR,e)},t.handleChange=function(e){e.persist();var o=e.target.value;this.setText(o,e)},t.handlePaste=function(e){if(!(!this.config.allowPasteImage||!this.config.onImageUpload)){var o=e.nativeEvent,a=(o.clipboardData||window.clipboardData).items;a&&(e.preventDefault(),this.uploadWithDataTransfer(a))}},t.handleDrop=function(e){if(this.config.onImageUpload){var o=e.nativeEvent;if(o.dataTransfer){var a=o.dataTransfer.items;a&&(e.preventDefault(),this.uploadWithDataTransfer(a))}}},t.handleEditorKeyDown=function(e){var o=this,a=e.keyCode,l=e.key,c=e.currentTarget;if((a===13||l==="Enter")&&this.composing===!1){var d=c.value,u=c.selectionStart,h=ne(d,u),g=function(){var T=c.value.substr(0,u-h.curLine.length)+c.value.substr(u);o.setText(T,void 0,{start:u-h.curLine.length,end:u-h.curLine.length}),e.preventDefault()},y=function(T){o.insertText(`
`+T,!1,{start:T.length+1,end:T.length+1}),e.preventDefault()},p=h.curLine.match(/^(\s*?)\* /);if(p){if(/^(\s*?)\* $/.test(h.curLine)){g();return}y(p[0]);return}var E=h.curLine.match(/^(\s*?)(\d+)\. /);if(E){if(/^(\s*?)(\d+)\. $/.test(h.curLine)){g();return}var f=""+E[1]+(parseInt(E[2],10)+1)+". ";y(f);return}}this.emitter.emit(this.emitter.EVENT_EDITOR_KEY_DOWN,e)},t.handleLocaleUpdate=function(){this.forceUpdate()},t.getMdElement=function(){return this.nodeMdText.current},t.getHtmlElement=function(){return this.nodeMdPreviewWrapper.current},t.clearSelection=function(){this.nodeMdText.current&&this.nodeMdText.current.setSelectionRange(0,0,"none")},t.getSelection=function(){var e=this.nodeMdText.current;if(!e)return A({},Lt);var o=e.selectionStart,a=e.selectionEnd,l=(e.value||"").slice(o,a);return{start:o,end:a,text:l}},t.setSelection=function(e){this.nodeMdText.current&&(this.nodeMdText.current.setSelectionRange(e.start,e.end,"forward"),this.nodeMdText.current.focus())},t.insertMarkdown=function(e,o){o===void 0&&(o={});var a=this.getSelection(),l=o?A({},o):{};if(e==="image"&&(l=A({},l,{target:o.target||a.text||"",imageUrl:o.imageUrl||this.config.imageUrl})),e==="link"&&(l=A({},l,{linkUrl:this.config.linkUrl})),e==="tab"&&a.start!==a.end){var c=this.getMdValue().slice(0,a.start).lastIndexOf(`
`)+1;this.setSelection({start:c,end:a.end})}var d=ae(a.text,e,l),u=d.text,h=d.selection;if(d.newBlock){var g=ne(this.getMdValue(),a.start),y=g.col,p=g.curLine;y>0&&p.length>0&&(u=`
`+u,h&&(h.start++,h.end++));var E=g.afterText;a.start!==a.end&&(E=ne(this.getMdValue(),a.end).afterText),E.trim()!==""&&E.substr(0,2)!==`

`&&(E.substr(0,1)!==`
`&&(u+=`
`),u+=`
`)}this.insertText(u,!0,h)},t.insertPlaceholder=function(e,o){var a=this;this.insertText(e,!0),o.then(function(l){var c=a.getMdValue().replace(e,l);a.setText(c)})},t.insertText=function(e,o,a){e===void 0&&(e=""),o===void 0&&(o=!1);var l=this.state.text,c=this.getSelection(),d=l.slice(0,c.start),u=l.slice(o?c.end:c.start,l.length);this.setText(d+e+u,void 0,a?{start:a.start+d.length,end:a.end+d.length}:{start:c.start,end:c.start})},t.setText=function(e,o,a){var l=this;e===void 0&&(e="");var c=this.config.onChangeTrigger,d=c===void 0?"both":c,u=e.replace(/↵/g,`
`);if(this.state.text!==e){this.setState({text:u}),this.props.onChange&&(d==="both"||d==="beforeRender")&&this.props.onChange({text:u,html:this.getHtmlValue()},o),this.emitter.emit(this.emitter.EVENT_CHANGE,e,o,typeof o>"u"),a&&setTimeout(function(){return l.setSelection(a)}),this.hasContentChanged||(this.hasContentChanged=!0);var h=this.renderHTML(u);(d==="both"||d==="afterRender")&&h.then(function(){l.props.onChange&&l.props.onChange({text:l.state.text,html:l.getHtmlValue()},o)})}},t.getMdValue=function(){return this.state.text},t.getHtmlValue=function(){return typeof this.state.html=="string"?this.state.html:this.nodeMdPreview.current?this.nodeMdPreview.current.getHtml():""},t.onKeyboard=function(e){var o=this;if(Array.isArray(e)){e.forEach(function(a){return o.onKeyboard(a)});return}this.keyboardListeners.includes(e)||this.keyboardListeners.push(e)},t.offKeyboard=function(e){var o=this;if(Array.isArray(e)){e.forEach(function(l){return o.offKeyboard(l)});return}var a=this.keyboardListeners.indexOf(e);a>=0&&this.keyboardListeners.splice(a,1)},t.handleKeyDown=function(e){for(var o=ie(this.keyboardListeners),a;!(a=o()).done;){var l=a.value;if(It(e,l)){e.preventDefault(),l.callback(e);return}}this.emitter.emit(this.emitter.EVENT_KEY_DOWN,e)},t.getEventType=function(e){switch(e){case"change":return this.emitter.EVENT_CHANGE;case"fullscreen":return this.emitter.EVENT_FULL_SCREEN;case"viewchange":return this.emitter.EVENT_VIEW_CHANGE;case"keydown":return this.emitter.EVENT_KEY_DOWN;case"editor_keydown":return this.emitter.EVENT_EDITOR_KEY_DOWN;case"blur":return this.emitter.EVENT_BLUR;case"focus":return this.emitter.EVENT_FOCUS;case"scroll":return this.emitter.EVENT_SCROLL}},t.on=function(e,o){var a=this.getEventType(e);a&&this.emitter.on(a,o)},t.off=function(e,o){var a=this.getEventType(e);a&&this.emitter.off(a,o)},t.setView=function(e){var o=this,a=A({},this.state.view,e);this.setState({view:a},function(){o.emitter.emit(o.emitter.EVENT_VIEW_CHANGE,a)})},t.getView=function(){return A({},this.state.view)},t.fullScreen=function(e){var o=this;this.state.fullScreen!==e&&this.setState({fullScreen:e},function(){o.emitter.emit(o.emitter.EVENT_FULL_SCREEN,e)})},t.registerPluginApi=function(e,o){this.pluginApis.set(e,o)},t.unregisterPluginApi=function(e){this.pluginApis.delete(e)},t.callPluginApi=function(e){var o=this.pluginApis.get(e);if(!o)throw new Error("API "+e+" not found");for(var a=arguments.length,l=new Array(a>1?a-1:0),c=1;c<a;c++)l[c-1]=arguments[c];return o.apply(void 0,l)},t.isFullScreen=function(){return this.state.fullScreen},t.uploadWithDataTransfer=function(e){var o=this,a=this.config.onImageUpload;if(a){var l=[];Array.prototype.forEach.call(e,function(c){if(c.kind==="file"&&c.type.includes("image")){var d=c.getAsFile();if(d){var u=Ie(d,a);l.push(Promise.resolve(u.placeholder)),u.uploaded.then(function(h){var g=o.getMdValue().replace(u.placeholder,h),y=h.length-u.placeholder.length,p=o.getSelection();o.setText(g,void 0,{start:p.start+y,end:p.start+y})})}}else c.kind==="string"&&c.type==="text/plain"&&l.push(new Promise(function(h){return c.getAsString(h)}))}),Promise.all(l).then(function(c){var d=c.join(""),u=o.getSelection();o.insertText(d,!0,{start:u.start===u.end?d.length:0,end:d.length})})}},t.render=function(){var e=this,o=this.state,a=o.view,l=o.fullScreen,c=o.text,d=o.html,u=this.props,h=u.id,g=u.className,y=g===void 0?"":g,p=u.style,E=u.name,f=E===void 0?"textarea":E,N=u.autoFocus,T=u.placeholder,k=u.readOnly,H=this.config.canView&&this.config.canView.hideMenu&&!this.config.canView.menu,K=function(Y){return e.state.plugins[Y]||[]},P=!!a.menu,Q=h?h+"_md":void 0,B=h?h+"_html":void 0;return s.createElement("div",{id:h,className:"rc-md-editor "+(l?"full":"")+" "+y,style:p,onKeyDown:this.handleKeyDown,onDrop:this.handleDrop},s.createElement(Et,{visible:P,left:K("left"),right:K("right")}),s.createElement("div",{className:"editor-container"},H&&s.createElement(kt,null,s.createElement("span",{className:"button button-type-menu",title:P?"hidden menu":"show menu",onClick:this.handleToggleMenu},s.createElement(M,{type:"expand-"+(P?"less":"more")}))),s.createElement("section",{className:"section sec-md "+(a.md?"visible":"in-visible")},s.createElement("textarea",{id:Q,ref:this.nodeMdText,name:f,autoFocus:N,placeholder:T,readOnly:k,value:c,className:"section-container input "+(this.config.markdownClass||""),wrap:"hard",onChange:this.handleChange,onScroll:this.handleInputScroll,onMouseOver:function(){return e.shouldSyncScroll="md"},onKeyDown:this.handleEditorKeyDown,onCompositionStart:function(){return e.composing=!0},onCompositionEnd:function(){return e.composing=!1},onPaste:this.handlePaste,onFocus:this.handleFocus,onBlur:this.handleBlur})),s.createElement("section",{className:"section sec-html "+(a.html?"visible":"in-visible")},s.createElement("div",{id:B,className:"section-container html-wrap",ref:this.nodeMdPreviewWrapper,onMouseOver:function(){return e.shouldSyncScroll="html"},onScroll:this.handlePreviewScroll},s.createElement(Vt,{html:d,className:this.config.htmlClass,ref:this.nodeMdPreview})))))},i}(s.Component);S.plugins=[];S.addLocale=b.add.bind(b);S.useLocale=b.setCurrent.bind(b);S.getLocale=b.getCurrent.bind(b);var Ke=function(r){w(i,r);function i(){return r.apply(this,arguments)||this}var t=i.prototype;return t.render=function(){var e=this;return s.createElement("span",{className:"button button-type-code-block",title:b.get("btnCode"),onClick:function(){return e.editor.insertMarkdown("code")}},s.createElement(M,{type:"code-block"}))},i}(x);Ke.pluginName="block-code-block";var He=function(r){w(i,r);function i(){return r.apply(this,arguments)||this}var t=i.prototype;return t.render=function(){var e=this;return s.createElement("span",{className:"button button-type-code-inline",title:b.get("btnInlineCode"),onClick:function(){return e.editor.insertMarkdown("inlinecode")}},s.createElement(M,{type:"code"}))},i}(x);He.pluginName="block-code-inline";var Ae=function(r){w(i,r);function i(){return r.apply(this,arguments)||this}var t=i.prototype;return t.render=function(){var e=this;return s.createElement("span",{className:"button button-type-quote",title:b.get("btnQuote"),onClick:function(){return e.editor.insertMarkdown("quote")}},s.createElement(M,{type:"quote"}))},i}(x);Ae.pluginName="block-quote";var Ve=function(r){w(i,r);function i(){return r.apply(this,arguments)||this}var t=i.prototype;return t.render=function(){var e=this;return s.createElement("span",{className:"button button-type-wrap",title:b.get("btnLineBreak"),onClick:function(){return e.editor.insertMarkdown("hr")}},s.createElement(M,{type:"wrap"}))},i}(x);Ve.pluginName="block-wrap";var Fe=function(r){w(i,r);function i(n){var e;return e=r.call(this,n)||this,e.handleClick=e.handleClick.bind(C(e)),e}var t=i.prototype;return t.handleClick=function(){if(this.editor.getMdValue()!==""&&window.confirm&&typeof window.confirm=="function"){var e=window.confirm(b.get("clearTip"));e&&this.editor.setText("")}},t.render=function(){return s.createElement("span",{className:"button button-type-clear",title:b.get("btnClear"),onClick:this.handleClick},s.createElement(M,{type:"delete"}))},i}(x);Fe.pluginName="clear";var Oe=function(r){w(i,r);function i(n){var e;return e=r.call(this,n)||this,e.handleKeyboard={key:"b",keyCode:66,aliasCommand:!0,withKey:["ctrlKey"],callback:function(){return e.editor.insertMarkdown("bold")}},e}var t=i.prototype;return t.componentDidMount=function(){this.editorConfig.shortcuts&&this.editor.onKeyboard(this.handleKeyboard)},t.componentWillUnmount=function(){this.editor.offKeyboard(this.handleKeyboard)},t.render=function(){var e=this;return s.createElement("span",{className:"button button-type-bold",title:b.get("btnBold"),onClick:function(){return e.editor.insertMarkdown("bold")}},s.createElement(M,{type:"bold"}))},i}(x);Oe.pluginName="font-bold";var We=function(r){w(i,r);function i(n){var e;return e=r.call(this,n)||this,e.handleKeyboard={key:"i",keyCode:73,aliasCommand:!0,withKey:["ctrlKey"],callback:function(){return e.editor.insertMarkdown("italic")}},e}var t=i.prototype;return t.componentDidMount=function(){this.editorConfig.shortcuts&&this.editor.onKeyboard(this.handleKeyboard)},t.componentWillUnmount=function(){this.editor.offKeyboard(this.handleKeyboard)},t.render=function(){var e=this;return s.createElement("span",{className:"button button-type-italic",title:b.get("btnItalic"),onClick:function(){return e.editor.insertMarkdown("italic")}},s.createElement(M,{type:"italic"}))},i}(x);We.pluginName="font-italic";var Re=function(r){w(i,r);function i(n){var e;return e=r.call(this,n)||this,e.handleKeyboard={key:"d",keyCode:68,aliasCommand:!0,withKey:["ctrlKey"],callback:function(){return e.editor.insertMarkdown("strikethrough")}},e}var t=i.prototype;return t.componentDidMount=function(){this.editorConfig.shortcuts&&this.editor.onKeyboard(this.handleKeyboard)},t.componentWillUnmount=function(){this.editor.offKeyboard(this.handleKeyboard)},t.render=function(){var e=this;return s.createElement("span",{className:"button button-type-strikethrough",title:b.get("btnStrikethrough"),onClick:function(){return e.editor.insertMarkdown("strikethrough")}},s.createElement(M,{type:"strikethrough"}))},i}(x);Re.pluginName="font-strikethrough";var Pe=function(r){w(i,r);function i(n){var e;return e=r.call(this,n)||this,e.handleKeyboard={key:"u",keyCode:85,withKey:["ctrlKey"],callback:function(){return e.editor.insertMarkdown("underline")}},e}var t=i.prototype;return t.componentDidMount=function(){this.editorConfig.shortcuts&&this.editor.onKeyboard(this.handleKeyboard)},t.componentWillUnmount=function(){this.editor.offKeyboard(this.handleKeyboard)},t.render=function(){var e=this;return s.createElement("span",{className:"button button-type-underline",title:b.get("btnUnderline"),onClick:function(){return e.editor.insertMarkdown("underline")}},s.createElement(M,{type:"underline"}))},i}(x);Pe.pluginName="font-underline";var de=function(r){w(i,r);function i(n){var e;return e=r.call(this,n)||this,e.handleClick=e.handleClick.bind(C(e)),e.handleChange=e.handleChange.bind(C(e)),e.state={enable:e.editor.isFullScreen()},e}var t=i.prototype;return t.handleClick=function(){this.editor.fullScreen(!this.state.enable)},t.handleChange=function(e){this.setState({enable:e})},t.componentDidMount=function(){this.editor.on("fullscreen",this.handleChange)},t.componentWillUnmount=function(){this.editor.off("fullscreen",this.handleChange)},t.render=function(){if(this.editorConfig.canView&&this.editorConfig.canView.fullScreen){var e=this.state.enable;return s.createElement("span",{className:"button button-type-fullscreen",title:b.get(e?"btnExitFullScreen":"btnFullScreen"),onClick:this.handleClick},s.createElement(M,{type:e?"fullscreen-exit":"fullscreen"}))}return null},i}(x);de.pluginName="full-screen";de.align="right";var je=function(r){w(i,r);function i(n){var e;return e=r.call(this,n)||this,e.handleClose=e.handleClose.bind(C(e)),e}var t=i.prototype;return t.handleClose=function(e){e.stopPropagation();var o=this.props.onClose;typeof o=="function"&&o()},t.render=function(){return s.createElement("div",{className:"drop-wrap "+(this.props.show?"show":"hidden"),onClick:this.handleClose},this.props.children)},i}(s.Component),Ot=function(r){w(i,r);function i(){return r.apply(this,arguments)||this}var t=i.prototype;return t.handleHeader=function(e){var o=this.props.onSelectHeader;typeof o=="function"&&o(e)},t.render=function(){return s.createElement("ul",{className:"header-list"},s.createElement("li",{className:"list-item"},s.createElement("h1",{onClick:this.handleHeader.bind(this,"h1")},"H1")),s.createElement("li",{className:"list-item"},s.createElement("h2",{onClick:this.handleHeader.bind(this,"h2")},"H2")),s.createElement("li",{className:"list-item"},s.createElement("h3",{onClick:this.handleHeader.bind(this,"h3")},"H3")),s.createElement("li",{className:"list-item"},s.createElement("h4",{onClick:this.handleHeader.bind(this,"h4")},"H4")),s.createElement("li",{className:"list-item"},s.createElement("h5",{onClick:this.handleHeader.bind(this,"h5")},"H5")),s.createElement("li",{className:"list-item"},s.createElement("h6",{onClick:this.handleHeader.bind(this,"h6")},"H6")))},i}(s.Component),Be=function(r){w(i,r);function i(n){var e;return e=r.call(this,n)||this,e.show=e.show.bind(C(e)),e.hide=e.hide.bind(C(e)),e.state={show:!1},e}var t=i.prototype;return t.show=function(){this.setState({show:!0})},t.hide=function(){this.setState({show:!1})},t.render=function(){var e=this;return s.createElement("span",{className:"button button-type-header",title:b.get("btnHeader"),onMouseEnter:this.show,onMouseLeave:this.hide},s.createElement(M,{type:"font-size"}),s.createElement(je,{show:this.state.show,onClose:this.hide},s.createElement(Ot,{onSelectHeader:function(a){return e.editor.insertMarkdown(a)}})))},i}(x);Be.pluginName="header";var Wt=function(r){w(i,r);function i(n){var e;return e=r.call(this,n)||this,e.timerId=void 0,e.locked=!1,e.input=s.createRef(),e}var t=i.prototype;return t.click=function(){var e=this;this.locked||!this.input.current||(this.locked=!0,this.input.current.value="",this.input.current.click(),this.timerId&&window.clearTimeout(this.timerId),this.timerId=window.setTimeout(function(){e.locked=!1,window.clearTimeout(e.timerId),e.timerId=void 0},200))},t.componentWillUnmount=function(){this.timerId&&window.clearTimeout(this.timerId)},t.render=function(){return s.createElement("input",{type:"file",ref:this.input,accept:this.props.accept,style:{position:"absolute",zIndex:-1,left:0,top:0,width:0,height:0,opacity:0},onChange:this.props.onChange})},i}(s.Component),$e=function(r){w(i,r);function i(n){var e;return e=r.call(this,n)||this,e.inputFile=s.createRef(),e.onImageChanged=e.onImageChanged.bind(C(e)),e.handleCustomImageUpload=e.handleCustomImageUpload.bind(C(e)),e.handleImageUpload=e.handleImageUpload.bind(C(e)),e.state={show:!1},e}var t=i.prototype;return t.handleImageUpload=function(){var e=this.editorConfig.onImageUpload;typeof e=="function"?this.inputFile.current&&this.inputFile.current.click():this.editor.insertMarkdown("image")},t.onImageChanged=function(e){var o=this.editorConfig.onImageUpload;if(o){var a=Ie(e,o);this.editor.insertPlaceholder(a.placeholder,a.uploaded)}},t.handleCustomImageUpload=function(e){var o=this,a=this.editorConfig.onCustomImageUpload;if(a){var l=a.call(this,e);ue(l)&&l.then(function(c){c&&c.url&&o.editor.insertMarkdown("image",{target:c.text,imageUrl:c.url})})}},t.render=function(){var e=this,o=!!this.editorConfig.onCustomImageUpload;return o?s.createElement("span",{className:"button button-type-image",title:b.get("btnImage"),onClick:this.handleCustomImageUpload},s.createElement(M,{type:"image"})):s.createElement("span",{className:"button button-type-image",title:b.get("btnImage"),onClick:this.handleImageUpload,style:{position:"relative"}},s.createElement(M,{type:"image"}),s.createElement(Wt,{accept:this.editorConfig.imageAccept||"",ref:this.inputFile,onChange:function(l){l.persist(),l.target.files&&l.target.files.length>0&&e.onImageChanged(l.target.files[0])}}))},i}(x);$e.pluginName="image";var Ge=function(r){w(i,r);function i(n){var e;return e=r.call(this,n)||this,e.handleKeyboard={key:"k",keyCode:75,aliasCommand:!0,withKey:["ctrlKey"],callback:function(){return e.editor.insertMarkdown("link")}},e}var t=i.prototype;return t.componentDidMount=function(){this.editorConfig.shortcuts&&this.editor.onKeyboard(this.handleKeyboard)},t.componentWillUnmount=function(){this.editor.offKeyboard(this.handleKeyboard)},t.render=function(){var e=this;return s.createElement("span",{className:"button button-type-link",title:b.get("btnLink"),onClick:function(){return e.editor.insertMarkdown("link")}},s.createElement(M,{type:"link"}))},i}(x);Ge.pluginName="link";var qe=function(r){w(i,r);function i(n){var e;return e=r.call(this,n)||this,e.handleKeyboard={key:"7",keyCode:55,withKey:["ctrlKey","shiftKey"],aliasCommand:!0,callback:function(){return e.editor.insertMarkdown("order")}},e}var t=i.prototype;return t.componentDidMount=function(){this.editorConfig.shortcuts&&this.editor.onKeyboard(this.handleKeyboard)},t.componentWillUnmount=function(){this.editor.offKeyboard(this.handleKeyboard)},t.render=function(){var e=this;return s.createElement("span",{className:"button button-type-ordered",title:b.get("btnOrdered"),onClick:function(){return e.editor.insertMarkdown("order")}},s.createElement(M,{type:"list-ordered"}))},i}(x);qe.pluginName="list-ordered";var ze=function(r){w(i,r);function i(n){var e;return e=r.call(this,n)||this,e.handleKeyboard={key:"8",keyCode:56,withKey:["ctrlKey","shiftKey"],aliasCommand:!0,callback:function(){return e.editor.insertMarkdown("unordered")}},e}var t=i.prototype;return t.componentDidMount=function(){this.editorConfig.shortcuts&&this.editor.onKeyboard(this.handleKeyboard)},t.componentWillUnmount=function(){this.editor.offKeyboard(this.handleKeyboard)},t.render=function(){var e=this;return s.createElement("span",{className:"button button-type-unordered",title:b.get("btnUnordered"),onClick:function(){return e.editor.insertMarkdown("unordered")}},s.createElement(M,{type:"list-unordered"}))},i}(x);ze.pluginName="list-unordered";var Rt=100,Pt=function(){function r(t){t===void 0&&(t={}),this.record=[],this.recycle=[],this.initValue="";var n=t,e=n.maxSize,o=e===void 0?Rt:e;this.maxSize=o}var i=r.prototype;return i.push=function(n){for(var e=this.record.push(n);this.record.length>this.maxSize;)this.record.shift();return e},i.get=function(){return this.record},i.getLast=function(){var n=this.record.length;return this.record[n-1]},i.undo=function(n){var e=this.record.pop();if(typeof e>"u")return this.initValue;if(e!==n)return this.recycle.push(e),e;var o=this.record.pop();return typeof o>"u"?(this.recycle.push(e),this.initValue):(this.recycle.push(e),o)},i.redo=function(){var n=this.recycle.pop();if(typeof n<"u")return this.push(n),n},i.cleanRedo=function(){this.recycle=[]},i.getUndoCount=function(){return this.undo.length},i.getRedoCount=function(){return this.recycle.length},r}(),he=function(r){w(i,r);function i(n){var e;return e=r.call(this,n)||this,e.handleKeyboards=[],e.lastPop=null,e.handleChange=e.handleChange.bind(C(e)),e.handleRedo=e.handleRedo.bind(C(e)),e.handleUndo=e.handleUndo.bind(C(e)),e.handleKeyboards=[{key:"y",keyCode:89,withKey:["ctrlKey"],callback:e.handleRedo},{key:"z",keyCode:90,withKey:["metaKey","shiftKey"],callback:e.handleRedo},{key:"z",keyCode:90,aliasCommand:!0,withKey:["ctrlKey"],callback:e.handleUndo}],e.logger=new Pt({maxSize:e.editorConfig.loggerMaxSize}),e.editor.registerPluginApi("undo",e.handleUndo),e.editor.registerPluginApi("redo",e.handleRedo),e}var t=i.prototype;return t.handleUndo=function(){var e=this.logger.undo(this.editor.getMdValue());typeof e<"u"&&(this.pause(),this.lastPop=e,this.editor.setText(e),this.forceUpdate())},t.handleRedo=function(){var e=this.logger.redo();typeof e<"u"&&(this.lastPop=e,this.editor.setText(e),this.forceUpdate())},t.handleChange=function(e,o,a){var l=this;if(!(this.logger.getLast()===e||this.lastPop!==null&&this.lastPop===e)){if(this.logger.cleanRedo(),a){this.logger.push(e),this.lastPop=null,this.forceUpdate();return}this.timerId&&(window.clearTimeout(this.timerId),this.timerId=0),this.timerId=window.setTimeout(function(){l.logger.getLast()!==e&&(l.logger.push(e),l.lastPop=null,l.forceUpdate()),window.clearTimeout(l.timerId),l.timerId=0},this.editorConfig.loggerInterval)}},t.componentDidMount=function(){var e=this;this.editor.on("change",this.handleChange),this.handleKeyboards.forEach(function(o){return e.editor.onKeyboard(o)}),this.logger.initValue=this.editor.getMdValue(),this.forceUpdate()},t.componentWillUnmount=function(){var e=this;this.timerId&&window.clearTimeout(this.timerId),this.editor.off("change",this.handleChange),this.editor.unregisterPluginApi("undo"),this.editor.unregisterPluginApi("redo"),this.handleKeyboards.forEach(function(o){return e.editor.offKeyboard(o)})},t.pause=function(){this.timerId&&(window.clearTimeout(this.timerId),this.timerId=void 0)},t.render=function(){var e=this.logger.getUndoCount()>1||this.logger.initValue!==this.editor.getMdValue(),o=this.logger.getRedoCount()>0;return s.createElement(s.Fragment,null,s.createElement("span",{className:"button button-type-undo "+(e?"":"disabled"),title:b.get("btnUndo"),onClick:this.handleUndo},s.createElement(M,{type:"undo"})),s.createElement("span",{className:"button button-type-redo "+(o?"":"disabled"),title:b.get("btnRedo"),onClick:this.handleRedo},s.createElement(M,{type:"redo"})))},i}(x);he.pluginName="logger";var U;(function(r){r[r.SHOW_ALL=0]="SHOW_ALL",r[r.SHOW_MD=1]="SHOW_MD",r[r.SHOW_HTML=2]="SHOW_HTML"})(U||(U={}));var fe=function(r){w(i,r);function i(n){var e;return e=r.call(this,n)||this,e.handleClick=e.handleClick.bind(C(e)),e.handleChange=e.handleChange.bind(C(e)),e.state={view:e.editor.getView()},e}var t=i.prototype;return t.handleClick=function(){switch(this.next){case U.SHOW_ALL:this.editor.setView({html:!0,md:!0});break;case U.SHOW_HTML:this.editor.setView({html:!0,md:!1});break;case U.SHOW_MD:this.editor.setView({html:!1,md:!0});break}},t.handleChange=function(e){this.setState({view:e})},t.componentDidMount=function(){this.editor.on("viewchange",this.handleChange)},t.componentWillUnmount=function(){this.editor.off("viewchange",this.handleChange)},t.getDisplayInfo=function(){var e=this.next;switch(e){case U.SHOW_ALL:return{icon:"view-split",title:"All"};case U.SHOW_HTML:return{icon:"visibility",title:"Preview"};default:return{icon:"keyboard",title:"Editor"}}},t.render=function(){if(this.isDisplay){var e=this.getDisplayInfo();return s.createElement("span",{className:"button button-type-mode",title:b.get("btnMode"+e.title),onClick:this.handleClick},s.createElement(M,{type:e.icon}))}return null},Le(i,[{key:"isDisplay",get:function(){var e=this.editorConfig.canView;return e?[e.html,e.md,e.both].filter(function(o){return o}).length>=2:!1}},{key:"next",get:function(){var e=this.editorConfig.canView,o=this.state.view,a=[U.SHOW_ALL,U.SHOW_MD,U.SHOW_HTML];e&&(e.both||a.splice(a.indexOf(U.SHOW_ALL),1),e.md||a.splice(a.indexOf(U.SHOW_MD),1),e.html||a.splice(a.indexOf(U.SHOW_HTML),1));var l=U.SHOW_MD;if(o.html&&(l=U.SHOW_HTML),o.html&&o.md&&(l=U.SHOW_ALL),a.length===0)return l;if(a.length===1)return a[0];var c=a.indexOf(l);return c<a.length-1?a[c+1]:a[0]}}]),i}(x);fe.pluginName="mode-toggle";fe.align="right";var jt=function(r){w(i,r);function i(n){var e;e=r.call(this,n)||this,e.config={padding:3,width:20,height:20};var o=n.maxRow,a=o===void 0?5:o,l=n.maxCol,c=l===void 0?6:l;return e.state={maxRow:a,maxCol:c,list:e.formatTableModel(a,c)},e}var t=i.prototype;return t.formatTableModel=function(e,o){e===void 0&&(e=0),o===void 0&&(o=0);var a=new Array(e).fill(void 0);return a.map(function(l){return new Array(o).fill(0)})},t.calcWrapStyle=function(){var e=this.state,o=e.maxRow,a=e.maxCol,l=this.config,c=l.width,d=l.height,u=l.padding,h=(c+u)*a-u,g=(d+u)*o-u;return{width:h+"px",height:g+"px"}},t.calcItemStyle=function(e,o){e===void 0&&(e=0),o===void 0&&(o=0);var a=this.config,l=a.width,c=a.height,d=a.padding,u=(c+d)*e,h=(l+d)*o;return{top:u+"px",left:h+"px"}},t.getList=function(e,o){var a=this.state.list;return a.map(function(l,c){return l.map(function(d,u){return c<=e&&u<=o?1:0})})},t.handleHover=function(e,o){this.setState({list:this.getList(e,o)})},t.handleSetTable=function(e,o){var a=this.props.onSetTable;typeof a=="function"&&a({row:e+1,col:o+1})},t.componentDidUpdate=function(e){this.props.visibility===!1&&e.visibility!==this.props.visibility&&this.setState({list:this.getList(-1,-1)})},t.render=function(){var e=this;return s.createElement("ul",{className:"table-list wrap",style:this.calcWrapStyle()},this.state.list.map(function(o,a){return o.map(function(l,c){return s.createElement("li",{className:"list-item "+(l===1?"active":""),key:a+"-"+c,style:e.calcItemStyle(a,c),onMouseOver:e.handleHover.bind(e,a,c),onClick:e.handleSetTable.bind(e,a,c)})})}))},i}(s.Component),pe=function(r){w(i,r);function i(n){var e;return e=r.call(this,n)||this,e.show=e.show.bind(C(e)),e.hide=e.hide.bind(C(e)),e.state={show:!1},e}var t=i.prototype;return t.show=function(){this.setState({show:!0})},t.hide=function(){this.setState({show:!1})},t.render=function(){var e=this,o=this.editorConfig.table||this.props.config;return s.createElement("span",{className:"button button-type-table",title:b.get("btnTable"),onMouseEnter:this.show,onMouseLeave:this.hide},s.createElement(M,{type:"grid"}),s.createElement(je,{show:this.state.show,onClose:this.hide},s.createElement(jt,{visibility:this.state.show,maxRow:o.maxRow,maxCol:o.maxCol,onSetTable:function(l){return e.editor.insertMarkdown("table",l)}})))},i}(x);pe.pluginName="table";pe.defaultConfig={maxRow:6,maxCol:6};S.use(Be);S.use(Oe);S.use(We);S.use(Pe);S.use(Re);S.use(ze);S.use(qe);S.use(Ae);S.use(Ve);S.use(He);S.use(Ke);S.use(pe);S.use($e);S.use(Ge);S.use(Fe);S.use(he);S.use(fe);S.use(de);var Bt={Logger:he};const $t=r=>{const i=se(),t=_e();return Te({mutationFn:async n=>{const e=await i(`${le}/api/markdown-documents`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)});return ce(e)},onSuccess:()=>{t.invalidateQueries({queryKey:["markdownDocument"]})},...r})},Gt=(r,i)=>{const t=["markdownDocumentById",r],n=`${le}/api/markdown-documents/${r}`,e=se();return tt({queryKey:t,queryFn:async()=>{const a=await e(n);return ce(a)},...i})},qt=r=>{const i=se(),t=_e();return Te({mutationFn:async n=>{const e=await i(`${le}/api/markdown-documents/${n.id}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)});return ce(e)},onSuccess:()=>{t.invalidateQueries({queryKey:["markdownDocument"]})},...r})};function zt(r){return r>="a"&&r<="z"||r>="A"&&r<="Z"||r>="0"&&r<="9"||r==="-"||r==="."||r==="_"||r==="~"||r==="/"}function Qt(r){if(!r||r.trim()==="")return"Path cannot be empty.";if(r.startsWith("/"))return"Path should not start with a '/'.";for(let n=0;n<r.length-1;n++)if(r[n]==="/"&&r[n+1]==="/")return"Path cannot contain consecutive '/' characters.";for(let n=0;n<r.length;n++){const e=r[n];if(!zt(e))return`Invalid character '${e}' found in path.`}if(r.endsWith("/"))return"Path must end with a filename, not a '/'.";const i=r.lastIndexOf("/");let t;return i===-1?t=r:t=r.substring(i+1),!t||t.trim()===""?"Filename cannot be empty.":t.toLowerCase().endsWith(".md")?!0:"Filename must end with '.md'."}S.use(Bt.Logger);const cn=()=>{const{id:r="_"}=nt(),i=rt(),[t,n]=ht("documentGroup","docs"),e=r==="_",o=s.useRef(null),[a,l]=s.useState(!1),c=s.useRef(!1),d=ft(),[u,h]=s.useState([]),[g,y]=s.useState(""),{control:p,handleSubmit:E,formState:{errors:f},reset:N,watch:T}=dt({defaultValues:{id:null,documentGroup:t,path:"",content:"",createdAt:new Date().toISOString(),updatedAt:null}}),k=T("documentGroup");s.useEffect(()=>{e&&k&&n(k)},[k,n,e]);const{data:H,error:K,isLoading:P,refetch:Q}=Gt(r,{enabled:!e}),B=$t({onSuccess:v=>{j.success("Document created successfully"),i(`/sysadmin/documents/edit/${v.id}?group=${t}`)},onError:v=>{j.error(`Error creating document: ${v.message}`)}}),F=qt({onSuccess:()=>{Q().then(()=>{j.success("Document updated successfully")})},onError:v=>{j.error(`Error updating document: ${v.message}`)}}),Y=s.useCallback((v,_)=>v?`${v.replace(/\.[^/.]+$/,"")}/${_}`:_,[]),Qe=async v=>{let _=g;if(u.length>0)try{for(const D of u){const{base64Data:I,fileName:O}=D,W=await(await fetch(I)).blob(),J=new File([W],O,{type:W.type}),G=Y(v.path,O);await d.mutateAsync({path:G,file:J}),_=_.replace(I,`~/api/contents/files/${G}`)}h([])}catch(D){j.error(`Error uploading images: ${D instanceof Error?D.message:"Unknown error"}`);return}v.content=_,e?B.mutate(v):F.mutate(v)};s.useEffect(()=>{H&&(N(H),y(H.content||""))},[H,N]);const Ye=({text:v})=>{y(v)};s.useEffect(()=>{const v=setInterval(()=>{o.current&&!a&&(console.log("Editor reference established"),l(!0),clearInterval(v))},100);return()=>{clearInterval(v)}},[a]);const Je=v=>new Promise((_,D)=>{const I=new FileReader;I.onload=()=>{typeof I.result=="string"?_(I.result):D(new Error("Failed to convert image to base64"))},I.onerror=()=>{D(new Error("Failed to read file"))},I.readAsDataURL(v)}),me=s.useCallback(async v=>{var I;console.log("Paste event triggered");const _=(I=v.clipboardData)==null?void 0:I.items;if(!_)return console.log("No clipboard data available"),!1;const D=o.current;if(!D)return console.warn("Editor not available during paste event"),!1;console.log(`Found ${_.length} items in clipboard`);for(let O=0;O<_.length;O++)if(_[O].type.indexOf("image")===0){v.preventDefault();const $=_[O].getAsFile();if(!$)continue;try{const W=await Je($),J=pt().slice(0,8),G=$.type.split("/")[1]||"png",Ze=`image-${J}.${G}`;h(et=>[...et,{base64Data:W,fileName:Ze}]);const Xe=`![image](${W})`;return D.insertText(Xe),!0}catch(W){console.error("Image paste error:",W)}}return!1},[]);if(s.useEffect(()=>{if(!a||!o.current||c.current)return;let v;try{if(v=o.current.getMdElement(),!v){console.warn("Could not find editor text area element");return}const _=async D=>{await me(D)};return v.addEventListener("paste",_),c.current=!0,console.log("Paste handler attached successfully to",v),()=>{try{v&&(v.removeEventListener("paste",_),console.log("Paste handler removed"),c.current=!1)}catch(D){console.error("Error removing paste handler:",D)}}}catch(_){console.error("Error setting up paste handler:",_)}},[a,me]),!e&&P)return m.jsx(Ce,{});if(!e&&K)return m.jsx(it,{error:K,title:"Unable to fetch document"});const ge=B.isPending||F.isPending||d.isPending;return m.jsxs(m.Fragment,{children:[m.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-4",children:[m.jsxs("h1",{children:[e?"Create New":"Edit"," Document"]}),m.jsxs(ve,{color:"secondary",onClick:()=>i("/sysadmin/documents"),children:[m.jsx(mt,{size:18,className:"me-2"})," Back to List"]})]}),m.jsx(ct,{children:m.jsx(ut,{children:m.jsxs(ot,{onSubmit:E(Qe),children:[m.jsx(st,{children:m.jsx(lt,{md:6,children:m.jsxs(Z,{children:[m.jsx(X,{for:"documentGroup",children:"Document Group"}),m.jsx(be,{name:"documentGroup",control:p,rules:{required:"Document group is required"},render:({field:v})=>m.jsxs(ye,{...v,type:"select",id:"documentGroup",disabled:!e,children:[m.jsx("option",{value:"docs",children:"User Documentation"}),m.jsx("option",{value:"sys",children:"System Documentation"})]})}),m.jsx(we,{error:f.documentGroup,fieldDisplayName:"Document Group"})]})})}),m.jsxs(Z,{children:[m.jsx(X,{for:"path",children:"Path"}),m.jsx(be,{name:"path",control:p,rules:{required:"Path is required",validate:Qt},render:({field:v})=>m.jsx(ye,{...v,type:"text",id:"path",placeholder:"e.g., chapter1/introduction.md"})}),m.jsx(we,{error:f.path,fieldDisplayName:"Path"})]}),m.jsxs(Z,{children:[m.jsx(X,{for:"content",children:"Content"}),m.jsxs("div",{className:"mb-2 text-muted small",children:[m.jsx("strong",{children:"Tip:"})," You can paste images directly into the editor. They will be uploaded when you save the document."]}),m.jsx(S,{ref:o,value:g,style:{height:"500px"},onChange:Ye,renderHTML:v=>m.jsx(at,{content:v}),onFocus:()=>{o.current&&l(!0)}})]}),m.jsx("div",{className:"d-flex justify-content-end",children:m.jsx(ve,{color:"primary",type:"submit",disabled:ge,children:ge?m.jsx(Ce,{}):m.jsxs(m.Fragment,{children:[m.jsx(gt,{size:18,className:"me-2"}),e?"Create":"Update"," Document"]})})})]})})})]})};export{cn as default};
//# sourceMappingURL=EditDocumentPage-fyhdjKLd.js.map
