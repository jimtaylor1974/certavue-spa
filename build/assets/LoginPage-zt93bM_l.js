import{b as W,c as f,d as w,h as b,u as X,g as Z,r as p,f as ee,j as e,e as se,C as ae,N as te,a as k,b9 as F,i as T,G as P,I as x,E as R,A as ne,B as g,L as u,b6 as A,b7 as I}from"./index-C1gMn5ii.js";import{u as re,C as oe,D as ie}from"./DisplayFormError-BC2wRnzm.js";import{R as le,C as D}from"./Col-CyLh7hzm.js";import{C as ce,a as me}from"./CardBody-UDT5kdgh.js";import{F as j,L as y}from"./Label-BH3wlHv1.js";import{T as de,a as O}from"./TabPane-DR9iJAlH.js";import{S as ue}from"./SocialLogins-CllKj-7d.js";import{u as he}from"./useLocalStorage-OvuIXHXQ.js";import{C as pe}from"./CheckFromEmailSpamJunkWarning-D4Ixc4Tr.js";import{L as xe}from"./log-in-n4HEdwCP.js";import"./types-46npvi_j.js";import"./useSocialAuthLogin-BKpQnRdh.js";const ge=t=>{const a=W();return f({mutationFn:async r=>{const n=await a(`${w}/api/auth/resend-email-confirmation-email`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)});return b(n)},...t})},je=t=>{const a=W();return f({mutationFn:async r=>{const n=await a(`${w}/api/auth/login-with-email`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)});return b(n)},...t})},ye=async t=>{const a=await fetch(`${w}/api/auth/tokens`,{method:"POST",body:t});return b(a)},fe=async t=>{const a=new FormData;return a.append("grant_type","password"),a.append("username",t.username),a.append("password",t.password),ye(a)};function we(){return f({mutationFn:fe,retry:0})}const Ae=()=>{var S,L;const{onAuthenticated:t,redirectOnAuthenticated:a,removeSignInRedirect:r}=X(),{state:n}=Z(),[l,o]=p.useState(null),[h,m]=p.useState(!1),[d,q]=he("LoginTab","password"),{auth:N}=ee(),M=N.microsoft.enabled||N.google.enabled,{control:B,handleSubmit:$,formState:{errors:J},clearErrors:E}=re({defaultValues:{email:""},mode:"onChange"}),[i,v]=p.useState({username:"",password:""}),U=we(),z=ge({onSuccess:()=>{I.success("Confirmation email has been resent.")},onError:s=>{o(A(s))}}),G=je({onSuccess:()=>{r(),I.success("Please check your email for a login link.")},onError:s=>{o(A(s))}}),_=s=>{t(s),a(n==null?void 0:n.redir)},V=async s=>{s.preventDefault(),m(!0);try{const c=await U.mutateAsync(i);_(c)}catch(c){o(c)}finally{m(!1)}},Y=s=>{o(null),E();const c=r(),Q={email:s.email,redir:c};G.mutate(Q)},C=s=>{d!==s&&(q(s),o(null),E())},H=async()=>{m(!0);try{const s={email:i.username};await z.mutateAsync(s)}catch(s){o(s)}finally{m(!1)}},K=(((L=(S=l==null?void 0:l.problemDetails)==null?void 0:S.authError)==null?void 0:L.error)??"")==="unconfirmed_email";return e.jsx(se,{className:"my-5",children:e.jsxs(le,{className:"justify-content-center",children:[e.jsxs(D,{xs:12,md:8,lg:6,children:[e.jsxs("div",{className:"text-center mb-4",children:[e.jsx(ae,{}),e.jsx("h2",{className:"mt-2",children:"Welcome Back!"}),e.jsx("p",{className:"text-muted",children:"Log in to continue to certavue.com"})]}),e.jsx(ce,{children:e.jsxs(me,{children:[e.jsxs(te,{tabs:!0,className:"justify-content-center mb-4",children:[e.jsx(k,{children:e.jsx(F,{className:T({active:d==="password"}),onClick:()=>C("password"),children:"Password Login"})}),e.jsx(k,{children:e.jsx(F,{className:T({active:d==="email"}),onClick:()=>C("email"),children:"Email Login"})})]}),e.jsxs(de,{activeTab:d,children:[e.jsx(O,{tabId:"password",children:e.jsxs(P,{onSubmit:V,children:[e.jsxs(j,{children:[e.jsx(y,{for:"username",children:"Email"}),e.jsx(x,{type:"text",id:"username",placeholder:"Enter your email",value:i.username,onChange:s=>v({...i,username:s.target.value})})]}),e.jsxs(j,{children:[e.jsx(y,{for:"password",children:"Password"}),e.jsx(x,{type:"password",id:"password",placeholder:"Enter your password",value:i.password,onChange:s=>v({...i,password:s.target.value})})]}),e.jsx(R,{error:l}),K&&e.jsxs(ne,{color:"warning",children:[e.jsx("p",{className:"mb-2",children:"Your email address is not confirmed. Please confirm your email to proceed."}),e.jsx(g,{color:"warning",onClick:H,disabled:h,children:"Resend Confirmation Email"})]}),e.jsxs("div",{className:"d-flex justify-content-between align-items-center",children:[e.jsx(u,{to:"/forgot-password",className:"text-muted",children:"Forgot password?"}),e.jsxs(g,{color:"primary",type:"submit",disabled:h,children:[e.jsx(xe,{size:16,className:"me-2"}),"Log In"]})]})]})}),e.jsx(O,{tabId:"email",children:e.jsxs(P,{onSubmit:$(Y),children:[e.jsxs(j,{children:[e.jsx(y,{for:"email",children:"Email"}),e.jsx(oe,{control:B,name:"email",rules:{required:"Email is required",pattern:{value:/^[^\s@]+@[^\s@]+\.[^\s@]+$/,message:"Invalid email address"}},render:({field:s})=>e.jsx(x,{type:"email",id:"email",placeholder:"Enter your email",...s})}),e.jsx(ie,{error:J.email,fieldDisplayName:"Email"})]}),e.jsx(pe,{}),e.jsx(R,{error:l}),e.jsx("div",{className:"text-end",children:e.jsx(g,{color:"primary",type:"submit",disabled:h,children:"Send Login Link"})})]})})]}),M&&e.jsxs("div",{className:"text-center mt-4",children:[e.jsx("p",{className:"text-muted",children:"Or log in with"}),e.jsx(ue,{registration:!1})]})]})}),e.jsx("div",{className:"text-center mt-4",children:e.jsxs("p",{className:"text-muted",children:["Don't have an account?"," ",e.jsx(u,{to:"/sign-up",children:"Create one now"})]})})]}),e.jsxs(D,{xs:12,md:8,lg:6,children:[e.jsx("h3",{className:"text-lavender mb-3",children:"Need something else?"}),e.jsxs("div",{className:"mb-4",children:[e.jsx("h4",{className:"text-mulled-wine",children:"New to certavue?"}),e.jsxs("p",{children:["If your company already uses certavue and you donâ€™t yet have your own login, quickly"," ",e.jsx(u,{to:"/sign-up",className:"text-primary font-weight-bold",children:"Sign up here"})," ","to get started."]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-mulled-wine",children:"Want to bring certavue to your company?"}),e.jsxs("p",{children:["Easily"," ",e.jsx(u,{to:"/register-company",className:"text-primary font-weight-bold",children:"Register your Company"})," ","to begin simplifying your organization's transformation management today."]})]})]})]})})};export{Ae as default};
//# sourceMappingURL=LoginPage-zt93bM_l.js.map
